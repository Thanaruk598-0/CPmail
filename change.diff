diff --git a/app.js b/app.js
index 5336952..703dd1f 100644
--- a/app.js
+++ b/app.js
@@ -5,6 +5,8 @@ var cookieParser = require("cookie-parser");
 var logger = require("morgan");
 var mongoose = require("mongoose");
 
+const { Notification, User } = require("./models");
+
 // Test
 const session = require("express-session");
 
@@ -13,6 +15,7 @@ const authRouter = require("./routes/auth");
 var indexRouter = require("./routes/index");
 var usersRouter = require("./routes/users");
 var studentRouter = require("./routes/studentRoute");
+var notificationsRouter = require("./routes/notifications");
 
 var app = express();
 
@@ -47,11 +50,33 @@ app.use(
   session({ secret: "formEaseSecret", resave: false, saveUninitialized: false })
 );
 
+app.use((req, res, next) => {
+  // ถ้า session มี user ก็ใช้ user นั้น ถ้าไม่มีก็เป็น undefined
+  res.locals.currentUser = req.session.user;
+  next();
+});
+
+// 🔔 GLOBAL notiCount (นับจาก Notification.read:false)
+app.use(async (req, res, next) => {
+  res.locals.notiCount = 0;           // default กันพัง
+  if (!req.session.user) return next();
+  try {
+    res.locals.notiCount = await Notification.countDocuments({
+      user: req.session.user._id,
+      read: false,
+    });
+  } catch (e) {
+    // เงียบๆ ไม่ให้พังเพจ
+  }
+  next();
+});
+
 // routers
 app.use("/", authRouter);
 app.use("/", indexRouter);
 app.use("/users", usersRouter);
 app.use("/student", studentRouter);
+app.use("/", notificationsRouter);
 
 // catch 404 and forward to error handler
 app.use(function (req, res, next) {
diff --git a/controllers/studentController.js b/controllers/studentController.js
index 18c42f8..9a42130 100644
--- a/controllers/studentController.js
+++ b/controllers/studentController.js
@@ -7,8 +7,6 @@ const {
   User,
   Form,
   FormTemplate,
-  Notification,
-  Announcement,
   Course,
   Section,
 } = require("../models");
@@ -41,28 +39,10 @@ const getDashboard = async (req, res) => {
       .populate({ path: "section", select: "name" })
       .populate({ path: "reviewers", select: "name" }); // reviewers เป็น ObjectId เดี่ยว
 
-    const notifications = await Notification.find({ user: studentId })
-      .sort({ createdAt: -1 })
-      .limit(6)
-      .select("_id message link read createdAt");
-
-    const sectionIds = (student.sections || []).map((s) => s._id || s);
-    const announcements = await Announcement.find({
-      $or: [
-        { "audience.role": "student" },
-        { "audience.section": { $in: sectionIds } },
-      ],
-      expiresAt: { $gte: new Date() },
-    })
-      .sort({ createdAt: -1 })
-      .limit(5);
-
     res.render("student/dashboard", {
       student,
       recentForms,
-      notifications,
-      announcements,
-      renderServerData: true,
+      activeMenu: "student"
     });
   } catch (err) {
     console.error(err);
@@ -85,6 +65,7 @@ const getProfile = async (req, res) => {
       canRegister,
       message: null,
       error: null,
+      activeMenu: "profile"
     });
   } catch (err) {
     console.error(err);
@@ -126,7 +107,7 @@ const updateAvatar = async (req, res) => {
       allCourses,
       canRegister,
       message: "✅ Avatar updated successfully!",
-      error: null,
+      activeMenu: "profile",
     });
   } catch (err) {
     console.error(err);
@@ -158,6 +139,7 @@ const updatePersonalInfo = async (req, res) => {
       student: studentFull,
       allCourses,
       canRegister,
+      activeMenu: "profile",
       message: "Personal info updated!",
       error: null,
     });
@@ -199,6 +181,7 @@ const updateCourses = async (req, res) => {
         student: studentFull,
         allCourses,
         canRegister: false,
+        activeMenu: "profile",
         message: null,
         error:
           "คุณได้ลงทะเบียนรายวิชาแล้ว หากต้องการแก้ไขโปรดติดต่อผู้ดูแลระบบ (Admin).",
@@ -262,6 +245,7 @@ const updateCourses = async (req, res) => {
       allCourses: allCoursesWithSections,
       canRegister: false,
       message: "ลงทะเบียนสำเร็จ! หากต้องการแก้ไขโปรดติดต่อผู้ดูแลระบบ (Admin).",
+      activeMenu: "profile",
       error: null,
     });
   } catch (err) {
@@ -361,166 +345,272 @@ const changePassword = async (req, res) => {
   }
 };
 
+// ⛔ ใช้ 10 รายการต่อหน้าเสมอ
+const PAGE_SIZE = 10;
+
 // ------------------------------
-// Form History (GET)
+// (แก้) Core ที่ใช้ทั้งหน้า EJS และ JSON
 // ------------------------------
+const buildFormHistoryData = async (studentId, query) => {
+  const {
+    q = "",
+    status = "all",
+    category = "all",
+    from = "",
+    to = "",
+    page = 1,
+    // limit = 10,   // ไม่ใช้แล้ว เราคุมด้วย PAGE_SIZE
+  } = query;
+
+  const pageNum = Math.max(parseInt(page) || 1, 1);
+  const pageSize = PAGE_SIZE; // ✅ ตายตัว 10
+
+  // Summary
+  const [totalAll, totalApproved, totalPending, totalRejected, totalCancelled] =
+    await Promise.all([
+      Form.countDocuments({ submitter: studentId }),
+      Form.countDocuments({ submitter: studentId, status: "approved" }),
+      Form.countDocuments({ submitter: studentId, status: "pending" }),
+      Form.countDocuments({ submitter: studentId, status: "rejected" }),
+      Form.countDocuments({ submitter: studentId, status: "cancelled" }),
+    ]);
+
+  const allCategories = await FormTemplate.distinct("category");
+
+  // Base filters
+  const baseMatch = { submitter: studentId };
+  if (status && status !== "all") baseMatch.status = status;
+
+  if (from) {
+    const d = new Date(from);
+    d.setHours(0, 0, 0, 0);
+    baseMatch.createdAt = { ...(baseMatch.createdAt || {}), $gte: d };
+  }
+  if (to) {
+    const start = new Date(to);
+    start.setHours(0, 0, 0, 0);
+    const end = new Date(to);
+    end.setHours(23, 59, 59, 999);
+    baseMatch.updatedAt = { $gte: start, $lte: end };
+  }
+
+  if (category && category !== "all") {
+    const tIds = await FormTemplate.find({ category }).select("_id").lean();
+    const list = tIds.map((t) => t._id);
+    if (list.length === 0) {
+      return {
+        totals: { all: totalAll, approved: totalApproved, pending: totalPending, rejected: totalRejected, cancelled: totalCancelled },
+        items: [],
+        filteredTotal: 0,
+        pagination: { page: 1, pageSize, totalPages: 1 },
+        filters: { q, status, category, from, to, page: 1, limit: pageSize },
+        allCategories,
+      };
+    }
+    baseMatch.template = { $in: list };
+  }
+
+  // tokenize
+  const extractTokens = (text) =>
+    (String(text || "").match(/[\p{L}\p{N}]+/gu) || []).map(s => s.trim()).filter(Boolean);
+  const makeRegex = (s) => new RegExp(s.replace(/[.*+?^${}()|[\]\\]/g, "\\$&"), "i");
+  const tokens = extractTokens(q);
+
+  // Pre-query ids
+  let extraOr = [];
+  if (tokens.length > 0) {
+    const andTitle = tokens.map(tk => ({ title: makeRegex(tk) }));
+    const andName = tokens.map(tk => ({ name: makeRegex(tk) }));
+
+    const matchedTemplates = await FormTemplate.find({ $and: andTitle }).select("_id").lean();
+    if (matchedTemplates.length) extraOr.push({ template: { $in: matchedTemplates.map(d => d._id) } });
+
+    const matchedUsers = await User.find({ $and: andName }).select("_id").lean();
+    if (matchedUsers.length) extraOr.push({ reviewers: { $in: matchedUsers.map(d => d._id) } });
+
+    const matchedCourses = await Course.find({ $and: andName }).select("_id").lean();
+    if (matchedCourses.length) extraOr.push({ course: { $in: matchedCourses.map(d => d._id) } });
+
+    const matchedSections = await Section.find({ $and: andName }).select("_id").lean();
+    if (matchedSections.length) extraOr.push({ section: { $in: matchedSections.map(d => d._id) } });
+
+    if (extraOr.length === 0) {
+      return {
+        totals: { all: totalAll, approved: totalApproved, pending: totalPending, rejected: totalRejected, cancelled: totalCancelled },
+        items: [],
+        filteredTotal: 0,
+        pagination: { page: 1, pageSize, totalPages: 1 },
+        filters: { q, status, category, from, to, page: 1, limit: pageSize },
+        allCategories,
+      };
+    }
+  }
+
+  const finalMatch = { ...baseMatch };
+  if (extraOr.length > 0) finalMatch.$or = extraOr;
+
+  const [filteredTotal, rawItems] = await Promise.all([
+    Form.countDocuments(finalMatch),
+    Form.find(finalMatch)
+      .sort({ createdAt: -1 })
+      .skip((pageNum - 1) * pageSize)
+      .limit(pageSize)
+      .populate({ path: "template", select: "title category" })
+      .populate({ path: "reviewers", select: "name email" })
+      .populate({ path: "course", select: "name courseId" })
+      .populate({ path: "section", select: "name" })
+      .lean(),
+  ]);
+
+  const items = rawItems.map((doc) => {
+    const created = doc.createdAt || null;
+    const updated = doc.updatedAt || doc.reviewUpdatedAt || doc.reviewedAt || created || null;
+    const template = doc.template || {};
+    const name = template.name || template.title || "-";
+    return {
+      ...doc,
+      template: { ...template, name },
+      reviewer: doc.reviewer || doc.reviewers || null,
+      createdAt: created,
+      updatedAt: updated,
+    };
+  });
+
+  return {
+    totals: { all: totalAll, approved: totalApproved, pending: totalPending, rejected: totalRejected, cancelled: totalCancelled },
+    items,
+    filteredTotal,
+    pagination: { page: pageNum, pageSize, totalPages: Math.max(Math.ceil(filteredTotal / pageSize), 1) },
+    filters: { q, status, category, from, to, page: pageNum, limit: pageSize },
+    allCategories,
+  };
+};
+
+// หน้าเต็มครั้งแรก
 const getFormHistory = async (req, res) => {
+  try {
+    const data = await buildFormHistoryData(req.user._id, req.query);
+    return res.render("student/formhistory", {
+      ...data,
+      submitNewFormUrl: "/forms/submit",
+      activeMenu: "formhistory"
+    });
+  } catch (err) {
+    console.error(err);
+    return res.status(500).render("error", { message: "Server Error", error: err });
+  }
+};
+
+// JSON สำหรับ realtime
+const getFormHistoryData = async (req, res) => {
+  try {
+    const data = await buildFormHistoryData(req.user._id, req.query);
+    return res.json(data);
+  } catch (err) {
+    console.error(err);
+    return res.status(500).json({ error: "Server Error" });
+  }
+};
+
+// ------------------------------
+// ✅ หน้า “รายละเอียดฟอร์ม” (GET)
+// ------------------------------
+const getFormDetail = async (req, res) => {
   try {
     const studentId = req.user._id;
-    const { q = "", status = "all", from = "", to = "", page = 1, limit = 10 } =
-      req.query;
-
-    const pageNum = Math.max(parseInt(page) || 1, 1);
-    const pageSize = Math.min(Math.max(parseInt(limit) || 10, 1), 100);
-
-    // ---- Summary (ไม่ติดฟิล्टर)
-    const [totalAll, totalApproved, totalPending, totalRejected, totalCancelled] =
-      await Promise.all([
-        Form.countDocuments({ submitter: studentId }),
-        Form.countDocuments({ submitter: studentId, status: "approved" }),
-        Form.countDocuments({ submitter: studentId, status: "pending" }),
-        Form.countDocuments({ submitter: studentId, status: "rejected" }),
-        Form.countDocuments({ submitter: studentId, status: "cancelled" }),
-      ]);
-
-    // ---- Base filters
-    const baseMatch = { submitter: studentId };
-    if (status && status !== "all") baseMatch.status = status;
-
-    // From Date = createdAt >= startOfDay(from)
-    if (from) {
-      const d = new Date(from);
-      d.setHours(0, 0, 0, 0);
-      baseMatch.createdAt = { ...(baseMatch.createdAt || {}), $gte: d };
+    const formId = req.query.id; // ดึงจาก query
+
+    if (!formId) {
+      return res.status(400).render("error", { message: "Missing form id", error: null });
     }
 
-    // ✅ To Date = updatedAt เฉพาะ "วันนั้น" (startOfDay..endOfDay)
-    if (to) {
-      const start = new Date(to);
-      start.setHours(0, 0, 0, 0);
-      const end = new Date(to);
-      end.setHours(23, 59, 59, 999);
-      baseMatch.updatedAt = { $gte: start, $lte: end };
+    const form = await Form.findOne({ _id: formId, submitter: studentId })
+      .populate({ path: "template", select: "title category description fields" })
+      .populate({ path: "reviewers", select: "name email" })
+      .populate({ path: "course", select: "name courseId description credits semester" })
+      .populate({ path: "section", select: "name" })
+      .populate({ path: "submitter", select: "name email avatarUrl universityId major yearOfStudy" })
+      .lean();
+
+    if (!form) {
+      return res.status(404).render("error", { message: "Form not found", error: null });
     }
 
-    // ---- Fetch
-    let filteredTotal = 0;
-    let rawItems = [];
-
-    // ถ้าไม่มี q -> ใช้ find()+populate() (เร็วและเสถียร)
-    if (!q || q.trim() === "") {
-      filteredTotal = await Form.countDocuments(baseMatch);
-
-      rawItems = await Form.find(baseMatch)
-        .sort({ createdAt: -1 })
-        .skip((pageNum - 1) * pageSize)
-        .limit(pageSize)
-        .populate({ path: "template", select: "title" }) // ใช้ title
-        .populate({ path: "reviewers", select: "name email" })
-        .populate({ path: "course", select: "name courseId" })
-        .populate({ path: "section", select: "name" })
-        .lean();
-    } else {
-      // มี q -> ใช้ aggregate เพื่อค้นข้ามคอลเลกชัน
-      const FT = FormTemplate.collection.name;
-      const U = User.collection.name;
-      const C = Course.collection.name;
-      const S = Section.collection.name;
-
-      const regex = new RegExp(q.trim(), "i");
-      const pipeline = [
-        { $match: baseMatch },
-
-        { $lookup: { from: FT, localField: "template", foreignField: "_id", as: "template" } },
-        { $unwind: { path: "$template", preserveNullAndEmptyArrays: true } },
-
-        // reviewers: ObjectId เดี่ยว -> วางลงฟิลด์ reviewer
-        { $lookup: { from: U, localField: "reviewers", foreignField: "_id", as: "reviewer" } },
-        { $unwind: { path: "$reviewer", preserveNullAndEmptyArrays: true } },
-
-        { $lookup: { from: C, localField: "course", foreignField: "_id", as: "course" } },
-        { $unwind: { path: "$course", preserveNullAndEmptyArrays: true } },
-
-        { $lookup: { from: S, localField: "section", foreignField: "_id", as: "section" } },
-        { $unwind: { path: "$section", preserveNullAndEmptyArrays: true } },
-
-        // ✅ ค้นหา title (เดิม name ไม่ตรงสคีมา)
-        {
-          $match: {
-            $or: [
-              { "template.title": regex },
-              { "course.name": regex },
-              { "section.name": regex },
-              { "reviewer.name": regex },
-            ],
-          },
-        },
-      ];
-
-      const countRes = await Form.aggregate([...pipeline, { $count: "count" }]);
-      filteredTotal = countRes.length ? countRes[0].count : 0;
-
-      rawItems = await Form.aggregate([
-        ...pipeline,
-        { $sort: { createdAt: -1 } },
-        { $skip: (pageNum - 1) * pageSize },
-        { $limit: pageSize },
-        {
-          $project: {
-            _id: 1,
-            status: 1,
-            createdAt: 1,
-            updatedAt: 1,
-            reviewedAt: 1,
-            reviewUpdatedAt: 1,
-            reviewComment: 1,
-            reason: 1,
-            cancellationReason: 1,
-
-            template: { _id: "$template._id", title: "$template.title" },
-            course: { _id: "$course._id", name: "$course.name", courseId: "$course.courseId" },
-            section: { _id: "$section._id", name: "$section.name" },
-            reviewer: { _id: "$reviewer._id", name: "$reviewer.name", email: "$reviewer.email" },
-          },
-        },
-      ]);
+    return res.render("student/formdetail", { form, useCleanPath: true, activeMenu: "formhistory" }); // flag ไว้
+  } catch (err) {
+    console.error(err);
+    return res.status(500).render("error", { message: "Server Error", error: err });
+  }
+};
+
+// ------------------------------
+// ✅ อัปเดตข้อมูลฟอร์ม (บาง field เท่านั้น) (POST)
+// อนุญาตแก้เฉพาะ field ใน template.fields ที่ locked !== true
+// และเหตุผล (reason) ของผู้ยื่น
+// ------------------------------
+const postUpdateForm = async (req, res) => {
+  try {
+    const studentId = req.user._id;
+    const formId = req.body.id;
+
+    if (!formId) return res.status(400).render("error", { message: "Missing form id", error: null });
+
+    const form = await Form.findOne({ _id: formId, submitter: studentId })
+      .populate({ path: "template", select: "fields" });
+
+    if (!form) {
+      return res.status(404).render("error", { message: "Form not found", error: null });
     }
 
-    // ---- Normalize ให้ view ใช้ template.name ได้เสมอ
-    const items = rawItems.map((doc) => {
-      const created = doc.createdAt || null;
-      const updated = doc.updatedAt || doc.reviewUpdatedAt || doc.reviewedAt || created || null;
-      const template = doc.template || {};
-      const name = template.name || template.title || "-";
-      return {
-        ...doc,
-        template: { ...template, name }, // inject name จาก title
-        reviewer: doc.reviewer || doc.reviewers || null,
-        createdAt: created,
-        updatedAt: updated,
-      };
-    });
+    const incomingData = req.body.data || {};
+    const incomingReason = (req.body.reason || "").trim();
 
-    const filters = { q, status, from, to, page: pageNum, limit: pageSize };
+    const fields = Array.isArray(form.template?.fields) ? form.template.fields : [];
+    const editableKeys = new Set(
+      fields.filter(f => !f?.locked)
+        .map(f => String(f?.name || f?.key || "").trim())
+        .filter(Boolean)
+    );
 
-    return res.render("student/formhistory", {
-      totals: {
-        all: totalAll,
-        approved: totalApproved,
-        pending: totalPending,
-        rejected: totalRejected,
-        cancelled: totalCancelled,
-      },
-      items,
-      filteredTotal,
-      pagination: {
-        page: pageNum,
-        pageSize,
-        totalPages: Math.max(Math.ceil(filteredTotal / pageSize), 1),
-      },
-      filters,
-      submitNewFormUrl: "/forms/submit",
+    const nextData = { ...(form.data || {}) };
+    Object.keys(incomingData).forEach(k => {
+      if (editableKeys.has(k)) nextData[k] = incomingData[k];
     });
+
+    form.data = nextData;
+    form.reason = incomingReason;
+    await form.save();
+
+    // กลับไป path สั้น + ทำ replaceState ในหน้า EJS
+    return res.redirect(`/student/forms?id=${formId}&updated=1`, activeMenu = "formhistory");
+  } catch (err) {
+    console.error(err);
+    return res.status(500).render("error", { message: "Server Error", error: err });
+  }
+};
+
+// ------------------------------
+// ✅ ยกเลิกฟอร์ม (POST) -> อัปเดต status = cancelled
+// ------------------------------
+const postCancelForm = async (req, res) => {
+  try {
+    const studentId = req.user._id;
+    const formId = req.body.id;
+    const cancelReason = (req.body.cancellationReason || "").trim();
+
+    if (!formId) return res.status(400).render("error", { message: "Missing form id", error: null });
+
+    const form = await Form.findOne({ _id: formId, submitter: studentId });
+    if (!form) {
+      return res.status(404).render("error", { message: "Form not found", error: null });
+    }
+
+    form.status = "cancelled";
+    form.cancellationReason = cancelReason || form.cancellationReason || "Cancelled by submitter";
+    form.reviewUpdatedAt = new Date();
+    await form.save();
+
+    return res.redirect(`/student/forms?id=${formId}&cancelled=1`, activeMenu = "formhistory");
   } catch (err) {
     console.error(err);
     return res.status(500).render("error", { message: "Server Error", error: err });
@@ -535,4 +625,8 @@ module.exports = {
   updateCourses,
   changePassword,
   getFormHistory,
+  getFormHistoryData,
+  getFormDetail,            // ✅
+  postUpdateForm,     // ✅
+  postCancelForm,           // ✅
 };
diff --git a/insertData.js b/insertData.js
index 51de698..d1f0445 100644
--- a/insertData.js
+++ b/insertData.js
@@ -1,3 +1,14 @@
+/**
+ * CPmail_DB • Seed ข้อมูลสมจริง (Thai version + targetRoles)
+ * ----------------------------------------------------------------
+ * สิ่งที่ทำ:
+ *  - ผู้ใช้หลายบทบาท (admin/lecturer/student)
+ *  - หลายวิชา หลายเซคชัน (เทอม 1/2025, 2/2025)
+ *  - ฟอร์มเทมเพลต (Request/Academic/Administrative) พร้อม targetRoles
+ *  - ฟอร์มจริงหลากหลายสถานะ + reviewers เลือกตาม targetRoles
+ *  - ประกาศข่าว + การแจ้งเตือน เป็นข้อความภาษาไทย
+ */
+
 const mongoose = require("mongoose");
 const bcrypt = require("bcrypt");
 const {
@@ -12,12 +23,48 @@ const {
 
 const dbURI = "mongodb://127.0.0.1:27017/CPmail_DB";
 
+/* ------------------------------ Helper ทั่วไป ------------------------------ */
+const delay = (ms) => new Promise((res) => setTimeout(res, ms));
+const pick = (arr) => arr[Math.floor(Math.random() * arr.length)];
+const pickMany = (arr, n) => {
+  const a = [...arr];
+  const out = [];
+  while (a.length && out.length < n) {
+    out.push(a.splice(Math.floor(Math.random() * a.length), 1)[0]);
+  }
+  return out;
+};
+const weightedPick = (pairs) => {
+  // pairs: [{value:'pending', w:5}, ...]
+  const total = pairs.reduce((s, p) => s + p.w, 0);
+  let r = Math.random() * total;
+  for (const p of pairs) {
+    if ((r -= p.w) <= 0) return p.value;
+  }
+  return pairs[pairs.length - 1].value;
+};
+const dateStr = (d) => {
+  const iso = new Date(d).toISOString();
+  return iso.split("T")[0];
+};
+const randDateBetween = (start, end) => {
+  const s = new Date(start).getTime();
+  const e = new Date(end).getTime();
+  return new Date(s + Math.random() * (e - s));
+};
+const today = new Date();
+
+/* กำหนดช่วงเวลาเทอม เพื่อสุ่ม createdAt ให้ดูสมจริง */
+const SEM1 = { start: new Date("2025-08-01"), end: new Date("2025-12-31") };
+const SEM2 = { start: new Date("2026-01-08"), end: new Date("2026-05-15") };
+
+/* ------------------------------ MAIN ------------------------------ */
 async function main() {
   try {
     await mongoose.connect(dbURI);
-    console.log("MongoDB connected");
+    console.log("เชื่อมต่อ MongoDB แล้ว");
 
-    // เคลียร์ข้อมูลเดิม
+    // ล้างข้อมูลเดิม
     await Promise.all([
       User.deleteMany({}),
       Course.deleteMany({}),
@@ -28,201 +75,669 @@ async function main() {
       Notification.deleteMany({}),
     ]);
 
-    // 🔹 Admin
+    /* ------------------------------ Users ------------------------------ */
+    // แอดมิน
     const admin = await new User({
-      name: "System Admin",
+      name: "ผู้ดูแลระบบ",
       email: "admin@cp-mail.com",
       universityId: "000000001",
       role: "admin",
       passwordHash: await bcrypt.hash("admin123", 10),
     }).save();
 
-    // 🔹 Lecturer
-    const lecturer = await new User({
-      name: "Prof. Alice",
+    const admin2 = await new User({
+      name: "แอดมินฝ่ายปฏิบัติการ",
+      email: "ops.admin@cp-mail.com",
+      universityId: "000000002",
+      role: "admin",
+      passwordHash: await bcrypt.hash("adminops123", 10),
+    }).save();
+
+    // อาจารย์
+    const lecturerAlice = await new User({
+      name: "รศ. อลิซ",
       email: "alice@cp-mail.com",
       universityId: "111111111",
       role: "lecturer",
       passwordHash: await bcrypt.hash("lect1234", 10),
       mustChangePassword: true,
-      major: "Computer Science",
+      major: "วิทยาการคอมพิวเตอร์",
+    }).save();
+
+    const lecturerBob = await new User({
+      name: "ผศ. บ๊อบ",
+      email: "bob@cp-mail.com",
+      universityId: "111111112",
+      role: "lecturer",
+      passwordHash: await bcrypt.hash("boblect999", 10),
+      mustChangePassword: false,
+      major: "เทคโนโลยีสารสนเทศ",
+    }).save();
+
+    const lecturerCarol = await new User({
+      name: "ดร. แครอล",
+      email: "carol@cp-mail.com",
+      universityId: "111111113",
+      role: "lecturer",
+      passwordHash: await bcrypt.hash("carolpwd", 10),
+      mustChangePassword: false,
+      major: "คณิตศาสตร์",
+    }).save();
+
+    // นักศึกษาหลัก
+    const babyShark = await new User({
+      name: "BabyShark",
+      email: "babyshark@kkumail.com",
+      universityId: "663380598-0",
+      role: "student",
+      passwordHash: await bcrypt.hash("12345678", 10),
+      mustChangePassword: false,
+      dateOfBirth: new Date("2004-03-10"),
+      major: "วิทยาการคอมพิวเตอร์",
+      yearOfStudy: 2,
+      courses: [],
+      sections: [],
+    }).save();
+
+    const littleMermaid = await new User({
+      name: "LittleMermaid",
+      email: "littlemermaid@kkumail.com",
+      universityId: "663380599-0",
+      role: "student",
+      passwordHash: await bcrypt.hash("87654321", 10),
+      mustChangePassword: false,
+      dateOfBirth: new Date("2003-11-22"),
+      major: "เทคโนโลยีสารสนเทศ",
+      yearOfStudy: 3,
     }).save();
 
-    // 🔹 Courses
+    // กลุ่มนักศึกษาเพิ่มเติม
+    const studentNames = [
+      ["Taro", "taro"],
+      ["Mint", "mint"],
+      ["View", "view"],
+      ["Boss", "boss"],
+      ["Nune", "nune"],
+      ["Game", "game"],
+      ["Earn", "earn"],
+      ["Pond", "pond"],
+      ["Aom", "aom"],
+      ["First", "first"],
+      ["Nan", "nan"],
+      ["Mew", "mew"],
+      ["Peta", "peta"],
+      ["Gun", "gunny"],
+      ["Pim", "pim"],
+      ["Ice", "ice"],
+      ["Boom", "boom"],
+      ["Meen", "meen"],
+      ["Proud", "proud"],
+      ["Yok", "yok"],
+    ];
+
+    const students = [babyShark, littleMermaid];
+    for (let i = 0; i < studentNames.length; i++) {
+      const [fullname, alias] = studentNames[i];
+      const s = await new User({
+        name: fullname,
+        email: `${alias}@kkumail.com`,
+        universityId: `66338${(1000 + i).toString()}-X`,
+        role: "student",
+        passwordHash: await bcrypt.hash("student123", 10),
+        mustChangePassword: i % 7 === 0,
+        dateOfBirth: new Date(
+          `${2003 + (i % 2)}-${String(1 + (i % 12)).padStart(2, "0")}-${String(10 + (i % 18)).padStart(2, "0")}`
+        ),
+        major: pick(["วิทยาการคอมพิวเตอร์", "เทคโนโลยีสารสนเทศ", "คณิตศาสตร์"]),
+        yearOfStudy: 1 + (i % 4),
+        courses: [],
+        sections: [],
+      }).save();
+      students.push(s);
+    }
+
+    /* ------------------------------ วิชา & เซคชัน ------------------------------ */
     const coursesData = [
-      { courseId: "CS101", name: "Introduction to CS", description: "Basic CS course", credits: 3, semester: "1/2025" },
-      { courseId: "MA101", name: "Calculus I", description: "Basic Math course", credits: 3, semester: "1/2025" },
-      { courseId: "CS102", name: "Introduction to IT", description: "Basic IT course", credits: 3, semester: "1/2025" },
-      { courseId: "CS103", name: "Introduction to Programming", description: "Basic Programming course", credits: 3, semester: "1/2025" },
+      {
+        courseId: "CS101",
+        name: "พื้นฐานวิทยาการคอมพิวเตอร์",
+        description: "แนวคิดพื้นฐาน ทักษะแก้ปัญหา และภาพรวมระบบ",
+        credits: 3,
+        semester: "1/2025",
+        lecturers: [lecturerAlice._id],
+      },
+      {
+        courseId: "MA101",
+        name: "แคลคูลัส I",
+        description: "ลิมิต อนุพันธ์ ปริพันธ์ และการประยุกต์",
+        credits: 3,
+        semester: "1/2025",
+        lecturers: [lecturerCarol._id],
+      },
+      {
+        courseId: "CS102",
+        name: "พื้นฐานเทคโนโลยีสารสนเทศ",
+        description: "พื้นฐานเครือข่าย ฐานข้อมูล และความปลอดภัย",
+        credits: 3,
+        semester: "1/2025",
+        lecturers: [lecturerBob._id, lecturerAlice._id],
+      },
+      {
+        courseId: "CS103",
+        name: "พื้นฐานการเขียนโปรแกรม",
+        description: "อัลกอริทึม ชนิดข้อมูล และ Python เบื้องต้น",
+        credits: 3,
+        semester: "2/2025",
+        lecturers: [lecturerAlice._id],
+      },
+      {
+        courseId: "CS220",
+        name: "โครงสร้างข้อมูล",
+        description: "ลิสต์ ต้นไม้ กราฟ ความซับซ้อน และการนำไปใช้",
+        credits: 3,
+        semester: "2/2025",
+        lecturers: [lecturerBob._id],
+      },
     ];
 
     const courses = [];
     for (const c of coursesData) {
-      const course = await new Course({ ...c, sections: [], lecturers: [lecturer._id] }).save();
+      const course = await new Course({ ...c, sections: [] }).save();
       courses.push(course);
     }
 
-    // 🔹 Sections (2 ต่อคอร์ส)
     const allSections = [];
+    // สร้าง 2-3 เซคชันต่อวิชา
     for (const course of courses) {
-      for (let i = 1; i <= 2; i++) {
+      const secCount = course.courseId === "CS220" ? 2 : 3;
+      for (let i = 1; i <= secCount; i++) {
         const sec = await new Section({
           name: `Section ${i}`,
           course: course._id,
           students: [],
-          lecturers: [lecturer._id],
+          lecturers: course.lecturers,
           semester: course.semester,
-          year: 2025,
+          year: course.semester.endsWith("/2025") ? 2025 : 2026,
           maxStudents: 50,
         }).save();
         allSections.push(sec);
         course.sections.push(sec._id);
-        await course.save();
       }
+      await course.save();
     }
 
-    // 🔹 Students
-    const students = [];
+    // ลงทะเบียน LittleMermaid -> CS101 Sec2 + MA101 Sec1
+    const cs101 = courses.find((c) => c.courseId === "CS101");
+    const ma101 = courses.find((c) => c.courseId === "MA101");
+    const cs101_sec2 = allSections.find((s) => String(s.course) === String(cs101._id) && s.name === "Section 2");
+    const ma101_sec1 = allSections.find((s) => String(s.course) === String(ma101._id) && s.name === "Section 1");
 
-    // 1) BabyShark -> ยังไม่ลงทะเบียนเรียน (courses/sections ว่าง)
-    const babyShark = await new User({
-      name: "BabyShark",
-      email: "babyshark@kkumail.com",
-      universityId: "663380598-0",
-      role: "student",
-      passwordHash: await bcrypt.hash("12345678", 10),
-      mustChangePassword: false,
-      dateOfBirth: new Date("2004-03-10"),
-      major: "Computer Science",
-      yearOfStudy: 2,
-      courses: [],       // ❗ ว่าง
-      sections: [],      // ❗ ว่าง
-    }).save();
-    students.push(babyShark);
+    littleMermaid.courses = [cs101._id, ma101._id];
+    littleMermaid.sections = [cs101_sec2._id, ma101_sec1._id];
+    await littleMermaid.save();
 
-    // 2) LittleMermaid -> ลงทะเบียน CS101 Sec2 + MA101 Sec1
-    const littleMermaid = await new User({
-      name: "LittleMermaid",
-      email: "littlemermaid@kkumail.com",
-      universityId: "663380599-0",
-      role: "student",
-      passwordHash: await bcrypt.hash("87654321", 10),
-      mustChangePassword: false,
-      dateOfBirth: new Date("2003-11-22"),
-      major: "Information Technology",
-      yearOfStudy: 3,
-      courses: [courses[0]._id, courses[1]._id],
-      sections: [allSections[1]._id, allSections[2]._id], // CS101 Sec2, MA101 Sec1
-    }).save();
-    students.push(littleMermaid);
+    cs101_sec2.students.push(littleMermaid._id);
+    ma101_sec1.students.push(littleMermaid._id);
+    await cs101_sec2.save();
+    await ma101_sec1.save();
 
-    // อัปเดต sections ให้มี LittleMermaid เป็นสมาชิก
-    allSections[1].students.push(littleMermaid._id);
-    allSections[2].students.push(littleMermaid._id);
-    await allSections[1].save();
-    await allSections[2].save();
+    // กระจายนักศึกษาอื่น ๆ ลงวิชาแบบสุ่มสมจริง
+    for (const stu of students.filter((s) => s._id.toString() !== littleMermaid._id.toString())) {
+      if (stu.email.startsWith("babyshark")) {
+        // BabyShark ยังไม่ลงทะเบียน (ตรงตามโจทย์)
+        continue;
+      }
+      const enrolledCourses = pickMany(courses, 1 + Math.floor(Math.random() * 3)); // 1-3 วิชา
+      stu.courses = enrolledCourses.map((c) => c._id);
 
-    // 🔹 FormTemplates (ใช้ฟิลด์ title ตามสคีมา)
+      const enrolledSections = [];
+      for (const c of enrolledCourses) {
+        const sectionsOfCourse = allSections.filter((s) => String(s.course) === String(c._id));
+        const sPick = pick(sectionsOfCourse);
+        enrolledSections.push(sPick._id);
+        sPick.students.push(stu._id);
+        await sPick.save();
+      }
+      stu.sections = enrolledSections;
+      await stu.save();
+      if (Math.random() < 0.1) await delay(5);
+    }
+
+    /* ------------------------------ Form Templates (ภาษาไทย + targetRoles) ------------------------------ */
     const formTemplates = await FormTemplate.insertMany([
       {
-        title: "Leave Request - Sick",
-        fields: [{ label: "Reason", type: "text" }, { label: "Date", type: "date" }, { label: "Medical Certificate", type: "file" }],
+        title: "ใบคำร้องขอลาป่วย",
+        description: "แบบฟอร์มลาป่วย แนบใบรับรองแพทย์ได้ (ถ้ามี)",
+        fields: [
+          { label: "สาเหตุ", type: "text" },
+          { label: "วันที่", type: "date" },
+          { label: "ใบรับรองแพทย์", type: "file" },
+        ],
+        allowedRoles: ["student"],
+        targetRoles: ["lecturer"], // ส่งให้อาจารย์ผู้สอนพิจารณา
+        category: "Request",
+        status: "Active",
+      },
+      {
+        title: "ใบคำร้องลากิจ",
+        description: "แบบฟอร์มลากิจ กรณีธุระส่วนตัว",
+        fields: [
+          { label: "สาเหตุ (รายละเอียด)", type: "textarea" },
+          { label: "วันที่", type: "date" },
+        ],
+        allowedRoles: ["student"],
+        targetRoles: ["lecturer"],
+        category: "Request",
+        status: "Active",
+      },
+      {
+        title: "คำร้องลาพักผ่อน",
+        description: "ขอลาพักผ่อนในช่วงวันที่ที่กำหนด",
+        fields: [
+          { label: "วันที่เริ่ม", type: "date" },
+          { label: "วันที่สิ้นสุด", type: "date" },
+          { label: "ปลายทาง/สถานที่", type: "text" },
+        ],
+        allowedRoles: ["student"],
+        targetRoles: ["admin"], // งานธุรการ
+        category: "Administrative",
+        status: "Active",
+      },
+      {
+        title: "คำร้องขอถอนรายวิชา/กิจกรรม",
+        description: "ขอถอนรายวิชา หรือถอนตัวจากกิจกรรม/โครงการ",
+        fields: [
+          { label: "เหตุผลการถอน", type: "textarea" },
+          { label: "วันที่มีผล", type: "date" },
+        ],
+        allowedRoles: ["student"],
+        targetRoles: ["lecturer", "admin"], // อาจารย์ + ธุรการ
+        category: "Administrative",
+        status: "Active",
+      },
+      {
+        title: "อุทธรณ์ส่งงานล่าช้า",
+        description: "คำร้องอุทธรณ์กรณีส่งงานล่าช้าเนื่องจากเหตุจำเป็น",
+        fields: [
+          { label: "ชื่องาน/งานที่ส่ง", type: "text" },
+          { label: "รายวิชา", type: "text" },
+          { label: "เหตุผล", type: "textarea" },
+          { label: "วันที่ส่งจริง", type: "date" },
+        ],
         allowedRoles: ["student"],
+        targetRoles: ["lecturer"],
+        category: "Academic",
+        status: "Active",
       },
       {
-        title: "Leave Request - Personal",
-        fields: [{ label: "Reason", type: "textarea" }, { label: "Date", type: "date" }],
+        title: "คำร้องขอทบทวนคะแนน",
+        description: "ขอทบทวนคะแนนการบ้าน/สอบ พร้อมเหตุผลประกอบ",
+        fields: [
+          { label: "หัวข้อประเมิน", type: "text" },
+          { label: "คะแนนที่คาดหวัง", type: "text" },
+          { label: "คำชี้แจง/เหตุผล", type: "textarea" },
+        ],
         allowedRoles: ["student"],
+        targetRoles: ["lecturer"],
+        category: "Academic",
+        status: "Active",
       },
       {
-        title: "Vacation Request",
-        fields: [{ label: "Start Date", type: "date" }, { label: "End Date", type: "date" }, { label: "Destination", type: "text" }],
+        title: "ขอยืมอุปกรณ์แลบ",
+        description: "ขอยืมอุปกรณ์ห้องปฏิบัติการระยะสั้น",
+        fields: [
+          { label: "ชื่ออุปกรณ์", type: "text" },
+          { label: "วันที่ยืม", type: "date" },
+          { label: "วันที่คืน", type: "date" },
+          { label: "วัตถุประสงค์", type: "textarea" },
+        ],
         allowedRoles: ["student"],
+        targetRoles: ["admin"], // พัสดุ/แลบ
+        category: "Administrative",
+        status: "Active",
       },
       {
-        title: "Resignation Request",
-        fields: [{ label: "Reason for Resignation", type: "textarea" }, { label: "Effective Date", type: "date" }],
+        title: "ลงทะเบียนเข้าร่วมกิจกรรม",
+        description: "ลงทะเบียนกิจกรรม/เวิร์กช็อปของภาควิชา",
+        fields: [
+          { label: "ชื่อกิจกรรม", type: "text" },
+          { label: "ช่วงเวลาที่สะดวก", type: "text" },
+        ],
         allowedRoles: ["student"],
+        targetRoles: ["lecturer", "admin"], // งานกิจกรรม
+        category: "Administrative",
+        status: "Active",
+      },
+      {
+        title: "ขอฝึกงาน (Internship)",
+        description: "เสนอที่ฝึกงาน พร้อมข้อมูลบริษัท/ช่วงเวลา เพื่อขออนุมัติ",
+        fields: [
+          { label: "ชื่อบริษัท", type: "text" },
+          { label: "ตำแหน่ง", type: "text" },
+          { label: "วันเริ่มฝึก", type: "date" },
+          { label: "วันสิ้นสุดฝึก", type: "date" },
+        ],
+        allowedRoles: ["student"],
+        targetRoles: ["lecturer", "admin"], // มักต้องทั้งอาจารย์และธุรการ
+        category: "Academic",
+        status: "Active",
+      },
+      {
+        title: "เบิกค่าเดินทาง",
+        description: "ขอเบิกค่าเดินทาง/ภารกิจนอกสถานที่",
+        fields: [
+          { label: "วัตถุประสงค์การเดินทาง", type: "textarea" },
+          { label: "วันที่เดินทาง", type: "date" },
+          { label: "จำนวนเงิน", type: "text" },
+          { label: "ไฟล์หลักฐาน/ใบเสร็จ", type: "file" },
+        ],
+        allowedRoles: ["student"],
+        targetRoles: ["admin"], // การเงิน/ธุรการ
+        category: "Administrative",
+        status: "Active",
       },
     ]);
 
-    // 🔹 Forms
-    const statuses = ["pending", "approved", "rejected", "cancelled"];
-    const formsData = [];
+    /* ------------------------------ เลือกผู้พิจารณาให้ตรง targetRoles ------------------------------ */
+    const allAdmins = [admin, admin2];
+    const allLecturers = [lecturerAlice, lecturerBob, lecturerCarol];
+
+    function getLecturersFor(courseObj, sectionObj) {
+      // ให้ความสำคัญอาจารย์ที่ผูกกับ section ก่อน ถ้าไม่มีค่อยดึงจาก course
+      if (sectionObj?.lecturers?.length) return sectionObj.lecturers;
+      if (courseObj?.lecturers?.length) return courseObj.lecturers;
+      return [];
+    }
+
+    function asObjectIds(arr) {
+      return arr.map((u) => (u._id ? u._id : u)); // รองรับทั้ง object และ ObjectId
+    }
+
+    /**
+     * เลือกผู้พิจารณา (reviewer) หนึ่งคน ตาม targetRoles ของเทมเพลต
+     * - มี 'lecturer' ⇒ ใช้อาจารย์ของ section/course
+     * - มี 'admin'    ⇒ ใช้แอดมิน
+     * - มีทั้งสอง     ⇒ รวมเป็นพูลเดียวแล้วสุ่ม 1
+     * - ไม่มี/หาไม่ได้ ⇒ fallback สุ่มจากอาจารย์+แอดมินทั้งหมด
+     */
+    function getReviewerFor(tpl, courseObj, sectionObj) {
+      const targets = tpl.targetRoles || [];
+      const candidateIds = new Set();
+
+      if (targets.includes("lecturer")) {
+        const lecIds = getLecturersFor(courseObj, sectionObj);
+        lecIds.forEach((id) => candidateIds.add(String(id)));
+      }
+      if (targets.includes("admin")) {
+        asObjectIds(allAdmins).forEach((id) => candidateIds.add(String(id)));
+      }
+
+      if (candidateIds.size === 0) {
+        const fallback = pick([...allAdmins, ...allLecturers]);
+        return fallback._id;
+      }
+
+      const ids = Array.from(candidateIds);
+      return ids[Math.floor(Math.random() * ids.length)];
+    }
+
+    /* ------------------------------ ตัวช่วยสร้าง data ของฟอร์ม (สอดคล้อง label ภาษาไทย) ------------------------------ */
+    const mkDataByTemplate = (tpl, courseObj, sectionObj) => {
+      const obj = {};
+      for (const f of tpl.fields) {
+        switch (f.label) {
+          case "สาเหตุ":
+          case "สาเหตุ (รายละเอียด)":
+          case "เหตุผล":
+          case "เหตุผลการถอน":
+          case "คำชี้แจง/เหตุผล":
+          case "วัตถุประสงค์":
+          case "วัตถุประสงค์การเดินทาง":
+            obj[f.label] = pick([
+              "ป่วยกะทันหัน มีใบรับรองแพทย์",
+              "ธุระครอบครัวด่วน",
+              "ปัญหาการเดินทาง/รถเสีย",
+              "เข้าร่วมกิจกรรมของคณะ",
+              "ติดสัมภาษณ์งาน/ฝึกงาน",
+            ]);
+            break;
+
+          case "วันที่":
+          case "วันที่ยืม":
+          case "วันที่คืน":
+          case "วันที่มีผล":
+          case "วันเริ่มฝึก":
+          case "วันสิ้นสุดฝึก":
+          case "วันที่เดินทาง":
+          case "วันที่ส่งจริง":
+            obj[f.label] = dateStr(randDateBetween(SEM1.start, SEM1.end));
+            break;
+
+          case "ใบรับรองแพทย์":
+          case "ไฟล์หลักฐาน/ใบเสร็จ":
+            obj[f.label] = pick(["certificate_001.pdf", "receipt_351.jpg", "ไม่มีไฟล์"]);
+            break;
+
+          case "ปลายทาง/สถานที่":
+            obj[f.label] = pick(["เชียงใหม่", "กรุงเทพฯ", "ขอนแก่น", "ภูเก็ต"]);
+            break;
+
+          case "หัวข้อประเมิน":
+          case "ชื่องาน/งานที่ส่ง":
+            obj[f.label] = pick(["Midterm", "Project Report", "Lab 3", "Quiz 2"]);
+            break;
+
+          case "คะแนนที่คาดหวัง":
+            obj[f.label] = pick(["B+", "A", "A-"]);
+            break;
+
+          case "รายวิชา":
+            obj[f.label] = courseObj ? courseObj.name : pick(courses).name;
+            break;
+
+          case "ชื่อบริษัท":
+            obj[f.label] = pick(["Construction Lines Co., Ltd.", "DataNest", "GreenTech", "ThaiSoft"]);
+            break;
+
+          case "ตำแหน่ง":
+            obj[f.label] = pick(["HR Intern", "IT Support Intern", "Data Intern", "Comms Intern"]);
+            break;
+
+          case "ชื่ออุปกรณ์":
+            obj[f.label] = pick(["Raspberry Pi Kit", "ขาตั้งกล้อง", "กล้อง DSLR", "เครื่องบันทึกเสียง"]);
+            break;
+
+          case "ชื่อกิจกรรม":
+            obj[f.label] = pick(["Git Workshop", "UI/UX Bootcamp", "AI for Beginners", "Math Clinic"]);
+            break;
+
+          case "ช่วงเวลาที่สะดวก":
+            obj[f.label] = pick(["09:00-11:00", "13:00-15:00", "15:30-17:30"]);
+            break;
+
+          case "จำนวนเงิน":
+            obj[f.label] = `${(200 + Math.floor(Math.random() * 800)).toString()} บาท`;
+            break;
+
+          default:
+            obj[f.label] = pick(["-", "ไม่ระบุ", "N/A"]);
+        }
+      }
+      // แนบ id วิชา/เซคชันใน data เพื่อ query บนหน้า UI ได้สะดวก (ถ้าสคีมาไม่ได้ใช้ก็ไม่เป็นไร)
+      if (courseObj) obj["_courseId"] = courseObj._id.toString();
+      if (sectionObj) obj["_sectionId"] = sectionObj._id.toString();
+      return obj;
+    };
+
+    /* ------------------------------ สร้างฟอร์มจริง (สมจริง + reviewer ตาม targetRoles) ------------------------------ */
+    const statusWeights = [
+      { value: "pending", w: 6 },
+      { value: "approved", w: 5 },
+      { value: "rejected", w: 2 },
+      { value: "cancelled", w: 1 },
+    ];
 
-    // BabyShark 15 ฟอร์ม (แม้ยังไม่ลงทะเบียนก็ส่งฟอร์มได้)
+    const formsToInsert = [];
+
+    // ฟอร์มของ BabyShark (แม้ยังไม่ลงทะเบียนก็ให้ส่งได้)
     for (let i = 0; i < 15; i++) {
-      formsData.push({
+      const tpl = formTemplates[i % formTemplates.length];
+      const course = pick([cs101, ma101, pick(courses)]);
+      const secCandidates = allSections.filter((s) => String(s.course) === String(course._id));
+      const section = pick(secCandidates);
+      const status = weightedPick(statusWeights);
+      const createdAt = randDateBetween(SEM1.start, today);
+      formsToInsert.push({
         submitter: babyShark._id,
-        template: formTemplates[i % 4]._id,
-        course: i % 2 === 0 ? courses[0]._id : courses[1]._id,
-        section: i % 2 === 0 ? allSections[0]._id : allSections[3]._id,
-        data: { Reason: `Reason ${i + 1}`, Date: `2025-10-${String(10 + i).padStart(2, "0")}` },
-        status: statuses[i % 4],
-        reviewers: i % 2 === 0 ? lecturer._id : admin._id, // ❗ ObjectId เดี่ยว ตามสคีมา
+        template: tpl._id,
+        course: course._id,
+        section: section?._id,
+        data: mkDataByTemplate(tpl, course, section),
+        status,
+        reviewers: getReviewerFor(tpl, course, section), // <-- เลือกตาม targetRoles
+        createdAt,
+        updatedAt: createdAt,
       });
     }
 
-    // LittleMermaid 10 ฟอร์ม
-    for (let i = 0; i < 10; i++) {
-      formsData.push({
+    // ฟอร์มของ LittleMermaid (ยึดวิชาที่ลงจริง)
+    for (let i = 0; i < 12; i++) {
+      const tpl = pick(formTemplates);
+      const course = pick([cs101, ma101]);
+      const section = String(course._id) === String(cs101._id) ? cs101_sec2 : ma101_sec1;
+      const status = weightedPick(statusWeights);
+      const createdAt = randDateBetween(SEM1.start, today);
+      formsToInsert.push({
         submitter: littleMermaid._id,
-        template: formTemplates[i % 4]._id,
-        course: i % 2 === 0 ? courses[0]._id : courses[1]._id,
-        section: i % 2 === 0 ? allSections[1]._id : allSections[2]._id,
-        data: { Reason: `Reason ${i + 1}`, Date: `2025-10-${String(12 + i).padStart(2, "0")}` },
-        status: statuses[i % 4],
-        reviewers: i % 2 === 0 ? lecturer._id : admin._id, // ❗ ObjectId เดี่ยว
+        template: tpl._id,
+        course: course._id,
+        section: section._id,
+        data: mkDataByTemplate(tpl, course, section),
+        status,
+        reviewers: getReviewerFor(tpl, course, section), // <-- เลือกตาม targetRoles
+        createdAt,
+        updatedAt: createdAt,
       });
     }
 
-    await Form.insertMany(formsData);
+    // นักศึกษาคนอื่น ๆ: คนละ 1-4 ฟอร์ม
+    for (const stu of students.filter(
+      (s) =>
+        s._id.toString() !== littleMermaid._id.toString() &&
+        s._id.toString() !== babyShark._id.toString()
+    )) {
+      const count = 1 + Math.floor(Math.random() * 4);
+      for (let k = 0; k < count; k++) {
+        const tpl = pick(formTemplates);
+        let course = null;
+        let section = null;
+        if (stu.courses?.length) {
+          course = pick(courses.filter((c) => stu.courses.map(String).includes(String(c._id))));
+          const secs = allSections.filter((s) => String(s.course) === String(course._id));
+          section = pick(secs);
+        } else {
+          course = pick(courses);
+          const secs = allSections.filter((s) => String(s.course) === String(course._id));
+          section = pick(secs);
+        }
+        const status = weightedPick(statusWeights);
+        const window = Math.random() < 0.25 ? SEM2 : SEM1; // บางส่วนไปอยู่เทอม 2/2025
+        const createdAt = randDateBetween(window.start, window.end);
+        formsToInsert.push({
+          submitter: stu._id,
+          template: tpl._id,
+          course: course._id,
+          section: section?._id,
+          data: mkDataByTemplate(tpl, course, section),
+          status,
+          reviewers: getReviewerFor(tpl, course, section), // <-- เลือกตาม targetRoles
+          createdAt,
+          updatedAt: createdAt,
+        });
+      }
+    }
+
+    await Form.insertMany(formsToInsert);
 
-    // 🔹 Announcements (โครงตามที่ใช้อยู่)
-    await Announcement.insertMany([
+    /* ------------------------------ ประกาศข่าว (ภาษาไทย) ------------------------------ */
+    const annToInsert = [
       {
-        lecturer: lecturer._id,
-        course: courses[0]._id,
-        section: allSections[0]._id,
-        title: "Midterm Exam",
-        content: "Midterm exam will be held on Oct 20th.",
+        lecturer: lecturerAlice._id,
+        course: cs101._id,
+        section: cs101_sec2._id,
+        title: "ประกาศสอบกลางภาค",
+        content: "สอบกลางภาควันที่ 20 ต.ค. ครอบคลุมบทที่ 1–5 โปรดนำบัตรนิสิตนักศึกษามาด้วย",
         pinned: true,
         expiresAt: new Date("2025-12-31"),
         audience: [{ type: "role", role: "student" }],
+        createdAt: randDateBetween(new Date("2025-09-25"), new Date("2025-10-10")),
       },
       {
-        lecturer: lecturer._id,
-        course: courses[1]._id,
-        section: allSections[3]._id,
-        title: "Group Project",
-        content: "Please form groups of 3 for the final project.",
+        lecturer: lecturerCarol._id,
+        course: ma101._id,
+        section: ma101_sec1._id,
+        title: "โปรเจกต์กลุ่ม",
+        content: "จัดกลุ่ม 3 คน และส่งหัวข้อภายใน 5 พ.ย.",
         pinned: false,
         expiresAt: new Date("2025-12-15"),
-        audience: [{ type: "section", section: allSections[3]._id }],
+        audience: [{ type: "section", section: ma101_sec1._id }],
+        createdAt: randDateBetween(new Date("2025-10-01"), new Date("2025-11-01")),
       },
       {
-        lecturer: lecturer._id,
-        course: courses[0]._id,
-        section: allSections[0]._id,
-        title: "Holiday Notice",
-        content: "No classes on Oct 25th (public holiday).",
+        lecturer: lecturerAlice._id,
+        course: cs101._id,
+        section: cs101_sec2._id,
+        title: "หยุดวันนักขัตฤกษ์",
+        content: "งดเรียนวันที่ 25 ต.ค. (วันหยุดนักขัตฤกษ์)",
         pinned: false,
         expiresAt: new Date("2025-11-01"),
         audience: [{ type: "role", role: "student" }],
+        createdAt: new Date("2025-10-15"),
       },
-    ]);
+      {
+        lecturer: lecturerBob._id,
+        course: courses.find((c) => c.courseId === "CS102")._id,
+        section: allSections.find(
+          (s) => String(s.course) === String(courses.find((c) => c.courseId === "CS102")._id) && s.name === "Section 1"
+        )._id,
+        title: "การใช้อุปกรณ์แลบ",
+        content: "โปรดใช้อุปกรณ์ด้วยความระมัดระวัง หากชำรุดแจ้งผ่านฟอร์ม 'ขอยืมอุปกรณ์แลบ' ทันที",
+        pinned: false,
+        expiresAt: new Date("2025-12-20"),
+        audience: [{ type: "role", role: "student" }],
+        createdAt: randDateBetween(new Date("2025-09-10"), new Date("2025-11-30")),
+      },
+    ];
+    await Announcement.insertMany(annToInsert);
 
-    // 🔹 Notifications
-    await Notification.insertMany([
-      { user: babyShark._id, type: "form", message: "Your sick leave request has been submitted.", link: "/forms" },
-      { user: babyShark._id, type: "announcement", message: "New announcement: Midterm Exam.", link: "/announcements" },
-      { user: babyShark._id, type: "system", message: "System maintenance on Oct 30th.", link: "/system" },
-      { user: littleMermaid._id, type: "form", message: "Your personal leave request has been submitted.", link: "/forms" },
-      { user: littleMermaid._id, type: "announcement", message: "New announcement: Group Project.", link: "/announcements" },
-      { user: littleMermaid._id, type: "system", message: "System maintenance on Oct 30th.", link: "/system" },
-    ]);
+    /* ------------------------------ การแจ้งเตือน (ภาษาไทย) ------------------------------ */
+    const notifBase = [
+      { type: "system", message: "ระบบจะปิดปรับปรุงวันที่ 30 ต.ค.", link: "/system" },
+      { type: "announcement", message: "ประกาศใหม่: สอบกลางภาค", link: "/announcements" },
+      { type: "announcement", message: "ประกาศใหม่: โปรเจกต์กลุ่ม", link: "/announcements" },
+      { type: "form", message: "คำร้องของคุณถูกส่งเรียบร้อยแล้ว", link: "/forms" },
+    ];
+
+    const notifications = [];
+    // แจ้งเตือนสำหรับผู้ใช้หลัก 2 คน
+    for (const base of notifBase) {
+      notifications.push({ user: babyShark._id, ...base, createdAt: randDateBetween(SEM1.start, today) });
+      notifications.push({ user: littleMermaid._id, ...base, createdAt: randDateBetween(SEM1.start, today) });
+    }
+    // กระจายให้ผู้ใช้อื่นแบบสุ่ม 0-3 รายการ
+    for (const stu of students) {
+      const k = Math.floor(Math.random() * 4);
+      for (let i = 0; i < k; i++) {
+        notifications.push({
+          user: stu._id,
+          ...pick(notifBase),
+          createdAt: randDateBetween(SEM1.start, today),
+        });
+      }
+    }
+    await Notification.insertMany(notifications);
 
-    console.log("✅ Seed data inserted successfully!");
+    console.log("✅ ใส่ข้อมูล Seed สำเร็จ (Thai + targetRoles)!");
     await mongoose.disconnect();
   } catch (err) {
     console.error(err);
diff --git a/middlewares/authMiddleware.js b/middlewares/authMiddleware.js
index a5b98e8..c85a8f0 100644
--- a/middlewares/authMiddleware.js
+++ b/middlewares/authMiddleware.js
@@ -3,6 +3,6 @@ module.exports = (req, res, next) => {
     req.user = req.session.user;
     next();
   } else {
-    res.redirect("/login");
+    res.redirect("/user/login");
   }
 };
diff --git a/models/FormTemplate.js b/models/FormTemplate.js
index 83b4e5e..a02401b 100644
--- a/models/FormTemplate.js
+++ b/models/FormTemplate.js
@@ -5,6 +5,19 @@ const formTemplateSchema = new Schema({
   title: { type: String, required: true },
   fields: [{ type: Schema.Types.Mixed }],
   allowedRoles: [{ type: String }],
+  targetRoles: [{ type: String }],
+
+  description: { type: String },
+  category: {
+    type: String
+    , enum: ["Academic", "Administrative", "Evaluation", "Request", "Survey"]
+    , required: true
+  },
+  status: {
+    type: String,
+    enum: ["Active", "Inactive", "Draft"],
+    default: "Draft",
+  }
 }
   , { timestamps: true });
 
diff --git a/models/Notification.js b/models/Notification.js
index aac0221..ee29d4d 100644
--- a/models/Notification.js
+++ b/models/Notification.js
@@ -12,4 +12,7 @@ const notificationSchema = new Schema(
   { timestamps: true }
 );
 
+notificationSchema.index({ user: 1, read: 1, createdAt: -1 });
+notificationSchema.index({ createdAt: -1 });
+
 module.exports = mongoose.model("Notification", notificationSchema);
diff --git a/routes/auth.js b/routes/auth.js
index a47185e..c07cb6c 100644
--- a/routes/auth.js
+++ b/routes/auth.js
@@ -4,13 +4,13 @@ const bcrypt = require("bcrypt");
 const { User } = require("../models");
 
 // Login page
-router.get("/login", (req, res) => {
+router.get("/user/login", (req, res) => {
   const { changed } = req.query; // จะเป็น '1' ถ้ามาจาก /login?changed=1
   res.render("login", { changed }); // ส่งไปให้ EJS
 });
 
 // Login submit
-router.post("/login", async (req, res) => {
+router.post("/user/login", async (req, res) => {
   try {
     const { email, password } = req.body;
 
@@ -37,9 +37,9 @@ router.post("/login", async (req, res) => {
 });
 
 // Logout
-router.get("/logout", (req, res) => {
+router.get("/user/logout", (req, res) => {
   req.session.destroy();
-  res.redirect("/login");
+  res.redirect("/user/login");
 });
 
 module.exports = router;
diff --git a/routes/studentRoute.js b/routes/studentRoute.js
index 5f50ee8..f9d39be 100644
--- a/routes/studentRoute.js
+++ b/routes/studentRoute.js
@@ -4,6 +4,7 @@ const multer = require("multer");
 const path = require("path");
 const authMiddleware = require("../middlewares/authMiddleware");
 const StudentController = require("../controllers/studentController");
+const FormController = require("../controllers/formController");
 
 const storage = multer.diskStorage({
   destination: (req, file, cb) => cb(null, "public/uploads"),
@@ -21,6 +22,31 @@ router.get("/", authMiddleware, StudentController.getDashboard);
 router.get("/profile", authMiddleware, StudentController.getProfile);
 
 router.get("/formhistory", authMiddleware, StudentController.getFormHistory);
+router.get("/formhistory/data", authMiddleware, StudentController.getFormHistoryData);
+
+//หน้า “รายละเอียดฟอร์ม”
+router.get("/forms", authMiddleware, StudentController.getFormDetail);
+
+//บันทึกการแก้ไข (บาง field)
+router.post("/forms/:id/update", authMiddleware, StudentController.postUpdateForm);
+
+//ยกเลิกฟอร์ม
+router.post("/forms/:id/cancel", authMiddleware, StudentController.postCancelForm);
+
+// ==============================
+// เส้นทาง “ยื่นฟอร์มใหม่” 3 สเตป
+// STEP 1: เลือกเทมเพลต
+router.get("/forms/submit", authMiddleware, FormController.getSubmitStep1);
+
+// STEP 2: กรอกรายละเอียด (GET/POST ก็ได้ แต่เราทำเป็น GET แสดงฟอร์ม, POST ส่งไป Preview)
+router.get("/forms/submit/details", authMiddleware, FormController.getSubmitStep2);
+
+// STEP 3: Preview & Submit (รับ POST จาก step2)
+router.post("/forms/submit/preview", authMiddleware, FormController.postPreview);
+
+// FINAL: สร้างจริง
+router.post("/forms/submit/create", authMiddleware, FormController.postCreate);
+// ==============================
 
 router.post(
   "/profile/avatar",
diff --git a/views/login.ejs b/views/login.ejs
index 4b85f41..45185e3 100644
--- a/views/login.ejs
+++ b/views/login.ejs
@@ -29,7 +29,7 @@
       </div>
       <% } %>
 
-      <form method="POST" action="/login" class="space-y-5">
+      <form method="POST" action="/user/login" class="space-y-5">
         <div>
           <label class="block text-gray-700 mb-1 font-medium">Email</label>
           <input
diff --git a/views/student/dashboard.ejs b/views/student/dashboard.ejs
index 91713b2..e0d6aee 100644
--- a/views/student/dashboard.ejs
+++ b/views/student/dashboard.ejs
@@ -1,834 +1,510 @@
 <!DOCTYPE html>
-<html lang="en">
-  <head>
-    <meta charset="UTF-8" />
-    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
-    <title>Student Dashboard - FormEase</title>
-    <script src="https://cdn.tailwindcss.com"></script>
-    <script>
-      tailwind.config = {
-        theme: {
-          extend: {
-            colors: {
-              "kku-blue": "#1e40af",
-              "kku-blue-light": "#3b82f6",
-              "kku-blue-dark": "#1e3a8a",
-            },
+<html lang="th">
+
+<head>
+  <meta charset="UTF-8" />
+  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
+  <title>แดชบอร์ดนักศึกษา - FormEase</title>
+  <script src="https://cdn.tailwindcss.com"></script>
+  <script>
+    tailwind.config = {
+      theme: {
+        extend: {
+          colors: {
+            "kku-blue": "#1e40af",
+            "kku-blue-light": "#3b82f6",
+            "kku-blue-dark": "#1e3a8a",
           },
         },
-      };
-    </script>
-    <style>
-      .stat-card {
-        transition: all 0.3s ease;
-      }
-      .stat-card:hover {
-        transform: translateY(-5px);
-        box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1);
-      }
-      .profile-avatar {
-        width: 40px;
-        height: 40px;
-        background: linear-gradient(135deg, #1e40af, #3b82f6);
-        border-radius: 50%;
-        display: flex;
-        align-items: center;
-        justify-content: center;
-        color: white;
-        font-weight: bold;
-      }
-      .notification-badge {
-        position: absolute;
-        top: -5px;
-        right: -5px;
-        background: #ef4444;
-        color: white;
-        border-radius: 9999px;
-        width: 20px;
-        height: 20px;
-        display: flex;
-        align-items: center;
-        justify-content: center;
-        font-size: 0.75rem;
-        font-weight: bold;
-      }
-      .status-badge {
-        display: inline-block;
-        padding: 0.25rem 0.75rem;
-        border-radius: 9999px;
-        font-size: 0.75rem;
-        font-weight: 600;
-        text-transform: uppercase;
-      }
-      .status-approved {
-        background-color: #dcfce7;
-        color: #166534;
-      }
-      .status-pending {
-        background-color: #fef3c7;
-        color: #92400e;
-      }
-      .status-rejected {
-        background-color: #fee2e2;
-        color: #991b1b;
-      }
-      .chart-bar {
-        transition: all 0.3s ease;
-      }
-      .chart-bar:hover {
-        opacity: 0.8;
-      }
-      .status-cancelled {
-        background-color: #e5e7eb;
-        color: #6b7280;
-      }
-    </style>
-  </head>
-  <body class="bg-gray-50 font-sans">
-    <!-- Header -->
-    <header class="bg-kku-blue text-white shadow-lg">
-      <div class="container mx-auto px-4">
-        <div class="flex items-center justify-between py-4">
-          <!-- Logo & Title -->
-          <div class="flex items-center space-x-3">
-            <div
-              class="w-10 h-10 bg-white rounded-full flex items-center justify-center"
-            >
-              <span class="text-kku-blue font-bold text-lg">F</span>
-            </div>
-            <div>
-              <h1 class="text-xl font-bold">CPmail</h1>
-              <p class="text-blue-200 text-sm">College of Computing</p>
-            </div>
-          </div>
+      },
+    };
+  </script>
+  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
+  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
+  <style>
+    .stat-card {
+      transition: all 0.3s ease;
+    }
 
-          <!-- User Info & Actions -->
-          <div class="flex items-center space-x-4">
-            <!-- Notifications -->
-            <div class="relative">
-              <button
-                onclick="toggleNotifications()"
-                class="relative p-2 hover:bg-kku-blue-dark rounded-lg transition-colors"
-              >
-                <svg
-                  class="w-6 h-6"
-                  fill="none"
-                  stroke="currentColor"
-                  viewBox="0 0 24 24"
-                >
-                  <path
-                    stroke-linecap="round"
-                    stroke-linejoin="round"
-                    stroke-width="2"
-                    d="M15 17h5l-1.405-1.405A2.032 2.032 0 0118 14.158V11a6.002 6.002 0 00-4-5.659V5a2 2 0 10-4 0v.341C7.67 6.165 6 8.388 6 11v3.159c0 .538-.214 1.055-.595 1.436L4 17h5m6 0v1a3 3 0 11-6 0v-1m6 0H9"
-                  ></path>
-                </svg>
-                <% if (notifications.length > 0) { %>
-                <span class="notification-badge"
-                  ><%= notifications.length %></span
-                >
-                <% } %>
-              </button>
-            </div>
+    .stat-card:hover {
+      transform: translateY(-5px);
+      box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1);
+    }
 
-            <!-- User Profile -->
-            <div class="hidden md:flex items-center space-x-3">
-              <div class="profile-avatar">
-                <%= student.name.split(' ').map(n => n[0]).join('').substring(0,
-                2) %>
-              </div>
-              <div class="text-right">
-                <p class="text-sm font-medium"><%= student.name %></p>
-                <p class="text-blue-200 text-xs">
-                  ID: <%= student.universityId %>
-                </p>
-              </div>
-            </div>
+    .profile-avatar {
+      width: 40px;
+      height: 40px;
+      background: linear-gradient(135deg, #1e40af, #3b82f6);
+      border-radius: 50%;
+      display: flex;
+      align-items: center;
+      justify-content: center;
+      color: white;
+      font-weight: bold;
+    }
 
-            <!-- Logout Button -->
-            <form method="GET" action="/logout" style="display: inline">
-              <button
-                type="submit"
-                class="bg-red-600 hover:bg-red-700 px-4 py-2 rounded-md text-sm font-medium transition-colors"
-              >
-                Logout
-              </button>
-            </form>
-          </div>
-        </div>
-      </div>
-    </header>
-
-    <!-- Navigation -->
-    <nav class="bg-white shadow-sm border-b sticky top-0 z-10">
-      <div class="container mx-auto px-4">
-        <div class="flex space-x-8 overflow-x-auto">
-          <a
-            href="/student"
-            class="py-3 px-1 border-b-2 border-kku-blue text-kku-blue font-medium whitespace-nowrap"
-          >
-            Dashboard
-          </a>
-          <a
-            href="/student/submitform"
-            class="py-3 px-1 text-gray-500 hover:text-kku-blue font-medium whitespace-nowrap transition-colors"
-          >
-            Submit Form
-          </a>
-          <a
-            href="/student/formhistory"
-            class="py-3 px-1 text-gray-500 hover:text-kku-blue font-medium whitespace-nowrap transition-colors"
-          >
-            Form History
-          </a>
-          <a
-            href="/student/profile"
-            class="py-3 px-1 text-gray-500 hover:text-kku-blue font-medium whitespace-nowrap transition-colors"
-          >
-            Profile Settings
-          </a>
-        </div>
-      </div>
-    </nav>
-
-    <!-- Notifications Dropdown -->
-    <div
-      id="notificationDropdown"
-      class="hidden fixed top-16 right-4 w-96 bg-white rounded-lg shadow-xl border border-gray-200 z-50 max-h-96 overflow-y-auto"
-    >
-      <div class="p-4 border-b border-gray-200">
-        <h3 class="font-semibold text-gray-900">Notifications</h3>
-      </div>
-      <div class="divide-y divide-gray-200">
-        <% if (notifications.length === 0) { %>
-        <div class="p-4 text-center text-gray-500">
-          <svg
-            class="w-12 h-12 mx-auto mb-2 text-gray-400"
-            fill="none"
-            stroke="currentColor"
-            viewBox="0 0 24 24"
-          >
-            <path
-              stroke-linecap="round"
-              stroke-linejoin="round"
-              stroke-width="2"
-              d="M20 13V6a2 2 0 00-2-2H6a2 2 0 00-2 2v7m16 0v5a2 2 0 01-2 2H6a2 2 0 01-2-2v-5m16 0h-2.586a1 1 0 00-.707.293l-2.414 2.414a1 1 0 01-.707.293h-3.172a1 1 0 01-.707-.293l-2.414-2.414A1 1 0 006.586 13H4"
-            ></path>
-          </svg>
-          <p class="text-sm">No notifications</p>
-        </div>
-        <% } else { %> <% notifications.forEach(n => { %>
-        <div class="p-4 hover:bg-gray-50 cursor-pointer">
-          <p class="text-sm text-gray-900"><%= n.message %></p>
-          <p class="text-xs text-gray-500 mt-1">
-            <%= new Date(n.createdAt).toLocaleString() %>
-          </p>
-        </div>
-        <% }) %> <% } %>
-      </div>
-    </div>
-
-    <!-- Main Content -->
-    <main class="container mx-auto px-4 py-6">
-      <!-- Welcome Section -->
-      <div class="mb-6">
-        <h2 class="text-2xl font-bold text-gray-900">
-          Welcome back, <%= student.name.split(' ')[0] %>! 👋
+    .notification-badge {
+      position: absolute;
+      top: -5px;
+      right: -5px;
+      background: #ef4444;
+      color: white;
+      border-radius: 9999px;
+      width: 20px;
+      height: 20px;
+      display: flex;
+      align-items: center;
+      justify-content: center;
+      font-size: 0.75rem;
+      font-weight: bold;
+    }
+
+    .status-badge {
+      display: inline-block;
+      padding: 0.25rem 0.75rem;
+      border-radius: 9999px;
+      font-size: 0.75rem;
+      font-weight: 600;
+      text-transform: uppercase;
+    }
+
+    .status-approved {
+      background-color: #dcfce7;
+      color: #166534;
+    }
+
+    .status-pending {
+      background-color: #fef3c7;
+      color: #92400e;
+    }
+
+    .status-rejected {
+      background-color: #fee2e2;
+      color: #991b1b;
+    }
+
+    .status-cancelled {
+      background-color: #e5e7eb;
+      color: #6b7280;
+    }
+
+    .chart-bar {
+      transition: all 0.3s ease;
+    }
+
+    .chart-bar:hover {
+      opacity: 0.8;
+    }
+
+    .notification {
+      position: relative;
+      cursor: pointer;
+      font-size: 20px;
+    }
+
+    .notification .bell {
+      font-size: 20px;
+    }
+
+    .notification .badge {
+      position: absolute;
+      top: -6px;
+      right: -8px;
+      background: red;
+      color: white;
+      border-radius: 50%;
+      font-size: 12px;
+      padding: 2px 6px;
+    }
+  </style>
+</head>
+
+<%- include('../partials/navbar', { activeMenu: 'student' }) %>
+
+  <!-- Main Content -->
+  <main class="container mx-auto px-4 py-6">
+
+    <!-- Welcome Section -->
+    <div class="mb-6">
+      <h2 class="text-2xl font-bold text-gray-900">
+        ยินดีต้อนรับกลับมา, <%= student.name.split(' ')[0] %>! 👋
         </h2>
         <p class="text-gray-600">
-          Here's what's happening with your forms today.
+          สรุปความเคลื่อนไหวของแบบฟอร์มของคุณวันนี้
         </p>
       </div>
 
       <!-- Statistics Cards -->
-      <section
-        class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8"
-      >
-        <% const approvedCount = recentForms.filter(f => f.status ===
-        'approved').length; const pendingCount = recentForms.filter(f =>
-        f.status === 'pending').length; const rejectedCount =
-        recentForms.filter(f => f.status === 'rejected').length; const
-        cancelledCount = recentForms.filter(f => f.status ===
-        'cancelled').length; const totalCount = recentForms.length; %>
-
-        <!-- Approved -->
-        <div
-          class="stat-card bg-white rounded-lg shadow-md p-6 border-l-4 border-green-500"
-        >
-          <div class="flex items-center justify-between">
-            <div>
-              <p class="text-gray-600 text-sm font-medium">Approved</p>
-              <p class="text-3xl font-bold text-gray-900 mt-2">
-                <%= approvedCount %>
-              </p>
-            </div>
-            <div class="bg-green-100 p-3 rounded-full">
-              <svg
-                class="w-8 h-8 text-green-600"
-                fill="none"
-                stroke="currentColor"
-                viewBox="0 0 24 24"
-              >
-                <path
-                  stroke-linecap="round"
-                  stroke-linejoin="round"
-                  stroke-width="2"
-                  d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"
-                ></path>
-              </svg>
-            </div>
-          </div>
-          <p class="text-xs text-gray-500 mt-2">
-            <%= totalCount > 0 ? Math.round((approvedCount / totalCount) * 100)
-            : 0 %>% of total
-          </p>
-        </div>
-
-        <!-- Pending -->
-        <div
-          class="stat-card bg-white rounded-lg shadow-md p-6 border-l-4 border-yellow-500"
-        >
-          <div class="flex items-center justify-between">
-            <div>
-              <p class="text-gray-600 text-sm font-medium">Pending</p>
-              <p class="text-3xl font-bold text-gray-900 mt-2">
-                <%= pendingCount %>
-              </p>
-            </div>
-            <div class="bg-yellow-100 p-3 rounded-full">
-              <svg
-                class="w-8 h-8 text-yellow-600"
-                fill="none"
-                stroke="currentColor"
-                viewBox="0 0 24 24"
-              >
-                <path
-                  stroke-linecap="round"
-                  stroke-linejoin="round"
-                  stroke-width="2"
-                  d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"
-                ></path>
-              </svg>
-            </div>
-          </div>
-          <p class="text-xs text-gray-500 mt-2">
-            <%= totalCount > 0 ? Math.round((pendingCount / totalCount) * 100) :
-            0 %>% of total
-          </p>
-        </div>
-
-        <!-- Rejected -->
-        <div
-          class="stat-card bg-white rounded-lg shadow-md p-6 border-l-4 border-red-500"
-        >
-          <div class="flex items-center justify-between">
-            <div>
-              <p class="text-gray-600 text-sm font-medium">Rejected</p>
-              <p class="text-3xl font-bold text-gray-900 mt-2">
-                <%= rejectedCount %>
-              </p>
-            </div>
-            <div class="bg-red-100 p-3 rounded-full">
-              <svg
-                class="w-8 h-8 text-red-600"
-                fill="none"
-                stroke="currentColor"
-                viewBox="0 0 24 24"
-              >
-                <path
-                  stroke-linecap="round"
-                  stroke-linejoin="round"
-                  stroke-width="2"
-                  d="M10 14l2-2m0 0l2-2m-2 2l-2-2m2 2l2 2m7-2a9 9 0 11-18 0 9 9 0 0118 0z"
-                ></path>
-              </svg>
-            </div>
-          </div>
-          <p class="text-xs text-gray-500 mt-2">
-            <%= totalCount > 0 ? Math.round((rejectedCount / totalCount) * 100)
-            : 0 %>% of total
-          </p>
-        </div>
-
-        <!-- Total Forms -->
-        <div
-          class="stat-card bg-white rounded-lg shadow-md p-6 border-l-4 border-blue-500"
-        >
-          <div class="flex items-center justify-between">
-            <div>
-              <p class="text-gray-600 text-sm font-medium">Total Forms</p>
-              <p class="text-3xl font-bold text-gray-900 mt-2">
-                <%= totalCount %>
-              </p>
-            </div>
-            <div class="bg-blue-100 p-3 rounded-full">
-              <svg
-                class="w-8 h-8 text-blue-600"
-                fill="none"
-                stroke="currentColor"
-                viewBox="0 0 24 24"
-              >
-                <path
-                  stroke-linecap="round"
-                  stroke-linejoin="round"
-                  stroke-width="2"
-                  d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"
-                ></path>
-              </svg>
-            </div>
-          </div>
-          <p class="text-xs text-gray-500 mt-2">All submitted forms</p>
-        </div>
-      </section>
-
-      <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
-        <!-- Recent Forms - Main Section -->
-        <div class="lg:col-span-2">
-          <section class="bg-white rounded-lg shadow-md">
-            <div
-              class="p-6 border-b border-gray-200 flex items-center justify-between"
-            >
+      <section class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8">
+        <%
+        const approvedCount=recentForms.filter(f=> f.status==='approved').length; const
+          pendingCount=recentForms.filter(f=> f.status==='pending').length;
+          const rejectedCount = recentForms.filter(f=> f.status==='rejected').length;
+          const cancelledCount = recentForms.filter(f=> f.status==='cancelled').length;
+          const totalCount = recentForms.length; %>
+
+          <!-- Approved -->
+          <div class="stat-card bg-white rounded-lg shadow-md p-6 border-l-4 border-green-500">
+            <div class="flex items-center justify-between">
               <div>
-                <h3 class="text-lg font-semibold text-gray-900">
-                  Recent Forms
-                </h3>
-                <p class="text-sm text-gray-600 mt-1">
-                  Track and manage your form submissions
+                <p class="text-gray-600 text-sm font-medium">อนุมัติ</p>
+                <p class="text-3xl font-bold text-gray-900 mt-2">
+                  <%= approvedCount %>
                 </p>
               </div>
-              <a
-                href="/student/submitform"
-                class="bg-kku-blue hover:bg-kku-blue-dark text-white px-4 py-2 rounded-lg text-sm font-medium transition-colors inline-flex items-center"
-              >
-                <svg
-                  class="w-5 h-5 mr-2"
-                  fill="none"
-                  stroke="currentColor"
-                  viewBox="0 0 24 24"
-                >
-                  <path
-                    stroke-linecap="round"
-                    stroke-linejoin="round"
-                    stroke-width="2"
-                    d="M12 4v16m8-8H4"
-                  ></path>
+              <div class="bg-green-100 p-3 rounded-full">
+                <svg class="w-8 h-8 text-green-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
+                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
+                    d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                 </svg>
-                Submit New Form
-              </a>
-            </div>
-
-            <div class="overflow-x-auto">
-              <table class="w-full">
-                <thead class="bg-gray-50 border-b border-gray-200">
-                  <tr>
-                    <th
-                      class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"
-                    >
-                      Form Type
-                    </th>
-                    <th
-                      class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"
-                    >
-                      Date Submitted
-                    </th>
-                    <th
-                      class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"
-                    >
-                      Status
-                    </th>
-                    <th
-                      class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"
-                    >
-                      Actions
-                    </th>
-                  </tr>
-                </thead>
-                <tbody class="bg-white divide-y divide-gray-200">
-                  <% if (recentForms.length === 0) { %>
-                  <tr>
-                    <td colspan="4" class="px-6 py-12 text-center">
-                      <svg
-                        class="w-16 h-16 mx-auto text-gray-400 mb-4"
-                        fill="none"
-                        stroke="currentColor"
-                        viewBox="0 0 24 24"
-                      >
-                        <path
-                          stroke-linecap="round"
-                          stroke-linejoin="round"
-                          stroke-width="2"
-                          d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"
-                        ></path>
-                      </svg>
-                      <p class="text-gray-500 text-lg font-medium mb-2">
-                        No forms found
-                      </p>
-                      <p class="text-gray-400 text-sm mb-4">
-                        Get started by submitting your first form
-                      </p>
-                      <a
-                        href="/student/submitform"
-                        class="inline-block bg-kku-blue hover:bg-kku-blue-dark text-white px-6 py-2 rounded-lg text-sm font-medium transition-colors"
-                      >
-                        Submit New Form
-                      </a>
-                    </td>
-                  </tr>
-                  <% } else { %> <% recentForms
-                  .sort((a, b) => new Date(b.createdAt) - new Date(a.createdAt))
-                  .slice(0, 9)
-                  .forEach(f => { %>
-                  <tr class="hover:bg-gray-50 transition-colors">
-                    <td class="px-6 py-4 whitespace-nowrap">
-                      <div class="flex items-center">
-                        <div
-                          class="flex-shrink-0 h-10 w-10 bg-blue-100 rounded-lg flex items-center justify-center"
-                        >
-                          <svg
-                            class="w-6 h-6 text-blue-600"
-                            fill="none"
-                            stroke="currentColor"
-                            viewBox="0 0 24 24"
-                          >
-                            <path
-                              stroke-linecap="round"
-                              stroke-linejoin="round"
-                              stroke-width="2"
-                              d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"
-                            ></path>
-                          </svg>
-                        </div>
-                        <div class="ml-4">
-                          <div class="text-sm font-medium text-gray-900">
-                            <%= f.template?.title || "Form" %>
-                          </div>
-                        </div>
-                      </div>
-                    </td>
-                    <td class="px-6 py-4 whitespace-nowrap">
-                     <div class="text-sm text-gray-900">
-                      <%= new Date(f.createdAt).toLocaleDateString('en-US',
-                          { year:'numeric', month:'short', day:'numeric' }) %>
-                    </div>
-                    <div class="text-xs text-gray-500">
-                      <%= new Date(f.createdAt).toLocaleTimeString('en-US',
-                          { hour:'2-digit', minute:'2-digit' }) %>
-                    </div>
-                    </td>
-                    <td class="px-6 py-4 whitespace-nowrap">
-                      <span class="status-badge status-<%= f.status %>">
-                        <%= f.status %>
-                      </span>
-                    </td>
-                    <td class="px-6 py-4 whitespace-nowrap text-sm font-medium">
-                      <a
-                        href="/forms/view/<%= f._id %>"
-                        class="text-kku-blue hover:text-kku-blue-dark mr-3 inline-flex items-center"
-                      >
-                        <svg
-                          class="w-4 h-4 mr-1"
-                          fill="none"
-                          stroke="currentColor"
-                          viewBox="0 0 24 24"
-                        >
-                          <path
-                            stroke-linecap="round"
-                            stroke-linejoin="round"
-                            stroke-width="2"
-                            d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"
-                          ></path>
-                          <path
-                            stroke-linecap="round"
-                            stroke-linejoin="round"
-                            stroke-width="2"
-                            d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"
-                          ></path>
-                        </svg>
-                        View
-                      </a>
-                      <% if (f.status === "pending") { %>
-                      <a
-                        href="/forms/edit/<%= f._id %>"
-                        class="text-gray-600 hover:text-gray-900 inline-flex items-center"
-                      >
-                        <svg
-                          class="w-4 h-4 mr-1"
-                          fill="none"
-                          stroke="currentColor"
-                          viewBox="0 0 24 24"
-                        >
-                          <path
-                            stroke-linecap="round"
-                            stroke-linejoin="round"
-                            stroke-width="2"
-                            d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"
-                          ></path>
-                        </svg>
-                        Edit
-                      </a>
-                      <% } %>
-                    </td>
-                  </tr>
-                  <% }) %> <% } %>
-                </tbody>
-              </table>
+              </div>
             </div>
+            <p class="text-xs text-gray-500 mt-2">
+              <%= totalCount> 0 ? Math.round((approvedCount / totalCount) * 100) : 0 %>% ของทั้งหมด
+            </p>
+          </div>
 
-            <% if (recentForms.length > 5) { %>
-            <div class="p-4 border-t border-gray-200 text-center">
-              <a
-                href="/student/formhistory"
-                class="text-kku-blue hover:text-kku-blue-dark font-medium text-sm"
-              >
-                View All Forms →
-              </a>
-            </div>
-            <% } %>
-          </section>
-        </div>
-
-        <!-- Sidebar -->
-        <div class="lg:col-span-1 space-y-6">
-          <!-- Daily Summary -->
-          <section class="bg-white rounded-lg shadow-md p-6">
-            <h3
-              class="text-lg font-semibold text-gray-900 mb-4 flex items-center"
-            >
-              <svg
-                class="w-5 h-5 mr-2 text-kku-blue"
-                fill="none"
-                stroke="currentColor"
-                viewBox="0 0 24 24"
-              >
-                <path
-                  stroke-linecap="round"
-                  stroke-linejoin="round"
-                  stroke-width="2"
-                  d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"
-                ></path>
-              </svg>
-              Today's Summary
-            </h3>
-            <% const today = new Date().toDateString();
-            const todayForms = recentForms.filter(
-              f => new Date(f.createdAt).toDateString() === today
-            ); %>
-            <div class="space-y-3">
-              <div
-                class="flex items-center justify-between p-3 bg-gray-50 rounded-lg"
-              >
-                <span class="text-sm text-gray-600">Date</span>
-                <span class="text-sm font-medium text-gray-900">
-                  <%= new Date().toLocaleDateString('en-US', { month: 'short',
-                  day: 'numeric', year: 'numeric' }) %>
-                </span>
-              </div>
-              <div
-                class="flex items-center justify-between p-3 bg-blue-50 rounded-lg"
-              >
-                <span class="text-sm text-gray-600">Forms Submitted</span>
-                <span class="text-sm font-bold text-blue-600"
-                  ><%= todayForms.length %></span
-                >
-              </div>
-              <div
-                class="flex items-center justify-between p-3 bg-yellow-50 rounded-lg"
-              >
-                <span class="text-sm text-gray-600">Pending Review</span>
-                <span class="text-sm font-bold text-yellow-600"
-                  ><%= pendingCount %></span
-                >
+          <!-- Pending -->
+          <div class="stat-card bg-white rounded-lg shadow-md p-6 border-l-4 border-yellow-500">
+            <div class="flex items-center justify-between">
+              <div>
+                <p class="text-gray-600 text-sm font-medium">รอดำเนินการ</p>
+                <p class="text-3xl font-bold text-gray-900 mt-2">
+                  <%= pendingCount %>
+                </p>
               </div>
-              <div
-                class="flex items-center justify-between p-3 bg-green-50 rounded-lg"
-              >
-                <span class="text-sm text-gray-600">Responses Received</span>
-                <span class="text-sm font-bold text-green-600">
-                  <%= recentForms.filter(f => f.status !== 'pending').length %>
-                </span>
+              <div class="bg-yellow-100 p-3 rounded-full">
+                <svg class="w-8 h-8 text-yellow-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
+                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
+                    d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"></path>
+                </svg>
               </div>
             </div>
-          </section>
+            <p class="text-xs text-gray-500 mt-2">
+              <%= totalCount>0 ? Math.round((pendingCount/totalCount)*100) : 0 %>% ของทั้งหมด
+            </p>
+          </div>
 
-          <!-- Quick Actions -->
-          <section class="bg-white rounded-lg shadow-md p-6">
-            <h3 class="text-lg font-semibold text-gray-900 mb-4">
-              Quick Actions
-            </h3>
-            <div class="space-y-3">
-              <a
-                href="/student/submitform"
-                class="block w-full bg-kku-blue hover:bg-kku-blue-dark text-white px-4 py-3 rounded-lg text-sm font-medium transition-colors text-center"
-              >
-                <svg
-                  class="w-5 h-5 inline mr-2"
-                  fill="none"
-                  stroke="currentColor"
-                  viewBox="0 0 24 24"
-                >
-                  <path
-                    stroke-linecap="round"
-                    stroke-linejoin="round"
-                    stroke-width="2"
-                    d="M12 4v16m8-8H4"
-                  ></path>
-                </svg>
-                Submit New Form
-              </a>
-              <a
-                href="/student/formhistory"
-                class="block w-full bg-gray-100 hover:bg-gray-200 text-gray-700 px-4 py-3 rounded-lg text-sm font-medium transition-colors text-center"
-              >
-                <svg
-                  class="w-5 h-5 inline mr-2"
-                  fill="none"
-                  stroke="currentColor"
-                  viewBox="0 0 24 24"
-                >
-                  <path
-                    stroke-linecap="round"
-                    stroke-linejoin="round"
-                    stroke-width="2"
-                    d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"
-                  ></path>
-                </svg>
-                View All Forms
-              </a>
-              <a
-                href="/student/profile"
-                class="block w-full bg-gray-100 hover:bg-gray-200 text-gray-700 px-4 py-3 rounded-lg text-sm font-medium transition-colors text-center"
-              >
-                <svg
-                  class="w-5 h-5 inline mr-2"
-                  fill="none"
-                  stroke="currentColor"
-                  viewBox="0 0 24 24"
-                >
-                  <path
-                    stroke-linecap="round"
-                    stroke-linejoin="round"
-                    stroke-width="2"
-                    d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"
-                  ></path>
+          <!-- Rejected -->
+          <div class="stat-card bg-white rounded-lg shadow-md p-6 border-l-4 border-red-500">
+            <div class="flex items-center justify-between">
+              <div>
+                <p class="text-gray-600 text-sm font-medium">ถูกปฏิเสธ</p>
+                <p class="text-3xl font-bold text-gray-900 mt-2">
+                  <%= rejectedCount %>
+                </p>
+              </div>
+              <div class="bg-red-100 p-3 rounded-full">
+                <svg class="w-8 h-8 text-red-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
+                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
+                    d="M10 14l2-2m0 0l2-2m-2 2l-2-2m2 2l2 2m7-2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                 </svg>
-                Profile Settings
-              </a>
+              </div>
             </div>
-          </section>
+            <p class="text-xs text-gray-500 mt-2">
+              <%= totalCount>0 ? Math.round((rejectedCount/totalCount)*100) : 0 %>% ของทั้งหมด
+            </p>
+          </div>
 
-          <!-- Status Chart -->
-          <section class="bg-white rounded-lg shadow-md p-6">
-            <h3 class="text-lg font-semibold text-gray-900 mb-4">
-              Status Overview
-            </h3>
-            <div class="space-y-4">
-              <% if (totalCount > 0) { %>
+          <!-- Total Forms -->
+          <div class="stat-card bg-white rounded-lg shadow-md p-6 border-l-4 border-blue-500">
+            <div class="flex items-center justify-between">
               <div>
-                <div class="flex justify-between items-center mb-1">
-                  <span class="text-sm text-gray-600">Approved</span>
-                  <span class="text-sm font-medium text-green-600"
-                    ><%= Math.round((approvedCount / totalCount) * 100)
-                    %>%</span
-                  >
-                </div>
-                <div class="w-full bg-gray-200 rounded-full h-2">
-                  <div
-                    class="chart-bar bg-green-500 h-2 rounded-full"
-                    style="width: <%= (approvedCount / totalCount) * 100 %>%"
-                  ></div>
-                </div>
+                <p class="text-gray-600 text-sm font-medium">แบบฟอร์มทั้งหมด</p>
+                <p class="text-3xl font-bold text-gray-900 mt-2">
+                  <%= totalCount %>
+                </p>
               </div>
-              <div>
-                <div class="flex justify-between items-center mb-1">
-                  <span class="text-sm text-gray-600">Pending</span>
-                  <span class="text-sm font-medium text-yellow-600"
-                    ><%= Math.round((pendingCount / totalCount) * 100) %>%</span
-                  >
-                </div>
-                <div class="w-full bg-gray-200 rounded-full h-2">
-                  <div
-                    class="chart-bar bg-yellow-500 h-2 rounded-full"
-                    style="width: <%= (pendingCount / totalCount) * 100 %>%"
-                  ></div>
-                </div>
+              <div class="bg-blue-100 p-3 rounded-full">
+                <svg class="w-8 h-8 text-blue-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
+                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
+                    d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z">
+                  </path>
+                </svg>
               </div>
-              <div>
-                <div class="flex justify-between items-center mb-1">
-                  <span class="text-sm text-gray-600">Rejected</span>
-                  <span class="text-sm font-medium text-red-600"
-                    ><%= Math.round((rejectedCount / totalCount) * 100)
-                    %>%</span
-                  >
+            </div>
+            <p class="text-xs text-gray-500 mt-2">ทุกรายการที่คุณส่ง</p>
+          </div>
+          </section>
+
+          <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
+            <!-- Recent Forms - Main Section -->
+            <div class="lg:col-span-2">
+              <section class="bg-white rounded-lg shadow-md">
+                <div class="p-6 border-b border-gray-200 flex items-center justify-between">
+                  <div>
+                    <h3 class="text-lg font-semibold text-gray-900">แบบฟอร์มล่าสุด</h3>
+                    <p class="text-sm text-gray-600 mt-1">ติดตามและจัดการการส่งแบบฟอร์มของคุณ</p>
+                  </div>
+                  <a href="/student/forms/submit"
+                    class="bg-kku-blue hover:bg-kku-blue-dark text-white px-4 py-2 rounded-lg text-sm font-medium transition-colors inline-flex items-center">
+                    <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
+                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"></path>
+                    </svg>
+                    ยื่นแบบฟอร์ม
+                  </a>
                 </div>
-                <div class="w-full bg-gray-200 rounded-full h-2">
-                  <div
-                    class="chart-bar bg-red-500 h-2 rounded-full"
-                    style="width: <%= (rejectedCount / totalCount) * 100 %>%"
-                  ></div>
+
+                <div class="overflow-x-auto">
+                  <table class="w-full">
+                    <thead class="bg-gray-50 border-b border-gray-200">
+                      <tr>
+                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
+                          ประเภทแบบฟอร์ม
+                        </th>
+                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
+                          วันที่ส่ง
+                        </th>
+                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
+                          สถานะ
+                        </th>
+                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
+                          การดำเนินการ
+                        </th>
+                      </tr>
+                    </thead>
+                    <tbody class="bg-white divide-y divide-gray-200">
+                      <% if (recentForms.length===0) { %>
+                        <tr>
+                          <td colspan="4" class="px-6 py-12 text-center">
+                            <svg class="w-16 h-16 mx-auto text-gray-400 mb-4" fill="none" stroke="currentColor"
+                              viewBox="0 0 24 24">
+                              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
+                                d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z">
+                              </path>
+                            </svg>
+                            <p class="text-gray-500 text-lg font-medium mb-2">ไม่พบแบบฟอร์ม</p>
+                            <p class="text-gray-400 text-sm mb-4">เริ่มต้นโดยการยื่นแบบฟอร์มแรกของคุณ</p>
+                            <a href="/student/forms/submit"
+                              class="inline-block bg-kku-blue hover:bg-kku-blue-dark text-white px-6 py-2 rounded-lg text-sm font-medium transition-colors">
+                              ยื่นแบบฟอร์ม
+                            </a>
+                          </td>
+                        </tr>
+                        <% } else { %>
+                          <% recentForms .sort((a,b)=> new Date(b.createdAt) - new Date(a.createdAt))
+                            .slice(0,9)
+                            .forEach(f => { %>
+                            <tr class="hover:bg-gray-50 transition-colors">
+                              <td class="px-6 py-4 whitespace-nowrap">
+                                <div class="flex items-center">
+                                  <div
+                                    class="flex-shrink-0 h-10 w-10 bg-blue-100 rounded-lg flex items-center justify-center">
+                                    <svg class="w-6 h-6 text-blue-600" fill="none" stroke="currentColor"
+                                      viewBox="0 0 24 24">
+                                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
+                                        d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z">
+                                      </path>
+                                    </svg>
+                                  </div>
+                                  <div class="ml-4">
+                                    <div class="text-sm font-medium text-gray-900">
+                                      <%= f.template?.title || "แบบฟอร์ม" %>
+                                    </div>
+                                  </div>
+                                </div>
+                              </td>
+                              <td class="px-6 py-4 whitespace-nowrap">
+                                <div class="text-sm text-gray-900">
+                                  <%= new Date(f.createdAt).toLocaleDateString('th-TH', { year: 'numeric' ,
+                                    month: 'short' , day: 'numeric' , timeZone: 'Asia/Bangkok' }) %>
+                                    <%= new Date(f.createdAt).toLocaleTimeString('th-TH', { hour: '2-digit' ,
+                                      minute: '2-digit' , timeZone: 'Asia/Bangkok' }) %>
+                                </div>
+                              </td>
+                              <td class="px-6 py-4 whitespace-nowrap">
+                                <span class="status-badge status-<%= f.status %>">
+                                  <%= ({ approved:'อนุมัติ', pending:'รอดำเนินการ', rejected:'ถูกปฏิเสธ',
+                                    cancelled:'ยกเลิก' })[f.status] || f.status %>
+                                </span>
+                              </td>
+                              <td class="px-6 py-4 whitespace-nowrap text-sm font-medium">
+                                <a href="/student/forms?id=<%= f._id %>"
+                                  class="text-kku-blue hover:text-kku-blue-dark mr-3 inline-flex items-center">
+                                  <svg class="w-4 h-4 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
+                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
+                                      d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"></path>
+                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
+                                      d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z">
+                                    </path>
+                                  </svg>
+                                  ดู
+                                </a>
+                              </td>
+                            </tr>
+                            <% }) %>
+                              <% } %>
+                    </tbody>
+                  </table>
                 </div>
-              </div>
-              <div>
-                <div class="flex justify-between items-center mb-1">
-                  <span class="text-sm text-gray-600">Cancelled</span>
-                  <span class="text-sm font-medium text-gray-500">
-                    <%= Math.round((cancelledCount / totalCount) * 100) %>%
-                  </span>
+
+                <% if (recentForms.length>5) { %>
+                  <div class="p-4 border-t border-gray-200 text-center">
+                    <a href="/student/formhistory" class="text-kku-blue hover:text-kku-blue-dark font-medium text-sm">
+                      แบบฟอร์มทั้งหมด →
+                    </a>
+                  </div>
+                  <% } %>
+              </section>
+            </div>
+
+            <!-- Sidebar -->
+            <div class="lg:col-span-1 space-y-6">
+              <!-- Daily Summary -->
+              <section class="bg-white rounded-lg shadow-md p-6">
+                <h3 class="text-lg font-semibold text-gray-900 mb-4 flex items-center">
+                  <svg class="w-5 h-5 mr-2 text-kku-blue" fill="none" stroke="currentColor" viewBox="0 0 24 24">
+                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
+                      d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"></path>
+                  </svg>
+                  สรุปวันนี้
+                </h3>
+                <% const today=new Date().toDateString(); const todayForms=recentForms.filter(f=> new
+                  Date(f.createdAt).toDateString()===today); %>
+                  <div class="space-y-3">
+                    <div class="flex items-center justify-between p-3 bg-gray-50 rounded-lg">
+                      <span class="text-sm text-gray-600">วันที่</span>
+                      <span class="text-sm font-medium text-gray-900">
+                        <%= new Date().toLocaleDateString('th-TH', { day:'numeric', month:'short', year:'numeric' }) %>
+                      </span>
+                    </div>
+                    <div class="flex items-center justify-between p-3 bg-blue-50 rounded-lg">
+                      <span class="text-sm text-gray-600">แบบฟอร์มที่ส่ง</span>
+                      <span class="text-sm font-bold text-blue-600">
+                        <%= todayForms.length %>
+                      </span>
+                    </div>
+                    <div class="flex items-center justify-between p-3 bg-yellow-50 rounded-lg">
+                      <span class="text-sm text-gray-600">รอการพิจารณา</span>
+                      <span class="text-sm font-bold text-yellow-600">
+                        <%= pendingCount %>
+                      </span>
+                    </div>
+                    <div class="flex items-center justify-between p-3 bg-green-50 rounded-lg">
+                      <span class="text-sm text-gray-600">ได้รับผลการพิจารณาแล้ว</span>
+                      <span class="text-sm font-bold text-green-600">
+                        <%= recentForms.filter(f=> f.status!=='pending').length %>
+                      </span>
+                    </div>
+                  </div>
+              </section>
+
+              <!-- Quick Actions -->
+              <section class="bg-white rounded-lg shadow-md p-6">
+                <h3 class="text-lg font-semibold text-gray-900 mb-4">ทำรายการด่วน</h3>
+                <div class="space-y-3">
+                  <a href="/student/forms/submit"
+                    class="block w-full bg-kku-blue hover:bg-kku-blue-dark text-white px-4 py-3 rounded-lg text-sm font-medium transition-colors text-center">
+                    <svg class="w-5 h-5 inline mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
+                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"></path>
+                    </svg>
+                    ยื่นแบบฟอร์ม
+                  </a>
+                  <a href="/student/formhistory"
+                    class="block w-full bg-gray-100 hover:bg-gray-200 text-gray-700 px-4 py-3 rounded-lg text-sm font-medium transition-colors text-center">
+                    <svg class="w-5 h-5 inline mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
+                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
+                        d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"></path>
+                    </svg>
+                    แบบฟอร์มทั้งหมด
+                  </a>
+                  <a href="/student/profile"
+                    class="block w-full bg-gray-100 hover:bg-gray-200 text-gray-700 px-4 py-3 rounded-lg text-sm font-medium transition-colors text-center">
+                    <svg class="w-5 h-5 inline mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
+                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
+                        d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"></path>
+                    </svg>
+                    โปรไฟล์นักศึกษา 
+                  </a>
                 </div>
-                <div class="w-full bg-gray-200 rounded-full h-2">
-                  <div
-                    class="chart-bar bg-gray-400 h-2 rounded-full"
-                    style="width: <%= (cancelledCount / totalCount) * 100 %>%"
-                  ></div>
+              </section>
+
+              <!-- Status Chart -->
+              <section class="bg-white rounded-lg shadow-md p-6">
+                <h3 class="text-lg font-semibold text-gray-900 mb-4">ภาพรวมสถานะ</h3>
+                <div class="space-y-4">
+                  <% if (totalCount>0) { %>
+                    <div>
+                      <div class="flex justify-between items-center mb-1">
+                        <span class="text-sm text-gray-600">อนุมัติ</span>
+                        <span class="text-sm font-medium text-green-600">
+                          <%= Math.round((approvedCount/totalCount)*100) %>%
+                        </span>
+                      </div>
+                      <div class="w-full bg-gray-200 rounded-full h-2">
+                        <div class="chart-bar bg-green-500 h-2 rounded-full"
+                          style="width: <%= (approvedCount/totalCount)*100 %>%"></div>
+                      </div>
+                    </div>
+                    <div>
+                      <div class="flex justify-between items-center mb-1">
+                        <span class="text-sm text-gray-600">รอดำเนินการ</span>
+                        <span class="text-sm font-medium text-yellow-600">
+                          <%= Math.round((pendingCount/totalCount)*100) %>%
+                        </span>
+                      </div>
+                      <div class="w-full bg-gray-200 rounded-full h-2">
+                        <div class="chart-bar bg-yellow-500 h-2 rounded-full"
+                          style="width: <%= (pendingCount/totalCount)*100 %>%"></div>
+                      </div>
+                    </div>
+                    <div>
+                      <div class="flex justify-between items-center mb-1">
+                        <span class="text-sm text-gray-600">ถูกปฏิเสธ</span>
+                        <span class="text-sm font-medium text-red-600">
+                          <%= Math.round((rejectedCount/totalCount)*100) %>%
+                        </span>
+                      </div>
+                      <div class="w-full bg-gray-200 rounded-full h-2">
+                        <div class="chart-bar bg-red-500 h-2 rounded-full"
+                          style="width: <%= (rejectedCount/totalCount)*100 %>%"></div>
+                      </div>
+                    </div>
+                    <div>
+                      <div class="flex justify-between items-center mb-1">
+                        <span class="text-sm text-gray-600">ยกเลิก</span>
+                        <span class="text-sm font-medium text-gray-500">
+                          <%= Math.round((cancelledCount/totalCount)*100) %>%
+                        </span>
+                      </div>
+                      <div class="w-full bg-gray-200 rounded-full h-2">
+                        <div class="chart-bar bg-gray-400 h-2 rounded-full"
+                          style="width: <%= (cancelledCount/totalCount)*100 %>%"></div>
+                      </div>
+                    </div>
+                    <% } else { %>
+                      <p class="text-sm text-gray-500 text-center py-4">ยังไม่มีข้อมูล</p>
+                      <% } %>
                 </div>
-              </div>
-              <% } else { %>
-              <p class="text-sm text-gray-500 text-center py-4">
-                No data available
-              </p>
-              <% } %>
+              </section>
             </div>
-          </section>
-        </div>
-      </div>
-    </main>
-
-    <!-- Footer -->
-    <footer class="bg-gray-100 text-gray-600 py-6 text-center text-sm mt-12">
-      <div class="container mx-auto px-4">
-        <p>
-          &copy; 2025 Faculty of Computer Science, Khon Kaen University. All
-          rights reserved.
-        </p>
-      </div>
-    </footer>
+          </div>
+  </main>
+
+  <script>
+    // Toggle notifications dropdown
+    function toggleNotifications() {
+      const dropdown = document.getElementById("notificationDropdown");
+      dropdown.classList.toggle("hidden");
+    }
 
-    <script>
-      // Toggle notifications dropdown
-      function toggleNotifications() {
-        const dropdown = document.getElementById("notificationDropdown");
-        dropdown.classList.toggle("hidden");
+    // Close notifications when clicking outside
+    document.addEventListener("click", function (event) {
+      const dropdown = document.getElementById("notificationDropdown");
+      const notificationBtn = event.target.closest('button[onclick="toggleNotifications()"]');
+      if (!dropdown.contains(event.target) && !notificationBtn) {
+        dropdown.classList.add("hidden");
       }
+    });
 
-      // Close notifications when clicking outside
-      document.addEventListener("click", function (event) {
-        const dropdown = document.getElementById("notificationDropdown");
-        const notificationBtn = event.target.closest(
-          'button[onclick="toggleNotifications()"]'
-        );
-
-        if (!dropdown.contains(event.target) && !notificationBtn) {
-          dropdown.classList.add("hidden");
-        }
-      });
-
-      // Auto-hide success messages
-      window.addEventListener("DOMContentLoaded", function () {
-        const urlParams = new URLSearchParams(window.location.search);
-        if (urlParams.get("success")) {
-          // Show success message if needed
-          console.log("Form submitted successfully");
-        }
-      });
-    </script>
+    // Auto-hide success messages
+    window.addEventListener("DOMContentLoaded", function () {
+      const urlParams = new URLSearchParams(window.location.search);
+      if (urlParams.get("success")) {
+        console.log("ส่งแบบฟอร์มสำเร็จแล้ว");
+      }
+    });
+  </script>
   </body>
-</html>
+
+</html>
\ No newline at end of file
diff --git a/views/student/formhistory.ejs b/views/student/formhistory.ejs
index 137e1c5..21c612e 100644
--- a/views/student/formhistory.ejs
+++ b/views/student/formhistory.ejs
@@ -1,166 +1,590 @@
 <!DOCTYPE html>
 <html lang="th">
+
 <head>
   <meta charset="UTF-8" />
-  <title>Form History</title>
+  <title>ประวัติแบบฟอร์ม - FormEase</title>
+  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
+  <script src="https://cdn.tailwindcss.com"></script>
+  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
+  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
+  <script>
+    tailwind.config = {
+      theme: {
+        extend: {
+          colors: {
+            'kku-blue': '#1e40af',
+            'kku-blue-light': '#3b82f6',
+            'kku-blue-dark': '#1e3a8a'
+          }
+        }
+      }
+    }
+  </script>
+  <style>
+    body {
+      box-sizing: border-box;
+    }
+
+    .status-badge {
+      font-size: .75rem;
+      font-weight: 600;
+      padding: .25rem .5rem;
+      border-radius: .375rem;
+      text-transform: uppercase
+    }
+
+    .approved {
+      background-color: #dcfce7;
+      color: #166534
+    }
+
+    .pending {
+      background-color: #fef3c7;
+      color: #92400e
+    }
+
+    .rejected {
+      background-color: #fee2e2;
+      color: #991b1b
+    }
+
+    .cancelled {
+      background-color: #e5e7eb;
+      color: #111827
+    }
+
+    tr.clickable {
+      cursor: pointer;
+      transition: background-color .15s, transform .1s
+    }
+
+    tr.clickable:hover {
+      background-color: #f9fafb
+    }
+
+    a.link {
+      color: #1e40af;
+      text-decoration: none
+    }
+
+    a.link:hover {
+      text-decoration: underline
+    }
+  </style>
 </head>
-<body>
-  <h1>Form History</h1>
-
-  <!-- Summary -->
-  <section>
-    <h2>Summary</h2>
-    <ul>
-      <li>Total: <%= totals.all %></li>
-      <li>Approved: <%= totals.approved %></li>
-      <li>Pending: <%= totals.pending %></li>
-      <li>Rejected: <%= totals.rejected %></li>
-      <li>Cancelled: <%= totals.cancelled %></li>
-    </ul>
-  </section>
-
-  <!-- Actions -->
-  <p>
-    <a href="<%= submitNewFormUrl %>">Submit New Form</a>
-  </p>
-
-  <!-- Filters -->
-  <section>
-    <h2>Filters</h2>
-    <form method="get">
-      <div>
-        <label>Search:
-          <input type="text" name="q" value="<%= filters.q || '' %>" placeholder="ชื่อฟอร์ม / ประเภท Template / ชื่ออาจารย์" />
-        </label>
-      </div>
-
-      <div>
-        <label>Status:
-          <select name="status">
-            <option value="all"      <%= filters.status === 'all' ? 'selected' : '' %>>All</option>
-            <option value="approved" <%= filters.status === 'approved' ? 'selected' : '' %>>approved</option>
-            <option value="pending"  <%= filters.status === 'pending' ? 'selected' : '' %>>pending</option>
-            <option value="rejected" <%= filters.status === 'rejected' ? 'selected' : '' %>>rejected</option>
-            <option value="cancelled"<%= filters.status === 'cancelled' ? 'selected' : '' %>>cancelled</option>
-          </select>
-        </label>
-      </div>
-
-      <div>
-        <label>From Date (createdAt):
-          <input type="date" name="from" value="<%= filters.from || '' %>" />
-        </label>
-      </div>
-
-      <div>
-        <label>To Date (updatedAt):
-          <input type="date" name="to" value="<%= filters.to || '' %>" />
-        </label>
-      </div>
-
-      <div>
-        <label>Per page:
-          <select name="limit">
-            <option value="10" <%= Number(filters.limit) === 10 ? 'selected' : '' %>>10</option>
-            <option value="20" <%= Number(filters.limit) === 20 ? 'selected' : '' %>>20</option>
-            <option value="50" <%= Number(filters.limit) === 50 ? 'selected' : '' %>>50</option>
-          </select>
-        </label>
-      </div>
-
-      <div>
-        <button type="submit">Apply</button>
-        <a href="?status=all">Clear All Filters</a>
-      </div>
-    </form>
-  </section>
-
-  <!-- Result info -->
-  <section>
-    <p>พบ <strong><%= filteredTotal %></strong> รายการ</p>
-  </section>
-
-  <!-- Table -->
-  <section>
-    <table border="1" cellpadding="6" cellspacing="0">
-      <thead>
-        <tr>
-          <th>Form Details</th>
-          <th>Submission Date</th>
-          <th>Status</th>
-          <th>Reviewer</th>
-          <th>Last Updated</th>
-        </tr>
-      </thead>
-      <tbody>
-        <% if (!items || items.length === 0) { %>
-          <tr>
-            <td colspan="5" align="center">ไม่มีข้อมูล</td>
-          </tr>
-        <% } else { %>
-          <% items.forEach(function(row){ %>
-            <tr>
-              <td>
-                <div><strong><%= row.template && row.template.name ? row.template.name : '-' %></strong></div>
+
+<body class="bg-gray-50 font-sans">
+
+  <% /* ---------- EJS helper: ใช้ formatDate() เดียวกันกับฝั่ง client ---------- */ %>
+    <% function formatDate(d) { try { return d ? new Date(d).toLocaleString('th-TH-u-ca-buddhist', {
+      timeZone: 'Asia/Bangkok' , hour12: false, year: 'numeric' , month: '2-digit' , day: '2-digit' , hour: '2-digit' ,
+      minute: '2-digit' , second: '2-digit' , calendar: 'buddhist' }) : '-' ; } catch (e) { return d ? new
+      Date(d).toLocaleString('th-TH', { timeZone: 'Asia/Bangkok' , hour12: false, year: 'numeric' , month: '2-digit' ,
+      day: '2-digit' , hour: '2-digit' , minute: '2-digit' , second: '2-digit' }) : '-' ; } } %>
+
+      <%- include('../partials/navbar', { activeMenu: 'formhistory' }) %>
+
+        <!-- Main -->
+        <main class="container mx-auto px-4 py-6">
+          <!-- Title + total small badge -->
+          <div class="mb-6 flex items-end justify-between flex-wrap gap-2">
+            <div class="flex items-center gap-3">
+              <div>
+                <h2 class="text-2xl font-bold text-gray-900 mb-1">ประวัติแบบฟอร์ม</h2>
+                <p class="text-gray-600">ดูประวัติการส่งแบบฟอร์ม สถานะ และผู้ตรวจ ได้แบบเรียลไทม์</p>
+              </div>
+            </div>
+          </div>
+
+          <!-- Stats -->
+          <div class="grid grid-cols-1 md:grid-cols-5 gap-4 mb-6">
+            <div class="bg-white rounded-xl shadow p-5 border border-gray-100">
+              <div class="flex items-center">
+                <div class="p-2.5 bg-green-50 rounded-lg">
+                  <svg class="w-5 h-5 text-green-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
+                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7" />
+                  </svg>
+                </div>
+                <div class="ml-4">
+                  <p class="text-xs font-medium text-gray-600">อนุมัติ</p>
+                  <p id="approvedCount" class="text-xl font-bold text-gray-900">
+                    <%= totals.approved %>
+                  </p>
+                </div>
+              </div>
+            </div>
+            <div class="bg-white rounded-xl shadow p-5 border border-gray-100">
+              <div class="flex items-center">
+                <div class="p-2.5 bg-yellow-50 rounded-lg">
+                  <svg class="w-5 h-5 text-yellow-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
+                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
+                      d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z" />
+                  </svg>
+                </div>
+                <div class="ml-4">
+                  <p class="text-xs font-medium text-gray-600">รอดำเนินการ</p>
+                  <p id="pendingCount" class="text-xl font-bold text-gray-900">
+                    <%= totals.pending %>
+                  </p>
+                </div>
+              </div>
+            </div>
+            <div class="bg-white rounded-xl shadow p-5 border border-gray-100">
+              <div class="flex items-center">
+                <div class="p-2.5 bg-red-50 rounded-lg">
+                  <svg class="w-5 h-5 text-red-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
+                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
+                  </svg>
+                </div>
+                <div class="ml-4">
+                  <p class="text-xs font-medium text-gray-600">ปฏิเสธ</p>
+                  <p id="rejectedCount" class="text-xl font-bold text-gray-900">
+                    <%= totals.rejected %>
+                  </p>
+                </div>
+              </div>
+            </div>
+            <div class="bg-white rounded-xl shadow p-5 border border-gray-100">
+              <div class="flex items-center">
+                <div class="p-2.5 bg-gray-50 rounded-lg">
+                  <svg class="w-6 h-6 text-gray-600" viewBox="0 0 24 24" fill="none" stroke="currentColor"
+                    aria-hidden="true">
+                    <circle cx="12" cy="12" r="9" stroke-width="2.5"></circle>
+                    <path d="M5 19L19 5" stroke-width="2.5" stroke-linecap="round"></path>
+                  </svg>
+                </div>
+                <div class="ml-4">
+                  <p class="text-xs font-medium text-gray-600">ยกเลิก</p>
+                  <p id="cancelledCount" class="text-xl font-bold text-gray-900">
+                    <%= totals.cancelled %>
+                  </p>
+                </div>
+              </div>
+            </div>
+            <div class="bg-white rounded-xl shadow p-5 border border-gray-100">
+              <div class="flex items-center">
+                <div class="p-2.5 bg-blue-50 rounded-lg">
+                  <svg class="w-6 h-6 text-blue-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
+                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
+                      d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z">
+                    </path>
+                  </svg>
+                </div>
+                <div class="ml-4">
+                  <p class="text-xs font-medium text-gray-600">แบบฟอร์มทั้งหมด</p>
+                  <p id="totalCountCard" class="text-xl font-bold text-gray-900">
+                    <%= totals.all %>
+                  </p>
+                </div>
+              </div>
+            </div>
+          </div>
+
+          <!-- Filters -->
+          <div class="bg-white rounded-xl shadow mb-6 border border-gray-100">
+            <div class="p-6 border-b border-gray-200">
+              <h3 class="text-lg font-semibold text-gray-900 mb-4">ตัวกรองแบบฟอร์ม</h3>
+              <form id="filterForm" method="get">
+                <div class="grid grid-cols-1 md:grid-cols-5 gap-4">
+                  <label class="block">
+                    <span class="block text-sm font-medium text-gray-700 mb-1">ค้นหา</span>
+                    <input type="text" name="q" value="<%= filters.q || '' %>"
+                      placeholder="พิมพ์ชื่อแบบฟอร์มหรือชื่ออาจารย์…"
+                      class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-kku-blue focus:border-transparent">
+                  </label>
+                  <label class="block">
+                    <span class="block text-sm font-medium text-gray-700 mb-1">หมวดหมู่</span>
+                    <select name="category"
+                      class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-kku-blue focus:border-transparent">
+                      <option value="all" <%=(filters.category||'all')==='all' ? 'selected' : '' %>>ทั้งหมด</option>
+                      <% (allCategories||[]).forEach(function(cat){ %>
+                        <option value="<%= cat %>" <%=filters.category===cat ? 'selected' : '' %>><%= cat %>
+                        </option>
+                        <% }) %>
+                    </select>
+                  </label>
+                  <label class="block">
+                    <span class="block text-sm font-medium text-gray-700 mb-1">สถานะ</span>
+                    <select name="status"
+                      class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-kku-blue focus:border-transparent">
+                      <option value="all" <%=filters.status==='all' ? 'selected' : '' %>>ทั้งหมด</option>
+                      <option value="approved" <%=filters.status==='approved' ? 'selected' : '' %>>อนุมัติ</option>
+                      <option value="pending" <%=filters.status==='pending' ? 'selected' : '' %>>รอดำเนินการ</option>
+                      <option value="rejected" <%=filters.status==='rejected' ? 'selected' : '' %>>ปฏิเสธ</option>
+                      <option value="cancelled" <%=filters.status==='cancelled' ? 'selected' : '' %>>ยกเลิก</option>
+                    </select>
+                  </label>
+                  <label class="block">
+                    <span class="block text-sm font-medium text-gray-700 mb-1">ตั้งแต่วันที่</span>
+                    <input type="date" name="from" value="<%= filters.from || '' %>"
+                      class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-kku-blue focus:border-transparent">
+                  </label>
+                  <label class="block">
+                    <span class="block text-sm font-medium text-gray-700 mb-1">ถึงวันที่</span>
+                    <input type="date" name="to" value="<%= filters.to || '' %>"
+                      class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-kku-blue focus:border-transparent">
+                  </label>
+                </div>
+                <input type="hidden" name="limit" value="10" />
+                <input type="hidden" name="page" value="<%= pagination.page %>" />
+              </form>
+
+              <div class="mt-4 flex justify-between items-center">
+                <button type="button" id="clearFilters" class="text-gray-600 hover:text-gray-800 text-sm font-medium">
+                  ล้างตัวกรองทั้งหมด
+                </button>
+                <div class="text-sm text-gray-600">
+                  แสดง <span id="showingCount">
+                    <%= items?.length || 0 %>
+                  </span>
+                  จากทั้งหมด <span id="totalCount">
+                    <%= filteredTotal %>
+                  </span> รายการ
+                </div>
+              </div>
+            </div>
+          </div>
+
+          <!-- Table / Cards -->
+          <div class="bg-white rounded-xl shadow border border-gray-100">
+            <div class="p-6 border-b border-gray-200 flex flex-col sm:flex-row sm:items-center sm:justify-between">
+              <h3 class="text-lg font-semibold text-gray-900">แบบฟอร์มที่ส่ง</h3>
+              <a href="<%= submitNewFormUrl %>"
+                class="mt-3 sm:mt-0 bg-kku-blue text-white px-4 py-2 rounded-md hover:bg-kku-blue-dark transition-colors text-sm font-medium shadow-sm">
+                ยื่นแบบฟอร์ม
+              </a>
+            </div>
+
+            <!-- Desktop -->
+            <div class="hidden md:block overflow-x-auto">
+              <table class="w-full">
+                <thead class="bg-gray-50">
+                  <tr>
+                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
+                      รายละเอียดแบบฟอร์ม</th>
+                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">หมวดหมู่
+                    </th>
+                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">วันที่ส่ง
+                    </th>
+                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">สถานะ
+                    </th>
+                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">ผู้ตรวจ
+                    </th>
+                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
+                      อัปเดตล่าสุด</th>
+                  </tr>
+                </thead>
+                <tbody id="rows" class="bg-white divide-y divide-gray-100">
+                  <% if (!items || items.length===0) { %>
+                    <tr>
+                      <td colspan="6" class="px-6 py-8 text-center text-gray-500">ไม่มีข้อมูล</td>
+                    </tr>
+                    <% } else { %>
+                      <% items.forEach(function(row){ %>
+                        <tr class="clickable even:bg-gray-50/40" data-href="/student/forms?id=<%= row._id %>">
+                          <td class="px-6 py-4">
+                            <div>
+                              <div class="text-sm font-medium text-gray-900">
+                                <a class="link" href="/student/forms?id=<%= row._id %>">
+                                  <%= row.template?.name || '-' %>
+                                </a>
+                              </div>
+                              <div class="text-xs mt-1 text-gray-600">
+                                <% if (row.course?.name) { %>
+                                  <span
+                                    class="inline-flex items-center gap-1 px-2 py-0.5 rounded-full bg-gray-100 border border-gray-200">
+                                    รายวิชา: <%= row.course.name %>
+                                  </span>
+                                  <% } %>
+                                    <% if (row.section?.name) { %>
+                                      <span
+                                        class="ml-2 inline-flex items-center gap-1 px-2 py-0.5 rounded-full bg-gray-100 border border-gray-200">
+                                        กลุ่มเรียน: <%= row.section.name %>
+                                      </span>
+                                      <% } %>
+                              </div>
+                            </div>
+                          </td>
+                          <td class="px-6 py-4 text-sm text-gray-900">
+                            <span
+                              class="inline-flex items-center px-2 py-0.5 rounded-md bg-blue-50 text-kku-blue border border-blue-100">
+                              <%= row.template?.category || '-' %>
+                            </span>
+                          </td>
+                          <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">
+                            <%= formatDate(row.createdAt) %>
+                          </td>
+                          <td class="px-6 py-4 whitespace-nowrap">
+                            <span class="status-badge <%= row.status %>">
+                              <%=
+                                ({approved:'อนุมัติ',pending:'รอดำเนินการ',rejected:'ปฏิเสธ',cancelled:'ยกเลิก'})[(row.status||'').toLowerCase()]
+                                || row.status %>
+                            </span>
+                          </td>
+                          <td class="px-6 py-4">
+                            <div class="text-sm text-gray-900">
+                              <%= row.reviewer?.name || '-' %>
+                            </div>
+                          </td>
+                          <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">
+                            <%= formatDate(row.updatedAt) %>
+                          </td>
+                        </tr>
+                        <% }) %>
+                          <% } %>
+                </tbody>
+              </table>
+            </div>
+
+            <!-- Mobile -->
+            <div class="md:hidden" id="cards">
+              <% if (!items || items.length===0) { %>
+                <div class="p-8 text-center text-gray-500">
+                  <svg class="mx-auto h-12 w-12 text-gray-400 mb-4" fill="none" stroke="currentColor"
+                    viewBox="0 0 24 24">
+                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
+                      d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" />
+                  </svg>
+                  <p class="text-lg font-medium mb-2">ไม่มีข้อมูล</p>
+                  <p class="text-sm">ลองปรับตัวกรองหรือยื่นแบบฟอร์มใหม่</p>
+                </div>
+                <% } else { %>
+                  <% items.forEach(function(row){ %>
+                    <a href="/student/forms?id=<%= row._id %>"
+                      class="block border-t border-gray-200 p-4 hover:bg-gray-50 transition">
+                      <div class="flex items-start justify-between mb-2">
+                        <div class="flex-1">
+                          <div class="text-sm font-medium text-gray-900">
+                            <%= row.template?.name || '-' %>
+                          </div>
+                          <div
+                            class="text-xs text-kku-blue bg-blue-50 inline-flex px-2 py-0.5 rounded-md border border-blue-100 mt-1">
+                            <%= row.template?.category || '-' %>
+                          </div>
+                        </div>
+                        <span class="status-badge <%= row.status %> ml-2">
+                          <%=
+                            ({approved:'อนุมัติ',pending:'รอดำเนินการ',rejected:'ปฏิเสธ',cancelled:'ยกเลิก'})[(row.status||'').toLowerCase()]
+                            || row.status %>
+                        </span>
+                      </div>
+                      <div class="grid grid-cols-2 gap-2 text-xs text-gray-600">
+                        <div><span class="font-medium">ส่งเมื่อ:</span>
+                          <%= formatDate(row.createdAt) %>
+                        </div>
+                        <div><span class="font-medium">อัปเดต:</span>
+                          <%= formatDate(row.updatedAt) %>
+                        </div>
+                        <div class="col-span-2"><span class="font-medium">ผู้ตรวจ:</span>
+                          <%= row.reviewer?.name || '-' %>
+                        </div>
+                      </div>
+                    </a>
+                    <% }) %>
+                      <% } %>
+            </div>
+
+            <!-- Pagination -->
+            <div class="p-4 flex items-center justify-between text-sm text-gray-600">
+              <p id="pagerText">หน้า <%= pagination.page %> / <%= Math.max(pagination.totalPages,1) %>
+              </p>
+              <div id="pagerLinks" class="space-x-3">
+                <% function linkTo(p){ const params=new URLSearchParams({ q: filters.q||'', category:
+                  filters.category||'all', status: filters.status||'all', from: filters.from||'', to: filters.to||'',
+                  limit:'10', page:String(p) }); return `?${params.toString()}` } %>
+                  <% if (pagination.page>1) { %>
+                    <a href="<%= linkTo(pagination.page-1) %>" class="text-kku-blue hover:text-kku-blue-dark"
+                      data-page="<%= pagination.page-1 %>">ก่อนหน้า</a>
+                    <% } else { %><span class="text-gray-400">ก่อนหน้า</span>
+                      <% } %>
+                        <% if (pagination.page<pagination.totalPages) { %>
+                          <a href="<%= linkTo(pagination.page+1) %>" class="text-kku-blue hover:text-kku-blue-dark"
+                            data-page="<%= pagination.page+1 %>">ถัดไป</a>
+                          <% } else { %><span class="text-gray-400">ถัดไป</span>
+                            <% } %>
+              </div>
+            </div>
+          </div>
+        </main>
+
+        <script>
+            (function () {
+              // ---------- Client formatter (ล็อกเหมือน EJS) ----------
+              const DATE_FMT_OPTS = {
+                timeZone: 'Asia/Bangkok',
+                hour12: false,
+                year: 'numeric', month: '2-digit', day: '2-digit',
+                hour: '2-digit', minute: '2-digit', second: '2-digit',
+                calendar: 'buddhist'
+              };
+              function formatDate(d) {
+                try { return d ? new Date(d).toLocaleString('th-TH-u-ca-buddhist', DATE_FMT_OPTS) : '-'; }
+                catch { return d ? new Date(d).toLocaleString('th-TH', { ...DATE_FMT_OPTS, calendar: undefined }) : '-'; }
+              }
+
+              // แปลสถานะแสดงผล (คง class เดิมไว้)
+              function tStatus(s) {
+                const k = String(s || '').toLowerCase();
+                return ({ approved: 'อนุมัติ', pending: 'รอดำเนินการ', rejected: 'ปฏิเสธ', cancelled: 'ยกเลิก' })[k] || s;
+              }
+
+              const form = document.getElementById('filterForm');
+              const inputs = form.querySelectorAll('input, select');
+
+              const tableBody = document.getElementById('rows');
+              const cards = document.getElementById('cards');
+              const showingCount = document.getElementById('showingCount');
+              const totalCount = document.getElementById('totalCount');
+              const totalCountTop = document.getElementById('totalCountTop');
+              const totalCountCard = document.getElementById('totalCountCard');
+              const approvedCount = document.getElementById('approvedCount');
+              const pendingCount = document.getElementById('pendingCount');
+              const rejectedCount = document.getElementById('rejectedCount');
+              const cancelledCount = document.getElementById('cancelledCount');
+
+              const pagerText = document.getElementById('pagerText');
+              const pagerContainer = document.getElementById('pagerLinks');
+
+              function htmlEscape(s) { return String(s ?? '').replace(/[&<>"']/g, m => ({ '&': '&amp;', '<': '&lt;', '>': '&gt;', '"': '&quot;', "'": '&#39;' }[m])) }
+
+              function wireRowClicks() {
+                document.querySelectorAll('tr.clickable').forEach(tr => {
+                  tr.addEventListener('click', e => {
+                    if (e.target.tagName.toLowerCase() === 'a') return;
+                    const href = tr.getAttribute('data-href'); if (href) location.href = href;
+                  });
+                });
+              }
+              wireRowClicks();
+
+              if (location.search) history.replaceState(null, '', '/student/formhistory');
+
+              function buildQuery(o) { const p = new URLSearchParams(); Object.entries(o).forEach(([k, v]) => { if (v != null && String(v).length > 0) p.set(k, v) }); return p.toString() }
+
+              function render(items, pagination, filters, totals) {
+                if (!items || items.length === 0) {
+                  tableBody.innerHTML = '<tr><td colspan="6" class="px-6 py-8 text-center text-gray-500">ไม่มีข้อมูล</td></tr>';
+                  cards.innerHTML = `
+            <div class="p-8 text-center text-gray-500">
+              <svg class="mx-auto h-12 w-12 text-gray-400 mb-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
+                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"/>
+              </svg>
+              <p class="text-lg font-medium mb-2">ไม่มีข้อมูล</p>
+              <p class="text-sm">ลองปรับตัวกรองหรือยื่นแบบฟอร์มใหม่</p>
+            </div>`;
+                  showingCount.textContent = 0;
+                } else {
+                  tableBody.innerHTML = items.map(row => {
+                    const id = row._id, name = htmlEscape(row?.template?.name || '-'), cat = htmlEscape(row?.template?.category || '-');
+                    const course = htmlEscape(row?.course?.name || ''), section = htmlEscape(row?.section?.name || '');
+                    const created = formatDate(row?.createdAt), updated = formatDate(row?.updatedAt), reviewer = htmlEscape(row?.reviewer?.name || '-');
+                    const st = htmlEscape(row.status);
+                    return `
+            <tr class="clickable even:bg-gray-50/40" data-href="/student/forms?id=${id}">
+              <td class="px-6 py-4">
                 <div>
-                  <% if (row.template && row.template.type) { %>Type: <%= row.template.type %> <% } %>
-                  <% if (row.course && row.course.name) { %> | Course: <%= row.course.name %> <% } %>
-                  <% if (row.section && row.section.name) { %> | Section: <%= row.section.name %> <% } %>
-                  | ID: <%= row._id %>
+                  <div class="text-sm font-medium text-gray-900"><a class="link" href="/student/forms?id=${id}">${name}</a></div>
+                  <div class="text-xs mt-1 text-gray-600">
+                    ${course ? `<span class="inline-flex items-center gap-1 px-2 py-0.5 rounded-full bg-gray-100 border border-gray-200">รายวิชา: ${course}</span>` : ''}
+                    ${section ? `<span class="ml-2 inline-flex items-center gap-1 px-2 py-0.5 rounded-full bg-gray-100 border border-gray-200">กลุ่มเรียน: ${section}</span>` : ''}
+                  </div>
                 </div>
               </td>
-              <td>
-            <% if (row.createdAt) { %>
-                <%= new Date(row.createdAt).toLocaleString() %>
-            <% } else { %>-<% } %>
-            </td>
-                        <td><%= row.status %></td>
-                        <td><%= row.reviewer && row.reviewer.name ? row.reviewer.name : '-' %></td>
-                        <td>
-            <% if (row.updatedAt) { %>
-                <%= new Date(row.updatedAt).toLocaleString() %>
-            <% } else { %>-<% } %>
-            </td>
-            </tr>
-          <% }) %>
-        <% } %>
-      </tbody>
-    </table>
-  </section>
-
-  <!-- Pagination -->
-  <section>
-    <p>
-      Page <%= pagination.page %> / <%= pagination.totalPages %>
-    </p>
-    <div>
-      <% 
-        function linkTo(p){
-          const params = new URLSearchParams({
-            q: filters.q || '',
-            status: filters.status || 'all',
-            from: filters.from || '',
-            to: filters.to || '',
-            limit: String(filters.limit || 10),
-            page: String(p)
-          });
-          return `?${params.toString()}`
-        }
-      %>
-
-      <% if (pagination.page > 1) { %>
-        <a href="<%= linkTo(pagination.page - 1) %>">Prev</a>
-      <% } else { %>
-        <span>Prev</span>
-      <% } %>
-
-      <% if (pagination.page < pagination.totalPages) { %>
-        <a href="<%= linkTo(pagination.page + 1) %>">Next</a>
-      <% } else { %>
-        <span>Next</span>
-      <% } %>
-    </div>
-  </section>
+              <td class="px-6 py-4 text-sm text-gray-900">
+                <span class="inline-flex items-center px-2 py-0.5 rounded-md bg-blue-50 text-kku-blue border border-blue-100">${cat}</span>
+              </td>
+              <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">${created}</td>
+              <td class="px-6 py-4 whitespace-nowrap"><span class="status-badge ${st}">${tStatus(st)}</span></td>
+              <td class="px-6 py-4"><div class="text-sm text-gray-900">${reviewer}</div></td>
+              <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">${updated}</td>
+            </tr>`;
+                  }).join('');
+                  cards.innerHTML = items.map(row => {
+                    const id = row._id, name = htmlEscape(row?.template?.name || '-'), cat = htmlEscape(row?.template?.category || '-');
+                    const created = formatDate(row?.createdAt), updated = formatDate(row?.updatedAt), reviewer = htmlEscape(row?.reviewer?.name || '-');
+                    const st = htmlEscape(row.status);
+                    return `
+            <a href="/student/forms?id=${id}" class="block border-t border-gray-200 p-4 hover:bg-gray-50 transition">
+              <div class="flex items-start justify-between mb-2">
+                <div class="flex-1">
+                  <div class="text-sm font-medium text-gray-900">${name}</div>
+                  <div class="text-xs text-kku-blue bg-blue-50 inline-flex px-2 py-0.5 rounded-md border border-blue-100 mt-1">${cat}</div>
+                </div>
+                <span class="status-badge ${st} ml-2">${tStatus(st)}</span>
+              </div>
+              <div class="grid grid-cols-2 gap-2 text-xs text-gray-600">
+                <div><span class="font-medium">ส่งเมื่อ:</span> ${created}</div>
+                <div><span class="font-medium">อัปเดต:</span> ${updated}</div>
+                <div class="col-span-2"><span class="font-medium">ผู้ตรวจ:</span> ${reviewer}</div>
+              </div>
+            </a>`;
+                  }).join('');
+                  showingCount.textContent = items.length;
+                  wireRowClicks();
+                }
+
+                // totals / counters
+                const total = totals.filteredTotal ?? 0;
+                totalCount.textContent = total;
+                if (totalCountTop) totalCountTop.textContent = total;
 
+                if (totals && totals.totals) {
+                  approvedCount.textContent = totals.totals.approved ?? approvedCount.textContent;
+                  pendingCount.textContent = totals.totals.pending ?? pendingCount.textContent;
+                  rejectedCount.textContent = totals.totals.rejected ?? rejectedCount.textContent;
+                  cancelledCount.textContent = totals.totals.cancelled ?? cancelledCount.textContent;
+                  totalCountCard.textContent = totals.totals.all ?? totalCountCard.textContent;
+                }
+
+                // pagination
+                const totalPages = Math.max(pagination.totalPages || 1, 1);
+                pagerText.textContent = `หน้า ${pagination.page} / ${totalPages}`;
+                function linkTo(p) {
+                  const params = { q: filters.q || '', category: filters.category || 'all', status: filters.status || 'all', from: filters.from || '', to: filters.to || '', limit: '10', page: String(p) };
+                  return '?' + buildQuery(params);
+                }
+                pagerContainer.innerHTML = `
+          ${pagination.page > 1 ? `<a href="${linkTo(pagination.page - 1)}" class="text-kku-blue hover:text-kku-blue-dark" data-page="${pagination.page - 1}">ก่อนหน้า</a>` : `<span class="text-gray-400">ก่อนหน้า</span>`}
+          ${pagination.page < totalPages ? `<a href="${linkTo(pagination.page + 1)}" class="text-kku-blue hover:text-kku-blue-dark" data-page="${pagination.page + 1}">ถัดไป</a>` : `<span class="text-gray-400">ถัดไป</span>`}
+        `;
+                pagerContainer.querySelectorAll('a[data-page]').forEach(a => {
+                  a.addEventListener('click', e => {
+                    e.preventDefault();
+                    form.elements.page.value = a.getAttribute('data-page');
+                    fetchData();
+                  });
+                });
+
+                history.replaceState(null, '', '/student/formhistory');
+              }
+
+              let t = null;
+              form.querySelectorAll('input, select').forEach(el => {
+                const evt = (el.tagName === 'INPUT' && el.type === 'text') ? 'input' : 'change';
+                el.addEventListener(evt, () => {
+                  form.elements.page.value = '1';
+                  if (evt === 'input') { clearTimeout(t); t = setTimeout(fetchData, 300); }
+                  else { fetchData(); }
+                });
+              });
+
+              document.getElementById('clearFilters')?.addEventListener('click', () => {
+                form.q.value = ''; form.category.value = 'all'; form.status.value = 'all'; form.from.value = ''; form.to.value = ''; form.page.value = '1';
+                fetchData();
+              });
+
+              async function fetchData() {
+                const qs = new URLSearchParams(new FormData(form)).toString();
+                const url = `/student/formhistory/data?${qs}`;
+                try {
+                  const r = await fetch(url, { headers: { 'Accept': 'application/json' } });
+                  const data = await r.json();
+                  render(data.items, data.pagination, data.filters, { filteredTotal: data.filteredTotal, totals: data.totals });
+                } catch (e) { console.error(e); }
+              }
+            })();
+        </script>
 </body>
-</html>
+
+</html>
\ No newline at end of file
diff --git a/views/student/profile.ejs b/views/student/profile.ejs
index a68a9a8..2fd3a1f 100644
--- a/views/student/profile.ejs
+++ b/views/student/profile.ejs
@@ -1,10 +1,13 @@
 <!DOCTYPE html>
-<html lang="en">
+<html lang="th">
+
 <head>
   <meta charset="UTF-8" />
   <meta name="viewport" content="width=device-width, initial-scale=1.0" />
-  <title>Profile Settings - CPmail</title>
+  <title>ตั้งค่าโปรไฟล์ - CPmail</title>
   <script src="https://cdn.tailwindcss.com"></script>
+  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
+  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
   <script>
     tailwind.config = {
       theme: {
@@ -19,788 +22,757 @@
     }
   </script>
   <style>
-    body { box-sizing: border-box; }
-    .profile-avatar { width: 120px; height: 120px; border-radius: 50%; display: flex; align-items: center; justify-content: center; overflow: hidden; border: 4px solid #e5e7eb; }
-    .profile-avatar img { width: 100%; height: 100%; object-fit: cover; }
-    .form-section { background: white; border-radius: 0.5rem; box-shadow: 0 1px 3px 0 rgba(0, 0, 0, 0.1); margin-bottom: 1.5rem; }
-    .success-message { background-color: #dcfce7; border: 1px solid #bbf7d0; color: #166534; }
-    .error-message { background-color: #fee2e2; border: 1px solid #fecaca; color: #991b1b; }
-  </style>
-</head>
-<body class="bg-gray-50 font-sans">
-  <!-- Header -->
-  <header class="bg-kku-blue text-white shadow-lg">
-    <div class="container mx-auto px-4">
-      <div class="flex items-center justify-between py-4">
-        <div class="flex items-center space-x-3">
-          <div class="w-10 h-10 bg-white rounded-full flex items-center justify-center">
-            <span class="text-kku-blue font-bold text-lg">F</span>
-          </div>
-          <div>
-            <h1 class="text-xl font-bold">FormEase</h1>
-            <p class="text-blue-200 text-sm">College of Computing</p>
-          </div>
-        </div>
-        <div class="flex items-center space-x-4">
-          <div class="hidden md:block text-right">
-            <p class="text-sm font-medium"><%= student?.name %></p>
-            <p class="text-blue-200 text-xs">ID: <%= student?.universityId %></p>
-          </div>
-          <button onclick="goToDashboard()" class="bg-kku-blue-light hover:bg-kku-blue-dark px-3 py-2 rounded-md text-sm font-medium transition-colors">
-            Dashboard
-          </button>
-        </div>
-      </div>
-    </div>
-  </header>
-
-  <!-- Navigation -->
-  <nav class="bg-white shadow-sm border-b">
-    <div class="container mx-auto px-4">
-      <div class="flex space-x-8 overflow-x-auto">
-        <a href="/student" class="py-3 px-1 text-gray-500 hover:text-kku-blue font-medium whitespace-nowrap transition-colors">Dashboard</a>
-        <a href="/student/submitform" class="py-3 px-1 text-gray-500 hover:text-kku-blue font-medium whitespace-nowrap transition-colors">Submit Form</a>
-        <a href="/student/formhistory" class="py-3 px-1 text-gray-500 hover:text-kku-blue font-medium whitespace-nowrap transition-colors">Form History</a>
-        <a href="/student/profile" class="py-3 px-1 border-b-2 border-kku-blue text-kku-blue font-medium whitespace-nowrap">Profile Settings</a>
-      </div>
-    </div>
-  </nav>
-
-  <!-- Main Content -->
-  <main class="container mx-auto px-4 py-6">
-    <!-- Page Header -->
-    <div class="mb-6">
-      <h2 class="text-2xl font-bold text-gray-900 mb-2">Profile Settings</h2>
-      <p class="text-gray-600">Manage your personal information and account settings.</p>
-    </div>
-
-    <!-- Success/Error Messages -->
-    <% if (message) { %>
-      <div class="mb-6">
-        <div class="success-message p-4 rounded-md text-sm font-medium"><%= message %></div>
-      </div>
-    <% } %>
-    <% if (error) { %>
-      <div class="mb-6">
-        <div class="error-message p-4 rounded-md text-sm font-medium"><%= error %></div>
-      </div>
-    <% } %>
-
-    <div class="grid grid-cols-1 lg:grid-cols-3 gap-6 items-start">
-      <!-- Profile Overview -->
-      <div class="lg:col-span-1">
-        <div class="form-section p-6">
-          <div class="text-center">
-            <div class="mb-6 mx-auto flex items-center justify-center">
-              <div class="relative">
-                <!-- Avatar -->
-                <div id="avatarWrapper"
-                    class="profile-avatar cursor-pointer ring-1 ring-gray-300 shadow-sm
-                            hover:ring-kku-blue/30 transition-colors">
-                  <img
-                    id="avatarPreview"
-                    src="<%= (student?.avatarUrl && student.avatarUrl.trim() !== '') ? student.avatarUrl : '/uploads/default.jpg' %>"
-                    data-original="<%= (student?.avatarUrl && student.avatarUrl.trim() !== '') ? student.avatarUrl : '/uploads/default.jpg' %>"
-                    alt="Profile picture of <%= student?.name || 'student' %>">
-                </div>
-
-                <!-- Camera button (formal tone: no scale, softer shadows) -->
-                <button type="button" id="cameraFab" aria-label="Change avatar" title="Change photo"
-                  class="absolute -bottom-2 -right-2 inline-flex items-center justify-center
-                        w-11 h-11 rounded-full bg-white text-gray-600 shadow-md ring-1 ring-gray-200
-                        hover:bg-gray-50 focus:outline-none focus-visible:ring-2 focus-visible:ring-kku-blue">
-                  <svg class="w-5 h-5 pointer-events-none" viewBox="0 0 24 24" fill="none"
-                      stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true">
-                    <rect x="3" y="7" width="18" height="13" rx="2" ry="2"></rect>
-                    <circle cx="12" cy="13.5" r="4"></circle>
-                    <path d="M8 7l2-3h4l2 3"></path>
-                  </svg>
-                  <span class="sr-only">Upload new avatar</span>
-                </button>
-              </div>
-            </div>
-
-            <!-- User info -->
-            <div class="space-y-1">
-              <h3 class="text-xl font-semibold tracking-tight text-gray-900 leading-tight">
-                <%= student?.name %>
-              </h3>
-              <p class="text-sm text-gray-700">
-                Student ID:
-                <span class="font-medium font-mono tabular-nums"><%= student?.universityId %></span>
-              </p>
-              <p class="text-sm text-gray-700"><%= student?.major %></p>
-            </div>
-
-            <div class="mt-6 pt-5 border-t border-gray-200">
-              <dl class="grid grid-cols-2 gap-y-2 text-[0.95rem]">
-                <div>
-                  <dt class="text-gray-800 font-medium">Year of Study</dt>
-                  <dd class="text-gray-600"><%= student?.yearOfStudy %></dd>
-                </div>
-                <div>
-                  <dt class="text-gray-800 font-medium">Role</dt>
-                  <dd class="text-gray-600 capitalize"><%= student?.role %></dd>
-                </div>
-              </dl>
-            </div>
-
-            <!-- Upload actions -->
-            <form action="/student/profile/avatar" method="POST" enctype="multipart/form-data"
-                  class="mt-4 flex flex-wrap items-center justify-center gap-2">
-              <input type="file" name="avatar" accept="image/*" id="avatarInput" class="hidden">
-
-              <button type="button" onclick="document.getElementById('avatarInput').click()"
-                class="inline-flex items-center gap-2 bg-white border border-gray-300 text-gray-800
-                      hover:bg-gray-50 px-3.5 py-2 rounded-md text-sm font-medium transition-colors
-                      focus:outline-none focus:ring-2 focus:ring-kku-blue">
-                Change Avatar
-              </button>
-
-              <button type="submit" id="uploadAvatarBtn"
-                class="hidden inline-flex items-center bg-kku-blue text-white hover:bg-kku-blue-dark
-                      px-3.5 py-2 rounded-md text-sm font-medium transition-colors shadow-sm
-                      focus:outline-none focus:ring-2 focus:ring-kku-blue">
-                Upload
-              </button>
-
-              <button type="button" id="cancelAvatarBtn"
-                class="hidden inline-flex items-center bg-white text-rose-700 border border-rose-200
-                      hover:bg-rose-50 px-3.5 py-2 rounded-md text-sm font-medium transition-colors
-                      focus:outline-none focus:ring-2 focus:ring-rose-300">
-                Cancel
-              </button>
-            </form>
-          </div>
-        </div>
+    body {
+      box-sizing: border-box;
+    }
 
-        <!-- Quick Actions -->
-        <section class="bg-white rounded-2xl shadow-lg p-6 border border-gray-100">
-          <h3 class="text-xl font-semibold text-gray-900 mb-5 flex items-center gap-2">
-            Quick Actions
-          </h3>
-
-          <div class="space-y-3">
-            <!-- Dashboard -->
-            <a
-              href="/student"
-              class="flex items-center justify-center gap-2 bg-kku-blue hover:bg-kku-blue-dark text-white px-4 py-3 rounded-lg text-sm font-medium transition-all transform hover:scale-[1.02] shadow-sm hover:shadow-md"
-            >
-              <svg
-                class="w-5 h-5"
-                fill="none"
-                stroke="currentColor"
-                viewBox="0 0 24 24"
-              >
-                <path
-                  stroke-linecap="round"
-                  stroke-linejoin="round"
-                  stroke-width="2"
-                  d="M3 9.75L12 4l9 5.75V20a1 1 0 01-1 1h-5.25v-6h-5.5v6H4a1 1 0 01-1-1V9.75z"
-                />
-              </svg>
-              Dashboard
-            </a>
-
-            <!-- Submit Form -->
-            <a
-              href="/student/submitform"
-              class="flex items-center justify-center gap-2 bg-gray-100 hover:bg-gray-200 text-gray-700 px-4 py-3 rounded-lg text-sm font-medium transition-all transform hover:scale-[1.02] shadow-sm hover:shadow-md"
-            >
-              <svg
-                class="w-5 h-5"
-                fill="none"
-                stroke="currentColor"
-                viewBox="0 0 24 24"
-              >
-                <path
-                  stroke-linecap="round"
-                  stroke-linejoin="round"
-                  stroke-width="2"
-                  d="M12 4v16m8-8H4"
-                ></path>
-              </svg>
-              Submit New Form
-            </a>
-
-            <!-- View All Form -->
-            <a
-              href="/student/formhistory"
-              class="flex items-center justify-center gap-2 bg-gray-100 hover:bg-gray-200 text-gray-700 px-4 py-3 rounded-lg text-sm font-medium transition-all transform hover:scale-[1.02] shadow-sm hover:shadow-md"
-            >
-              <svg
-                class="w-5 h-5"
-                fill="none"
-                stroke="currentColor"
-                viewBox="0 0 24 24"
-              >
-                <path
-                  stroke-linecap="round"
-                  stroke-linejoin="round"
-                  stroke-width="2"
-                  d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"
-                ></path>
-              </svg>
-              View All Form
-            </a>
-          </div>
-        </section>
-      </div>
+    .profile-avatar {
+      width: 120px;
+      height: 120px;
+      border-radius: 50%;
+      display: flex;
+      align-items: center;
+      justify-content: center;
+      overflow: hidden;
+      border: 4px solid #e5e7eb;
+    }
 
-      <!-- RIGHT: Tabs + Panels inside ONE card -->
-      <div class="lg:col-span-2">
-        <div class="form-section p-0 overflow-hidden">
-          <!-- Tabs header (pills) -->
-          <div class="px-6 pt-4 pb-3">
-            <!-- เอากรอบออก เหลือเฉพาะปุ่ม -->
-          <nav class="flex flex-wrap gap-3"
-              aria-label="Profile sections" role="tablist">
-
-              <!-- Profile (active) -->
-              <button type="button" data-tab="info" role="tab" aria-selected="true"
-            class="tab-btn group inline-flex items-center gap-2 px-5 py-4 text-sm rounded-xl
-                  border transition-all focus:outline-none focus-visible:ring-2 focus-visible:ring-blue-300
-                  bg-gradient-to-r from-kku-blue to-kku-blue-dark text-white border-transparent shadow-md">
-                <svg class="w-5 h-5 shrink-0" viewBox="0 0 24 24" fill="none"
-                    stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true">
-                  <path d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"/>
-                </svg>
-                <span>Personal Information</span>
-              </button>
-
-              <!-- Course & Section -->
-              <button type="button" data-tab="registration" role="tab" aria-selected="false"
-            class="tab-btn group inline-flex items-center gap-2 px-5 py-4 text-sm rounded-xl
-                  border transition-all focus:outline-none focus-visible:ring-2 focus-visible:ring-blue-200
-                  bg-white text-gray-700 border-gray-200 hover:bg-gray-50 hover:shadow-sm">
-                <!-- ใช้ไอคอนเดิมของคุณ -->
-                <svg class="w-5 h-5 shrink-0" viewBox="0 0 24 24" fill="none"
-                    stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true">
-                  <path d="M5 3h12a3 3 0 0 1 3 3v13a3 3 0 0 1-3 3H5a3 3 0 0 1-3-3V6a3 3 0 0 1 3-3z"></path>
-                  <path d="M8 3v19"></path>
-                  <path d="M12 8h5"></path>
-                  <path d="M12 12h5"></path>
-                </svg>
-                <span>Course &amp; Section</span>
-              </button>
-
-              <!-- Change Password -->
-              <button type="button" data-tab="password" role="tab" aria-selected="false"
-            class="tab-btn group inline-flex items-center gap-2 px-5 py-4 text-sm rounded-xl
-                  border transition-all focus:outline-none focus-visible:ring-2 focus-visible:ring-blue-200
-                  bg-white text-gray-700 border-gray-200 hover:bg-gray-50 hover:shadow-sm">
-                <svg class="w-5 h-5 shrink-0" viewBox="0 0 24 24" fill="none"
-                    stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true">
-                  <rect x="3" y="11" width="18" height="10" rx="2"/>
-                  <path d="M7 11V7a5 5 0 0110 0v4"/>
-                </svg>
-                <span>Change Password</span>
-              </button>
-            </nav>
-          </div>
+    .profile-avatar img {
+      width: 100%;
+      height: 100%;
+      object-fit: cover;
+    }
 
-          <!-- เส้นคั่นแท็บกับเนื้อหา -->
-          <div class="border-t border-gray-200"></div>
+    .form-section {
+      background: white;
+      border-radius: .5rem;
+      box-shadow: 0 1px 3px 0 rgba(0, 0, 0, .1);
+      margin-bottom: 1.5rem;
+    }
 
-          <!-- PANELS -->
-          <section data-tab-panel="info" class="tab-panel p-6" role="tabpanel">
-            <div class="pb-4">
-              <h3 class="text-lg font-semibold text-gray-900">Personal Information</h3>
-              <p class="text-gray-600 text-sm mt-1">Update your personal details and contact information.</p>
-            </div>
+    .success-message {
+      background-color: #dcfce7;
+      border: 1px solid #bbf7d0;
+      color: #166534;
+    }
 
-            <!-- Personal form (unchanged) -->
-            <form action="/student/profile/update" method="POST" class="pt-2">
-              <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
-                <div>
-                  <label for="name" class="block text-sm font-medium text-gray-800 mb-1">Full Name</label>
-                  <input type="text" id="name" name="name" value="<%= student?.name %>" required
-                         class="w-full px-3 py-2 border rounded-md bg-white shadow-sm transition focus:outline-none focus:ring-2 focus:ring-kku-blue focus:border-transparent border-gray-300">
-                </div>
+    .error-message {
+      background-color: #fee2e2;
+      border: 1px solid #fecaca;
+      color: #991b1b;
+    }
+  </style>
+</head>
 
-                <div>
-                  <label for="studentId" class="block text-sm font-medium text-gray-800 mb-1">Student ID</label>
-                  <input type="text" id="studentId" value="<%= student?.universityId %>" readonly
-                         class="w-full px-3 py-2 bg-gray-50 border border-gray-200 rounded-md text-gray-700 shadow-sm">
-                </div>
+<body class="bg-gray-50 font-sans">
 
-                <div>
-                  <label for="email" class="block text-sm font-medium text-gray-800 mb-1">Email Address</label>
-                  <input type="email" id="email" name="email" value="<%= student?.email %>" required
-                         class="w-full px-3 py-2 border rounded-md bg-white shadow-sm transition focus:outline-none focus:ring-2 focus:ring-kku-blue focus:border-transparent border-gray-300">
-                  <p class="text-xs text-gray-500 mt-1">โปรดใช้เมลมหาวิทยาลัยเพื่อความสะดวกในการติดต่อ</p>
-                </div>
+  <%- include('../partials/navbar', { activeMenu: 'profile' }) %>
 
-                <div>
-                  <label for="phone" class="block text-sm font-medium text-gray-800 mb-1">Phone Number</label>
-                  <input type="tel" id="phone" name="phone" value="<%= student?.phone || '' %>" required
-                         pattern="^0[0-9]{9}$" title="กรุณากรอกหมายเลขโทรศัพท์ให้ถูกต้อง เช่น 0812345678"
-                         class="w-full px-3 py-2 border rounded-md bg-white shadow-sm transition focus:outline-none focus:ring-2 focus:ring-kku-blue focus:border-transparent border-gray-300">
-                </div>
+    <!-- Main Content -->
+    <main class="container mx-auto px-4 py-6">
+      <!-- Page Header -->
+      <div class="mb-6">
+        <h2 class="text-2xl font-bold text-gray-900 mb-2">ตั้งค่าโปรไฟล์</h2>
+        <p class="text-gray-600">จัดการข้อมูลส่วนตัวและการตั้งค่าบัญชีของคุณ</p>
+      </div>
 
-                <div>
-                  <label for="dateOfBirth" class="block text-sm font-medium text-gray-800 mb-1">Date of Birth</label>
-                  <input type="date" id="dateOfBirth" name="dateOfBirth"
-                         value="<%= student?.dateOfBirth ? new Date(student.dateOfBirth).toISOString().split('T')[0] : '' %>"
-                         class="w-full px-3 py-2 border rounded-md bg-white shadow-sm transition focus:outline-none focus:ring-2 focus:ring-kku-blue focus:border-transparent border-gray-300">
-                </div>
+      <!-- Success/Error Messages -->
+      <% if (message) { %>
+        <div class="mb-6">
+          <div class="success-message p-4 rounded-md text-sm font-medium">
+            <%= message %>
+          </div>
+        </div>
+        <% } %>
+          <% if (error) { %>
+            <div class="mb-6">
+              <div class="error-message p-4 rounded-md text-sm font-medium">
+                <%= error %>
+              </div>
+            </div>
+            <% } %>
 
-                <div>
-                  <label for="major" class="block text-sm font-medium text-gray-800 mb-1">Department</label>
-                  <input type="text" id="major" value="<%= student?.major %>" readonly
-                         class="w-full px-3 py-2 bg-gray-50 border border-gray-200 rounded-md text-gray-700 shadow-sm">
-                </div>
+              <div class="grid grid-cols-1 lg:grid-cols-3 gap-6 items-start">
+                <!-- Profile Overview -->
+                <div class="lg:col-span-1">
+                  <div class="form-section p-6">
+                    <div class="text-center">
+                      <div class="mb-6 mx-auto flex items-center justify-center">
+                        <div class="relative">
+                          <!-- Avatar -->
+                          <div id="avatarWrapper"
+                            class="profile-avatar cursor-pointer ring-1 ring-gray-300 shadow-sm hover:ring-kku-blue/30 transition-colors">
+                            <img id="avatarPreview"
+                              src="<%= (student?.avatarUrl && student.avatarUrl.trim() !== '') ? student.avatarUrl : '/uploads/default.jpg' %>"
+                              data-original="<%= (student?.avatarUrl && student.avatarUrl.trim() !== '') ? student.avatarUrl : '/uploads/default.jpg' %>"
+                              alt="รูปโปรไฟล์ของ <%= student?.name || 'student' %>">
+                          </div>
+
+                          <!-- Camera button -->
+                          <button type="button" id="cameraFab" aria-label="เปลี่ยนรูปโปรไฟล์" title="เปลี่ยนรูปภาพ"
+                            class="absolute -bottom-2 -right-2 inline-flex items-center justify-center w-11 h-11 rounded-full bg-white text-gray-600 shadow-md ring-1 ring-gray-200 hover:bg-gray-50 focus:outline-none focus-visible:ring-2 focus-visible:ring-kku-blue">
+                            <svg class="w-5 h-5 pointer-events-none" viewBox="0 0 24 24" fill="none"
+                              stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"
+                              aria-hidden="true">
+                              <rect x="3" y="7" width="18" height="13" rx="2" ry="2"></rect>
+                              <circle cx="12" cy="13.5" r="4"></circle>
+                              <path d="M8 7l2-3h4l2 3"></path>
+                            </svg>
+                            <span class="sr-only">อัปโหลดรูปโปรไฟล์ใหม่</span>
+                          </button>
+                        </div>
+                      </div>
 
-                <div class="md:col-span-2">
-                  <label for="address" class="block text-sm font-medium text-gray-800 mb-1">Address</label>
-                  <textarea id="address" name="address" rows="3"
-                            class="w-full px-3 py-2 border rounded-md bg-white shadow-sm transition focus:outline-none focus:ring-2 focus:ring-kku-blue focus:border-transparent border-gray-300"><%= student?.address || '' %></textarea>
-                </div>
-              </div>
+                      <!-- User info -->
+                      <div class="space-y-1">
+                        <h3 class="text-xl font-semibold tracking-tight text-gray-900 leading-tight">
+                          <%= student?.name %>
+                        </h3>
+                        <p class="text-sm text-gray-700">
+                          รหัสนักศึกษา:
+                          <span class="font-medium font-mono tabular-nums">
+                            <%= student?.universityId %>
+                          </span>
+                        </p>
+                        <p class="text-sm text-gray-700">
+                          <%= student?.major %>
+                        </p>
+                      </div>
 
-              <!-- Academic (read-only) -->
-              <div class="mt-8 pt-6 border-t border-gray-200">
-                <h3 class="text-lg font-semibold text-gray-900">Academic Information</h3>
-                <p class="text-gray-600 text-sm mt-1">View your academic details. Contact the registrar to make changes.</p>
+                      <div class="mt-6 pt-5 border-t border-gray-200">
+                        <dl class="grid grid-cols-2 gap-y-2 text-[0.95rem]">
+                          <div>
+                            <dt class="text-gray-800 font-medium">ชั้นปี</dt>
+                            <dd class="text-gray-600">
+                              <%= student?.yearOfStudy %>
+                            </dd>
+                          </div>
+                          <div>
+                            <dt class="text-gray-800 font-medium">สิทธิ์ผู้ใช้</dt>
+                            <dd class="text-gray-600 capitalize">
+                              <%= student?.role %>
+                            </dd>
+                          </div>
+                        </dl>
+                      </div>
 
-                <div class="mt-4 grid grid-cols-1 md:grid-cols-2 gap-6">
-                  <div>
-                    <label class="block text-sm font-medium text-gray-700 mb-1">Department</label>
-                    <input type="text" value="<%= student?.major %>" readonly
-                           class="w-full px-3 py-2 bg-gray-100 border border-gray-300 rounded-md text-gray-600">
-                  </div>
-                  <div>
-                    <label class="block text-sm font-medium text-gray-700 mb-1">Faculty</label>
-                    <input type="text" value="College of Computing" readonly
-                           class="w-full px-3 py-2 bg-gray-100 border border-gray-300 rounded-md text-gray-600">
-                  </div>
-                  <div>
-                    <label class="block text-sm font-medium text-gray-700 mb-1">Year of Study</label>
-                    <input type="text" value="<%= student?.yearOfStudy %>" readonly
-                           class="w-full px-3 py-2 bg-gray-100 border border-gray-300 rounded-md text-gray-600">
-                  </div>
-                  <div>
-                    <label class="block text-sm font-medium text-gray-700 mb-1">Role</label>
-                    <input type="text" value="<%= student?.role %>" readonly
-                           class="w-full px-3 py-2 bg-gray-100 border border-gray-300 rounded-md text-gray-600 capitalize">
+                      <!-- Upload actions -->
+                      <form action="/student/profile/avatar" method="POST" enctype="multipart/form-data"
+                        class="mt-4 flex flex-wrap items-center justify-center gap-2">
+                        <input type="file" name="avatar" accept="image/*" id="avatarInput" class="hidden">
+
+                        <button type="button" onclick="document.getElementById('avatarInput').click()"
+                          class="inline-flex items-center gap-2 bg-white border border-gray-300 text-gray-800 hover:bg-gray-50 px-3.5 py-2 rounded-md text-sm font-medium transition-colors focus:outline-none focus:ring-2 focus:ring-kku-blue">
+                          เปลี่ยนรูปโปรไฟล์
+                        </button>
+
+                        <button type="submit" id="uploadAvatarBtn"
+                          class="hidden inline-flex items-center bg-kku-blue text-white hover:bg-kku-blue-dark px-3.5 py-2 rounded-md text-sm font-medium transition-colors shadow-sm focus:outline-none focus:ring-2 focus:ring-kku-blue">
+                          อัปโหลด
+                        </button>
+
+                        <button type="button" id="cancelAvatarBtn"
+                          class="hidden inline-flex items-center bg-white text-rose-700 border border-rose-200 hover:bg-rose-50 px-3.5 py-2 rounded-md text-sm font-medium transition-colors focus:outline-none focus:ring-2 focus:ring-rose-300">
+                          ยกเลิก
+                        </button>
+                      </form>
+                    </div>
                   </div>
-                </div>
-
-                <p class="mt-4 text-sm text-gray-600">
-                  <svg class="w-4 h-4 inline mr-1" fill="currentColor" viewBox="0 0 20 20">
-                    <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z" clip-rule="evenodd"></path>
-                  </svg>
-                  To update academic information, please contact the registrar's office or your academic advisor.
-                </p>
-              </div>
 
-              <div class="mt-6 flex justify-end gap-3">
-                <button type="reset" class="bg-white border border-gray-300 text-gray-700 px-6 py-2 rounded-md hover:bg-gray-50 transition-colors font-medium">Cancel</button>
-                <button type="submit" class="bg-kku-blue text-white px-6 py-2 rounded-md hover:bg-kku-blue-dark transition-colors font-medium shadow">Save Changes</button>
-              </div>
-            </form>
-          </section>
-
-          <section data-tab-panel="registration" class="tab-panel hidden p-6" role="tabpanel">
-            <div class="pb-4">
-              <div class="flex items-center justify-between">
-                <div>
-                  <h3 class="text-lg font-semibold text-gray-900">Course & Section Registration</h3>
-                  <% if (!canRegister) { %>
-                    <p class="text-gray-600 text-sm mt-1">You have already registered. If you need to make changes, please contact the Admin.</p>
-                  <% } else { %>
-                    <p class="text-gray-600 text-sm mt-1">Search and register for available courses and sections.</p>
-                  <% } %>
+                  <!-- Quick Actions -->
+                  <section class="bg-white rounded-2xl shadow-lg p-6 border border-gray-100">
+                    <h3 class="text-xl font-semibold text-gray-900 mb-5 flex items-center gap-2">
+                      การทำงานด่วน
+                    </h3>
+
+                    <div class="space-y-3">
+                      <!-- Dashboard -->
+                      <a href="/student"
+                        class="flex items-center justify-center gap-2 bg-kku-blue hover:bg-kku-blue-dark text-white px-4 py-3 rounded-lg text-sm font-medium transition-all transform hover:scale-[1.02] shadow-sm hover:shadow-md">
+                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
+                          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
+                            d="M3 9.75L12 4l9 5.75V20a1 1 0 01-1 1h-5.25v-6h-5.5v6H4a1 1 0 01-1-1V9.75z" />
+                        </svg>
+                        แดชบอร์ดนักศึกษา
+                      </a>
+
+                      <!-- Submit Form -->
+                      <a href="/student/forms/submit"
+                        class="flex items-center justify-center gap-2 bg-gray-100 hover:bg-gray-200 text-gray-700 px-4 py-3 rounded-lg text-sm font-medium transition-all transform hover:scale-[1.02] shadow-sm hover:shadow-md">
+                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
+                          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4">
+                          </path>
+                        </svg>
+                        ยื่นแบบฟอร์ม
+                      </a>
+
+                      <!-- View All Form -->
+                      <a href="/student/formhistory"
+                        class="flex items-center justify-center gap-2 bg-gray-100 hover:bg-gray-200 text-gray-700 px-4 py-3 rounded-lg text-sm font-medium transition-all transform hover:scale-[1.02] shadow-sm hover:shadow-md">
+                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
+                          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
+                            d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"></path>
+                        </svg>
+                        แบบฟอร์มทั้งหมด
+                      </a>
+                    </div>
+                  </section>
                 </div>
-                <% if (canRegister) { %>
-                  <span id="courseCountBadge" class="hidden text-xs bg-gray-100 text-gray-700 px-2 py-1 rounded-full">0 results</span>
-                <% } %>
-              </div>
-            </div>
 
-            <% if (canRegister) { %>
-            <!-- Search Bar -->
-            <div class="mb-4 relative">
-              <span class="absolute left-3 top-1/2 -translate-y-1/2 pointer-events-none">
-                <svg class="w-4 h-4 text-gray-400" viewBox="0 0 24 24" fill="none" stroke="currentColor">
-                  <circle cx="11" cy="11" r="7" stroke-width="2"></circle>
-                  <path d="M20 20l-3.5-3.5" stroke-width="2" stroke-linecap="round"></path>
-                </svg>
-              </span>
-              <input type="text" id="courseSearch" placeholder="Search by course name or ID…"
-                     class="w-full pl-9 pr-3 py-2 border border-gray-300 rounded-md bg-white shadow-sm
-                            focus:outline-none focus:ring-2 focus:ring-kku-blue focus:border-transparent">
-            </div>
-
-            <form action="/student/profile/courses" method="POST" class="space-y-4">
-              <!-- Results -->
-              <div id="coursesContainer" class="space-y-3">
-                <div class="border border-dashed border-gray-300 rounded-lg p-6 text-center">
-                  <p class="text-sm text-gray-500">Start typing to search for courses…</p>
-                </div>
-              </div>
+                <!-- RIGHT: Tabs + Panels inside ONE card -->
+                <div class="lg:col-span-2">
+                  <div class="form-section p-0 overflow-hidden">
+                    <!-- Tabs header (pills) -->
+                    <div class="px-6 pt-4 pb-3">
+                      <nav class="flex flex-wrap gap-3" aria-label="ส่วนของโปรไฟล์" role="tablist">
+
+                        <!-- Profile (active) -->
+                        <button type="button" data-tab="info" role="tab" aria-selected="true"
+                          class="tab-btn group inline-flex items-center gap-2 px-5 py-4 text-sm rounded-xl border transition-all focus:outline-none focus-visible:ring-2 focus-visible:ring-blue-300 bg-gradient-to-r from-kku-blue to-kku-blue-dark text-white border-transparent shadow-md">
+                          <svg class="w-5 h-5 shrink-0" viewBox="0 0 24 24" fill="none" stroke="currentColor"
+                            stroke-width="2" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true">
+                            <path d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z" />
+                          </svg>
+                          <span>ข้อมูลส่วนตัว</span>
+                        </button>
+
+                        <!-- Course & Section -->
+                        <button type="button" data-tab="registration" role="tab" aria-selected="false"
+                          class="tab-btn group inline-flex items-center gap-2 px-5 py-4 text-sm rounded-xl border transition-all focus:outline-none focus-visible:ring-2 focus-visible:ring-blue-200 bg-white text-gray-700 border-gray-200 hover:bg-gray-50 hover:shadow-sm">
+                          <svg class="w-5 h-5 shrink-0" viewBox="0 0 24 24" fill="none" stroke="currentColor"
+                            stroke-width="2" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true">
+                            <path d="M5 3h12a3 3 0 0 1 3 3v13a3 3 0 0 1-3 3H5a3 3 0 0 1-3-3V6a3 3 0 0 1 3-3z"></path>
+                            <path d="M8 3v19"></path>
+                            <path d="M12 8h5"></path>
+                            <path d="M12 12h5"></path>
+                          </svg>
+                          <span>รายวิชา &amp; กลุ่มเรียน</span>
+                        </button>
+
+                        <!-- Change Password -->
+                        <button type="button" data-tab="password" role="tab" aria-selected="false"
+                          class="tab-btn group inline-flex items-center gap-2 px-5 py-4 text-sm rounded-xl border transition-all focus:outline-none focus-visible:ring-2 focus-visible:ring-blue-200 bg-white text-gray-700 border-gray-200 hover:bg-gray-50 hover:shadow-sm">
+                          <svg class="w-5 h-5 shrink-0" viewBox="0 0 24 24" fill="none" stroke="currentColor"
+                            stroke-width="2" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true">
+                            <rect x="3" y="11" width="18" height="10" rx="2" />
+                            <path d="M7 11V7a5 5 0 0110 0v4" />
+                          </svg>
+                          <span>เปลี่ยนรหัสผ่าน</span>
+                        </button>
+                      </nav>
+                    </div>
 
-              <!-- Actions -->
-              <div class="mt-6 flex justify-end gap-3 pt-4 border-t border-gray-200">
-                <button type="reset" class="bg-white border border-gray-300 text-gray-700 px-6 py-2 rounded-md hover:bg-gray-50 transition-colors font-medium">Cancel</button>
-                <button type="submit" class="bg-kku-blue text-white px-6 py-2 rounded-md hover:bg-kku-blue-dark transition-colors font-medium shadow">Register Selected</button>
-              </div>
-            </form>
-            <% } %>
+                    <div class="border-t border-gray-200"></div>
 
-            <!-- Registered -->
-            <% if (student?.courses && student.courses.length > 0) { %>
-            <div class="mt-8 pt-6 border-t border-gray-200">
-              <h4 class="text-md font-semibold text-gray-900 mb-3 flex items-center gap-2">
-                Registered Courses
-                <span class="text-xs bg-green-50 text-green-700 border border-green-200 px-2 py-0.5 rounded-full"><%= student.courses.length %> enrolled</span>
-                <span class="text-sm font-normal text-gray-600">(Contact Admin to change)</span>
-              </h4>
-
-              <div class="space-y-3">
-                <% student.courses.forEach(course => { 
-                  const courseId = (course && (course._id || course)).toString();
-                  const courseData = allCourses.find(c => c._id.toString() === courseId);
-                  if (!courseData) { return; }
-                %>
-                  <div class="border border-gray-200 p-4 rounded-lg bg-gray-50 hover:bg-white hover:shadow-sm transition">
-                    <div class="flex items-start justify-between">
-                      <div class="flex-1">
-                        <p class="font-semibold text-gray-900"><%= courseData.name %></p>
-                        <p class="text-sm text-gray-600">Course ID: <%= courseData.courseId %></p>
+                    <!-- PANELS -->
+                    <section data-tab-panel="info" class="tab-panel p-6" role="tabpanel">
+                      <div class="pb-4">
+                        <h3 class="text-lg font-semibold text-gray-900">ข้อมูลส่วนตัว</h3>
+                        <p class="text-gray-600 text-sm mt-1">อัปเดตข้อมูลส่วนตัวและช่องทางติดต่อของคุณ</p>
                       </div>
-                      <span class="bg-green-100 text-green-800 text-xs px-2 py-1 rounded">Enrolled</span>
-                    </div>
-
-                    <div class="mt-3">
-                      <label class="block text-sm font-medium text-gray-700 mb-1">Section</label>
-                      <select class="w-full px-3 py-2 bg-gray-100 border border-gray-300 rounded-md text-gray-600" disabled>
-                        <% courseData.sections.forEach(sec => { 
-                          const hasThisSection = (student.sections || []).some(s => {
-                            const sid = (s && (s._id || s)).toString();
-                            return sid === sec._id.toString();
-                          });
-                        %>
-                          <option value="<%= sec._id %>" <%= hasThisSection ? 'selected' : '' %>><%= sec.name %></option>
-                        <% }) %>
-                      </select>
-                    </div>
-                  </div>
-                <% }) %>
-              </div>
-            </div>
-            <% } %>
-          </section>
 
-          <section data-tab-panel="password" class="tab-panel hidden p-6" role="tabpanel">
-            <div class="pb-4">
-              <h3 class="text-lg font-semibold text-gray-900">Change Password</h3>
-              <p class="text-gray-600 text-sm mt-1">Update your password to keep your account secure.</p>
-            </div>
+                      <form action="/student/profile/update" method="POST" class="pt-2">
+                        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
+                          <div>
+                            <label for="name" class="block text-sm font-medium text-gray-800 mb-1">ชื่อ–นามสกุล</label>
+                            <input type="text" id="name" name="name" value="<%= student?.name %>" required
+                              class="w-full px-3 py-2 border rounded-md bg-white shadow-sm transition focus:outline-none focus:ring-2 focus:ring-kku-blue focus:border-transparent border-gray-300">
+                          </div>
+
+                          <div>
+                            <label for="studentId"
+                              class="block text-sm font-medium text-gray-800 mb-1">รหัสนักศึกษา</label>
+                            <input type="text" id="studentId" value="<%= student?.universityId %>" readonly
+                              class="w-full px-3 py-2 bg-gray-50 border border-gray-200 rounded-md text-gray-700 shadow-sm">
+                          </div>
+
+                          <div>
+                            <label for="email" class="block text-sm font-medium text-gray-800 mb-1">อีเมล</label>
+                            <input type="email" id="email" name="email" value="<%= student?.email %>" required
+                              class="w-full px-3 py-2 border rounded-md bg-white shadow-sm transition focus:outline-none focus:ring-2 focus:ring-kku-blue focus:border-transparent border-gray-300">
+                            <p class="text-xs text-gray-500 mt-1">โปรดใช้เมลมหาวิทยาลัยเพื่อความสะดวกในการติดต่อ</p>
+                          </div>
+
+                          <div>
+                            <label for="phone"
+                              class="block text-sm font-medium text-gray-800 mb-1">เบอร์โทรศัพท์</label>
+                            <input type="tel" id="phone" name="phone" value="<%= student?.phone || '' %>" required
+                              pattern="^0[0-9]{9}$" title="กรุณากรอกหมายเลขโทรศัพท์ให้ถูกต้อง เช่น 0812345678"
+                              class="w-full px-3 py-2 border rounded-md bg-white shadow-sm transition focus:outline-none focus:ring-2 focus:ring-kku-blue focus:border-transparent border-gray-300">
+                          </div>
+
+                          <div>
+                            <label for="dateOfBirth"
+                              class="block text-sm font-medium text-gray-800 mb-1">วันเกิด</label>
+                            <input type="date" id="dateOfBirth" name="dateOfBirth"
+                              value="<%= student?.dateOfBirth ? new Date(student.dateOfBirth).toISOString().split('T')[0] : '' %>"
+                              class="w-full px-3 py-2 border rounded-md bg-white shadow-sm transition focus:outline-none focus:ring-2 focus:ring-kku-blue focus:border-transparent border-gray-300">
+                          </div>
+
+                          <div>
+                            <label for="major" class="block text-sm font-medium text-gray-800 mb-1">สาขา</label>
+                            <input type="text" id="major" value="<%= student?.major %>" readonly
+                              class="w-full px-3 py-2 bg-gray-50 border border-gray-200 rounded-md text-gray-700 shadow-sm">
+                          </div>
+
+                          <div class="md:col-span-2">
+                            <label for="address" class="block text-sm font-medium text-gray-800 mb-1">ที่อยู่</label>
+                            <textarea id="address" name="address" rows="3"
+                              class="w-full px-3 py-2 border rounded-md bg-white shadow-sm transition focus:outline-none focus:ring-2 focus:ring-kku-blue focus:border-transparent border-gray-300"><%= student?.address || '' %></textarea>
+                          </div>
+                        </div>
+
+                        <!-- Academic (read-only) -->
+                        <div class="mt-8 pt-6 border-t border-gray-200">
+                          <h3 class="text-lg font-semibold text-gray-900">ข้อมูลการศึกษา</h3>
+                          <p class="text-gray-600 text-sm mt-1">ดูรายละเอียดด้านการศึกษา หากต้องการแก้ไข
+                            โปรดติดต่อทะเบียนหรืออาจารย์ที่ปรึกษา</p>
+
+                          <div class="mt-4 grid grid-cols-1 md:grid-cols-2 gap-6">
+                            <div>
+                              <label class="block text-sm font-medium text-gray-700 mb-1">สาขา</label>
+                              <input type="text" value="<%= student?.major %>" readonly
+                                class="w-full px-3 py-2 bg-gray-100 border border-gray-300 rounded-md text-gray-600">
+                            </div>
+                            <div>
+                              <label class="block text-sm font-medium text-gray-700 mb-1">คณะ/วิทยาลัย</label>
+                              <input type="text" value="วิทยาลัยการคอมพิวเตอร์" readonly
+                                class="w-full px-3 py-2 bg-gray-100 border border-gray-300 rounded-md text-gray-600">
+                            </div>
+                            <div>
+                              <label class="block text-sm font-medium text-gray-700 mb-1">ชั้นปี</label>
+                              <input type="text" value="<%= student?.yearOfStudy %>" readonly
+                                class="w-full px-3 py-2 bg-gray-100 border border-gray-300 rounded-md text-gray-600">
+                            </div>
+                            <div>
+                              <label class="block text-sm font-medium text-gray-700 mb-1">สิทธิ์ผู้ใช้</label>
+                              <input type="text" value="<%= student?.role %>" readonly
+                                class="w-full px-3 py-2 bg-gray-100 border border-gray-300 rounded-md text-gray-600 capitalize">
+                            </div>
+                          </div>
+
+                          <p class="mt-4 text-sm text-gray-600">
+                            <svg class="w-4 h-4 inline mr-1" fill="currentColor" viewBox="0 0 20 20">
+                              <path fill-rule="evenodd"
+                                d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z"
+                                clip-rule="evenodd"></path>
+                            </svg>
+                            หากต้องการอัปเดตข้อมูลการศึกษา โปรดติดต่อสำนักงานทะเบียน หรืออาจารย์ที่ปรึกษาของคุณ
+                          </p>
+                        </div>
+
+                        <div class="mt-6 flex justify-end gap-3">
+                          <button type="reset"
+                            class="bg-white border border-gray-300 text-gray-700 px-6 py-2 rounded-md hover:bg-gray-50 transition-colors font-medium">ยกเลิก</button>
+                          <button type="submit"
+                            class="bg-kku-blue text-white px-6 py-2 rounded-md hover:bg-kku-blue-dark transition-colors font-medium shadow">บันทึกการเปลี่ยนแปลง</button>
+                        </div>
+                      </form>
+                    </section>
+
+                    <section data-tab-panel="registration" class="tab-panel hidden p-6" role="tabpanel">
+                      <div class="pb-4">
+                        <div class="flex items-center justify-between">
+                          <div>
+                            <h3 class="text-lg font-semibold text-gray-900">ลงทะเบียนรายวิชาและกลุ่มเรียน</h3>
+                            <% if (!canRegister) { %>
+                              <p class="text-gray-600 text-sm mt-1">คุณได้ลงทะเบียนเรียบร้อยแล้ว หากต้องการเปลี่ยนแปลง
+                                โปรดติดต่อผู้ดูแลระบบ</p>
+                              <% } else { %>
+                                <p class="text-gray-600 text-sm mt-1">
+                                  ค้นหาและลงทะเบียนรายวิชาและกลุ่มเรียนที่เปิดให้ลงทะเบียน</p>
+                                <% } %>
+                          </div>
+                          <% if (canRegister) { %>
+                            <span id="courseCountBadge"
+                              class="hidden text-xs bg-gray-100 text-gray-700 px-2 py-1 rounded-full">0 รายการ</span>
+                            <% } %>
+                        </div>
+                      </div>
 
-            <form action="/student/profile/change-password" method="POST" class="pt-2">
-              <div class="space-y-6">
-                <div>
-                  <label for="oldPassword" class="block text-sm font-medium text-gray-800 mb-1">Current Password</label>
-                  <input type="password" id="oldPassword" name="oldPassword" required
-                         class="w-full px-3 py-2 border rounded-md bg-white shadow-sm transition focus:outline-none focus:ring-2 focus:ring-kku-blue focus:border-transparent <%= (typeof fieldErrors !== 'undefined' && fieldErrors && fieldErrors.oldPassword) ? 'border-red-500 ring-1 ring-red-300' : 'border-gray-300' %>" placeholder="รหัสผ่านเดิม">
-                  <% if (typeof fieldErrors !== 'undefined' && fieldErrors && fieldErrors.oldPassword) { %>
-                    <div class="text-xs mt-1 text-red-600"><%= fieldErrors.oldPassword %></div>
-                  <% } %>
-                </div>
+                      <% if (canRegister) { %>
+                        <!-- Search Bar -->
+                        <div class="mb-4 relative">
+                          <span class="absolute left-3 top-1/2 -translate-y-1/2 pointer-events-none">
+                            <svg class="w-4 h-4 text-gray-400" viewBox="0 0 24 24" fill="none" stroke="currentColor">
+                              <circle cx="11" cy="11" r="7" stroke-width="2"></circle>
+                              <path d="M20 20l-3.5-3.5" stroke-width="2" stroke-linecap="round"></path>
+                            </svg>
+                          </span>
+                          <input type="text" id="courseSearch" placeholder="พิมพ์ชื่อรายวิชาหรือรหัสวิชาเพื่อค้นหา…"
+                            class="w-full pl-9 pr-3 py-2 border border-gray-300 rounded-md bg-white shadow-sm focus:outline-none focus:ring-2 focus:ring-kku-blue focus:border-transparent">
+                        </div>
+
+                        <form action="/student/profile/courses" method="POST" class="space-y-4">
+                          <!-- Results -->
+                          <div id="coursesContainer" class="space-y-3">
+                            <div class="border border-dashed border-gray-300 rounded-lg p-6 text-center">
+                              <p class="text-sm text-gray-500">เริ่มพิมพ์เพื่อค้นหารายวิชา…</p>
+                            </div>
+                          </div>
+
+                          <!-- Actions -->
+                          <div class="mt-6 flex justify-end gap-3 pt-4 border-t border-gray-200">
+                            <button type="reset"
+                              class="bg-white border border-gray-300 text-gray-700 px-6 py-2 rounded-md hover:bg-gray-50 transition-colors font-medium">ยกเลิก</button>
+                            <button type="submit"
+                              class="bg-kku-blue text-white px-6 py-2 rounded-md hover:bg-kku-blue-dark transition-colors font-medium shadow">ลงทะเบียนที่เลือก</button>
+                          </div>
+                        </form>
+                        <% } %>
+
+                          <!-- Registered -->
+                          <% if (student?.courses && student.courses.length> 0) { %>
+                            <div class="mt-8 pt-6 border-t border-gray-200">
+                              <h4 class="text-md font-semibold text-gray-900 mb-3 flex items-center gap-2">
+                                รายวิชาที่ลงทะเบียนแล้ว
+                                <span
+                                  class="text-xs bg-green-50 text-green-700 border border-green-200 px-2 py-0.5 rounded-full">
+                                  <%= student.courses.length %> รายวิชา
+                                </span>
+                                <span class="text-sm font-normal text-gray-600">(หากต้องการแก้ไข
+                                  โปรดติดต่อผู้ดูแลระบบ)</span>
+                              </h4>
+
+                              <div class="space-y-3">
+                                <% student.courses.forEach(course=> {
+                                  const courseId = (course && (course._id || course)).toString();
+                                  const courseData = allCourses.find(c => c._id.toString() === courseId);
+                                  if (!courseData) { return; }
+                                  %>
+                                  <div
+                                    class="border border-gray-200 p-4 rounded-lg bg-gray-50 hover:bg-white hover:shadow-sm transition">
+                                    <div class="flex items-start justify-between">
+                                      <div class="flex-1">
+                                        <p class="font-semibold text-gray-900">
+                                          <%= courseData.name %>
+                                        </p>
+                                        <p class="text-sm text-gray-600">รหัสวิชา: <%= courseData.courseId %>
+                                        </p>
+                                      </div>
+                                      <span
+                                        class="bg-green-100 text-green-800 text-xs px-2 py-1 rounded">ลงทะเบียนแล้ว</span>
+                                    </div>
+
+                                    <div class="mt-3">
+                                      <label class="block text-sm font-medium text-gray-700 mb-1">กลุ่มเรียน</label>
+                                      <select
+                                        class="w-full px-3 py-2 bg-gray-100 border border-gray-300 rounded-md text-gray-600"
+                                        disabled>
+                                        <% courseData.sections.forEach(sec=> {
+                                          const hasThisSection = (student.sections || []).some(s => {
+                                          const sid = (s && (s._id || s)).toString();
+                                          return sid === sec._id.toString();
+                                          });
+                                          %>
+                                          <option value="<%= sec._id %>" <%=hasThisSection ? 'selected' : '' %>><%=
+                                              sec.name %>
+                                          </option>
+                                          <% }) %>
+                                      </select>
+                                    </div>
+                                  </div>
+                                  <% }) %>
+                              </div>
+                            </div>
+                            <% } %>
+                    </section>
+
+                    <section data-tab-panel="password" class="tab-panel hidden p-6" role="tabpanel">
+                      <div class="pb-4">
+                        <h3 class="text-lg font-semibold text-gray-900">เปลี่ยนรหัสผ่าน</h3>
+                        <p class="text-gray-600 text-sm mt-1">อัปเดตรหัสผ่านของคุณเพื่อความปลอดภัยของบัญชี</p>
+                      </div>
 
-                <div>
-                  <label for="newPassword" class="block text-sm font-medium text-gray-800 mb-1">New Password</label>
-                  <input type="password" id="newPassword" name="newPassword" required minlength="8"
-                         pattern="^(?=.*[a-z])(?=.*[A-Z])(?=.*\d).{8,}$"
-                         oninvalid="this.setCustomValidity('รหัสผ่านต้องมีอย่างน้อย 8 ตัว และมีตัวพิมพ์ใหญ่ ตัวพิมพ์เล็ก และตัวเลขอย่างน้อย 1 ตัว')"
-                         oninput="this.setCustomValidity('')"
-                         class="w-full px-3 py-2 border rounded-md bg-white shadow-sm transition focus:outline-none focus:ring-2 focus:ring-kku-blue focus:border-transparent <%= (typeof fieldErrors !== 'undefined' && fieldErrors && fieldErrors.newPassword) ? 'border-red-500 ring-1 ring-red-300' : 'border-gray-300' %>" placeholder="รหัสผ่านใหม่" />
-                  <% if (typeof fieldErrors !== 'undefined' && fieldErrors && fieldErrors.newPassword) { %>
-                    <div class="text-xs mt-1 text-red-600"><%= fieldErrors.newPassword %></div>
-                  <% } %>
-
-                  <div class="mt-3 rounded-md bg-gray-50 border border-gray-200 p-3">
-                    <div class="text-xs text-gray-700 font-medium">Password must contain:</div>
-                    <ul class="text-xs text-gray-600 mt-1 space-y-1">
-                      <li id="lengthCheck" class="flex items-center"><span class="w-4 h-4 mr-2">❌</span>At least 8 characters</li>
-                      <li id="uppercaseCheck" class="flex items-center"><span class="w-4 h-4 mr-2">❌</span>One uppercase letter</li>
-                      <li id="lowercaseCheck" class="flex items-center"><span class="w-4 h-4 mr-2">❌</span>One lowercase letter</li>
-                      <li id="numberCheck" class="flex items-center"><span class="w-4 h-4 mr-2">❌</span>One number</li>
-                    </ul>
+                      <form action="/student/profile/change-password" method="POST" class="pt-2">
+                        <div class="space-y-6">
+                          <div>
+                            <label for="oldPassword"
+                              class="block text-sm font-medium text-gray-800 mb-1">รหัสผ่านเดิม</label>
+                            <input type="password" id="oldPassword" name="oldPassword" required
+                              class="w-full px-3 py-2 border rounded-md bg-white shadow-sm transition focus:outline-none focus:ring-2 focus:ring-kku-blue focus:border-transparent <%= (typeof fieldErrors !== 'undefined' && fieldErrors && fieldErrors.oldPassword) ? 'border-red-500 ring-1 ring-red-300' : 'border-gray-300' %>"
+                              placeholder="รหัสผ่านเดิม">
+                            <% if (typeof fieldErrors !=='undefined' && fieldErrors && fieldErrors.oldPassword) { %>
+                              <div class="text-xs mt-1 text-red-600">
+                                <%= fieldErrors.oldPassword %>
+                              </div>
+                              <% } %>
+                          </div>
+
+                          <div>
+                            <label for="newPassword"
+                              class="block text-sm font-medium text-gray-800 mb-1">รหัสผ่านใหม่</label>
+                            <input type="password" id="newPassword" name="newPassword" required minlength="8"
+                              pattern="^(?=.*[a-z])(?=.*[A-Z])(?=.*\d).{8,}$"
+                              oninvalid="this.setCustomValidity('รหัสผ่านต้องมีอย่างน้อย 8 ตัว และมีตัวพิมพ์ใหญ่ ตัวพิมพ์เล็ก และตัวเลขอย่างน้อย 1 ตัว')"
+                              oninput="this.setCustomValidity('')"
+                              class="w-full px-3 py-2 border rounded-md bg-white shadow-sm transition focus:outline-none focus:ring-2 focus:ring-kku-blue focus:border-transparent <%= (typeof fieldErrors !== 'undefined' && fieldErrors && fieldErrors.newPassword) ? 'border-red-500 ring-1 ring-red-300' : 'border-gray-300' %>"
+                              placeholder="รหัสผ่านใหม่" />
+                            <% if (typeof fieldErrors !=='undefined' && fieldErrors && fieldErrors.newPassword) { %>
+                              <div class="text-xs mt-1 text-red-600">
+                                <%= fieldErrors.newPassword %>
+                              </div>
+                              <% } %>
+
+                                <div class="mt-3 rounded-md bg-gray-50 border border-gray-200 p-3">
+                                  <div class="text-xs text-gray-700 font-medium">รหัสผ่านต้องมี:</div>
+                                  <ul class="text-xs text-gray-600 mt-1 space-y-1">
+                                    <li id="lengthCheck" class="flex items-center"><span
+                                        class="w-4 h-4 mr-2">❌</span>อย่างน้อย 8 ตัวอักษร</li>
+                                    <li id="uppercaseCheck" class="flex items-center"><span
+                                        class="w-4 h-4 mr-2">❌</span>อักษรตัวพิมพ์ใหญ่อย่างน้อย 1 ตัว</li>
+                                    <li id="lowercaseCheck" class="flex items-center"><span
+                                        class="w-4 h-4 mr-2">❌</span>อักษรตัวพิมพ์เล็กอย่างน้อย 1 ตัว</li>
+                                    <li id="numberCheck" class="flex items-center"><span
+                                        class="w-4 h-4 mr-2">❌</span>ตัวเลขอย่างน้อย 1 ตัว</li>
+                                  </ul>
+                                </div>
+                          </div>
+
+                          <div>
+                            <label for="confirmPassword"
+                              class="block text-sm font-medium text-gray-800 mb-1">ยืนยันรหัสผ่านใหม่</label>
+                            <input type="password" id="confirmPassword" name="confirmPassword" required
+                              class="w-full px-3 py-2 border rounded-md bg-white shadow-sm transition focus:outline-none focus:ring-2 focus:ring-kku-blue focus:border-transparent <%= (typeof fieldErrors !== 'undefined' && fieldErrors && fieldErrors.confirmPassword) ? 'border-red-500 ring-1 ring-red-300' : 'border-gray-300' %>"
+                              placeholder="ยืนยันรหัสผ่านใหม่">
+                            <div id="passwordMatch" class="text-xs mt-1 hidden"></div>
+                            <% if (typeof fieldErrors !=='undefined' && fieldErrors && fieldErrors.confirmPassword) { %>
+                              <div class="text-xs mt-1 text-red-600">
+                                <%= fieldErrors.confirmPassword %>
+                              </div>
+                              <% } %>
+                          </div>
+                        </div>
+
+                        <div class="mt-6 flex justify-end gap-3">
+                          <button type="reset"
+                            class="bg-white border border-gray-300 text-gray-700 px-6 py-2 rounded-md hover:bg-gray-50 transition-colors font-medium">ยกเลิก</button>
+                          <button type="submit"
+                            class="bg-kku-blue text-white px-6 py-2 rounded-md hover:bg-kku-blue-dark transition-colors font-medium shadow">เปลี่ยนรหัสผ่าน</button>
+                        </div>
+                      </form>
+                    </section>
                   </div>
                 </div>
-
-                <div>
-                  <label for="confirmPassword" class="block text-sm font-medium text-gray-800 mb-1">Confirm New Password</label>
-                  <input type="password" id="confirmPassword" name="confirmPassword" required
-                         class="w-full px-3 py-2 border rounded-md bg-white shadow-sm transition focus:outline-none focus:ring-2 focus:ring-kku-blue focus:border-transparent <%= (typeof fieldErrors !== 'undefined' && fieldErrors && fieldErrors.confirmPassword) ? 'border-red-500 ring-1 ring-red-300' : 'border-gray-300' %>" placeholder="ยืนยันรหัสผ่านใหม่">
-                  <div id="passwordMatch" class="text-xs mt-1 hidden"></div>
-                  <% if (typeof fieldErrors !== 'undefined' && fieldErrors && fieldErrors.confirmPassword) { %>
-                    <div class="text-xs mt-1 text-red-600"><%= fieldErrors.confirmPassword %></div>
-                  <% } %>
-                </div>
-              </div>
-
-              <div class="mt-6 flex justify-end gap-3">
-                <button type="reset" class="bg-white border border-gray-300 text-gray-700 px-6 py-2 rounded-md hover:bg-gray-50 transition-colors font-medium">Cancel</button>
-                <button type="submit" class="bg-kku-blue text-white px-6 py-2 rounded-md hover:bg-kku-blue-dark transition-colors font-medium shadow">Change Password</button>
               </div>
-            </form>
-          </section>
-        </div>
-      </div>
-    </div>
-  </main>
-
-  <!-- Footer -->
-  <footer class="bg-gray-100 text-gray-600 py-4 text-center text-sm mt-8">
-    <p>&copy; 2024 Faculty of Computer Science, Khon Kaen University. All rights reserved.</p>
-  </footer>
+    </main>
+
+    <script>
+      // Navigation
+      function goToDashboard() { window.location.href = '/student'; }
+
+      // =========================
+      // Tabs
+      // =========================
+      (function () {
+        const tabBtns = Array.from(document.querySelectorAll('.tab-btn[data-tab]'));
+        const panels = Array.from(document.querySelectorAll('[data-tab-panel]'));
+        function setActiveStyles(btn, active) {
+          if (active) {
+            btn.setAttribute('aria-selected', 'true');
+            btn.classList.add('bg-gradient-to-r', 'from-kku-blue', 'to-kku-blue-dark', 'text-white', 'border-transparent', 'shadow-md', 'font-semibold');
+            btn.classList.remove('bg-white', 'text-gray-700', 'border-gray-200', 'hover:bg-gray-50', 'hover:shadow-sm', 'font-medium');
+          } else {
+            btn.setAttribute('aria-selected', 'false');
+            btn.classList.add('bg-white', 'text-gray-700', 'border-gray-200', 'hover:bg-gray-50', 'hover:shadow-sm', 'font-medium');
+            btn.classList.remove('bg-gradient-to-r', 'from-kku-blue', 'to-kku-blue-dark', 'text-white', 'border-transparent', 'shadow-md', 'font-semibold');
+          }
+        }
+        function showTab(name) {
+          panels.forEach(p => p.classList.toggle('hidden', p.getAttribute('data-tab-panel') !== name));
+          tabBtns.forEach(b => setActiveStyles(b, b.getAttribute('data-tab') === name));
+        }
+        tabBtns.forEach(btn => { btn.addEventListener('click', () => showTab(btn.getAttribute('data-tab'))); });
+        showTab('info');
+      })();
+
+      // =========================
+      // Avatar Instant Preview
+      // =========================
+      (function () {
+        const avatarInputEl = document.getElementById('avatarInput');
+        const uploadBtn = document.getElementById('uploadAvatarBtn');
+        const cancelBtn = document.getElementById('cancelAvatarBtn');
+        const avatarImg = document.querySelector('.profile-avatar img');
+        const wrapper = document.getElementById('avatarWrapper');
+        const cameraFab = document.getElementById('cameraFab');
+
+        if (!avatarInputEl || !uploadBtn || !avatarImg) return;
+
+        if (!avatarImg.dataset.original) { avatarImg.dataset.original = avatarImg.src; }
+
+        let previewObjectUrl = null;
+
+        function showPreview(file) {
+          if (previewObjectUrl) URL.revokeObjectURL(previewObjectUrl);
+          previewObjectUrl = URL.createObjectURL(file);
+          avatarImg.src = previewObjectUrl;
+          uploadBtn.classList.remove('hidden');
+          if (cancelBtn) cancelBtn.classList.remove('hidden');
+        }
 
-  <script>
-    // Navigation
-    function goToDashboard() { window.location.href = '/student'; }
-
-    // =========================
-    // Tabs (Pills on single card)
-    // =========================
-    (function() {
-      const tabBtns = Array.from(document.querySelectorAll('.tab-btn[data-tab]'));
-      const panels  = Array.from(document.querySelectorAll('[data-tab-panel]'));
-function setActiveStyles(btn, active) {
-  if (active) {
-    btn.setAttribute('aria-selected', 'true');
-    btn.classList.add(
-      'bg-gradient-to-r','from-kku-blue','to-kku-blue-dark',
-      'text-white','border-transparent','shadow-md','font-semibold'
-    );
-    btn.classList.remove(
-      'bg-white','text-gray-700','border-gray-200','hover:bg-gray-50','hover:shadow-sm','font-medium'
-    );
-  } else {
-    btn.setAttribute('aria-selected', 'false');
-    btn.classList.add(
-      'bg-white','text-gray-700','border-gray-200','hover:bg-gray-50','hover:shadow-sm','font-medium'
-    );
-    btn.classList.remove(
-      'bg-gradient-to-r','from-kku-blue','to-kku-blue-dark',
-      'text-white','border-transparent','shadow-md','font-semibold'
-    );
-  }
-}
-
-      function showTab(name) {
-        panels.forEach(p => p.classList.toggle('hidden', p.getAttribute('data-tab-panel') !== name));
-        tabBtns.forEach(b => setActiveStyles(b, b.getAttribute('data-tab') === name));
-      }
+        function resetPreview() {
+          if (previewObjectUrl) { URL.revokeObjectURL(previewObjectUrl); previewObjectUrl = null; }
+          avatarImg.src = avatarImg.dataset.original || avatarImg.src;
+          avatarInputEl.value = '';
+          uploadBtn.classList.add('hidden');
+          if (cancelBtn) cancelBtn.classList.add('hidden');
+        }
 
-      tabBtns.forEach(btn => {
-        btn.addEventListener('click', () => showTab(btn.getAttribute('data-tab')));
-      });
-
-      // default
-      showTab('info');
-    })();
-
-    // =========================
-    // Avatar Instant Preview
-    // =========================
-    (function () {
-      const avatarInputEl = document.getElementById('avatarInput');
-      const uploadBtn     = document.getElementById('uploadAvatarBtn');
-      const cancelBtn     = document.getElementById('cancelAvatarBtn');
-      const avatarImg     = document.querySelector('.profile-avatar img');
-      const wrapper    = document.getElementById('avatarWrapper');
-      const cameraFab  = document.getElementById('cameraFab');
-
-      if (!avatarInputEl || !uploadBtn || !avatarImg) return;
-
-      if (!avatarImg.dataset.original) {
-        avatarImg.dataset.original = avatarImg.src;
-      }
+        if (wrapper) wrapper.addEventListener('click', () => avatarInputEl.click());
+        if (cameraFab) cameraFab.addEventListener('click', () => avatarInputEl.click());
 
-      let previewObjectUrl = null;   
+        avatarInputEl.addEventListener('change', (e) => {
+          const file = e.target.files && e.target.files[0];
+          if (!file) { resetPreview(); return; }
 
-      function showPreview(file) {
-        if (previewObjectUrl) URL.revokeObjectURL(previewObjectUrl);
-        previewObjectUrl = URL.createObjectURL(file);
-        avatarImg.src = previewObjectUrl;
-        uploadBtn.classList.remove('hidden');
-        if (cancelBtn) cancelBtn.classList.remove('hidden');
-      }
+          const validTypes = ['image/png', 'image/jpeg', 'image/jpg', 'image/gif', 'image/webp'];
+          if (!validTypes.includes(file.type)) {
+            alert('ไฟล์ต้องเป็นรูป .png/.jpg/.jpeg/.gif/.webp เท่านั้น กรุณาเลือกไฟล์ใหม่');
+            resetPreview(); return;
+          }
+          const maxBytes = 5 * 1024 * 1024; // 5MB
+          if (file.size > maxBytes) {
+            alert('ไฟล์ใหญ่เกิน 5MB กรุณาเลือกไฟล์ใหม่');
+            resetPreview(); return;
+          }
+          showPreview(file);
+        });
 
-      function resetPreview() {
-        if (previewObjectUrl) {
-          URL.revokeObjectURL(previewObjectUrl);
-          previewObjectUrl = null;
-        }
-        avatarImg.src = avatarImg.dataset.original || avatarImg.src;
-        avatarInputEl.value = '';
-        uploadBtn.classList.add('hidden');
-        if (cancelBtn) cancelBtn.classList.add('hidden');
+        if (cancelBtn) cancelBtn.addEventListener('click', resetPreview);
+        const form = avatarInputEl.closest('form');
+        if (form) form.addEventListener('reset', resetPreview);
+      })();
+
+      // =========================
+      // Password Validation
+      // =========================
+      const newPasswordInput = document.getElementById('newPassword');
+      const confirmPasswordInput = document.getElementById('confirmPassword');
+
+      if (newPasswordInput) newPasswordInput.addEventListener('input', validatePassword);
+      if (confirmPasswordInput) confirmPasswordInput.addEventListener('input', checkPasswordMatch);
+
+      function validatePassword() {
+        const password = newPasswordInput.value;
+        updateCheck('lengthCheck', password.length >= 8);
+        updateCheck('uppercaseCheck', /[A-Z]/.test(password));
+        updateCheck('lowercaseCheck', /[a-z]/.test(password));
+        updateCheck('numberCheck', /\d/.test(password));
       }
 
-      if (wrapper)   wrapper.addEventListener('click', () => avatarInputEl.click());
-      if (cameraFab) cameraFab.addEventListener('click', () => avatarInputEl.click());
-
-      avatarInputEl.addEventListener('change', (e) => {
-        const file = e.target.files && e.target.files[0];
-        if (!file) { resetPreview(); return; }
-
-        const validTypes = ['image/png','image/jpeg','image/jpg','image/gif','image/webp'];
-        if (!validTypes.includes(file.type)) {
-          alert('ไฟล์ต้องเป็นรูป .png/.jpg/.jpeg/.gif/.webp เท่านั้น กรุณาเลือกไฟล์ใหม่');
-          resetPreview();
-          return;
-        }
-        const maxBytes = 5 * 1024 * 1024; // 5MB
-        if (file.size > maxBytes) {
-          alert('ไฟล์ใหญ่เกิน 5MB กรุณาเลือกไฟล์ใหม่');
-          resetPreview();
-          return;
+      function updateCheck(id, isValid) {
+        const element = document.getElementById(id);
+        const icon = element ? element.querySelector('span') : null;
+        if (!element || !icon) return;
+        if (isValid) {
+          icon.textContent = '✅';
+          element.classList.add('text-green-600');
+          element.classList.remove('text-gray-600');
+        } else {
+          icon.textContent = '❌';
+          element.classList.add('text-gray-600');
+          element.classList.remove('text-green-600');
         }
-        showPreview(file);
-      });
-
-      if (cancelBtn) cancelBtn.addEventListener('click', resetPreview);
-
-      const form = avatarInputEl.closest('form');
-      if (form) form.addEventListener('reset', resetPreview);
-    })();
-
-    // =========================
-    // Password Validation
-    // =========================
-    const newPasswordInput = document.getElementById('newPassword');
-    const confirmPasswordInput = document.getElementById('confirmPassword');
-
-    if (newPasswordInput) newPasswordInput.addEventListener('input', validatePassword);
-    if (confirmPasswordInput) confirmPasswordInput.addEventListener('input', checkPasswordMatch);
-
-    function validatePassword() {
-      const password = newPasswordInput.value;
-      updateCheck('lengthCheck', password.length >= 8);
-      updateCheck('uppercaseCheck', /[A-Z]/.test(password));
-      updateCheck('lowercaseCheck', /[a-z]/.test(password));
-      updateCheck('numberCheck', /\d/.test(password));
-    }
-
-    function updateCheck(id, isValid) {
-      const element = document.getElementById(id);
-      const icon = element ? element.querySelector('span') : null;
-      if (!element || !icon) return;
-      if (isValid) {
-        icon.textContent = '✅';
-        element.classList.add('text-green-600');
-        element.classList.remove('text-gray-600');
-      } else {
-        icon.textContent = '❌';
-        element.classList.add('text-gray-600');
-        element.classList.remove('text-green-600');
       }
-    }
 
-    function checkPasswordMatch() {
-      const newPassword = newPasswordInput ? newPasswordInput.value : '';
-      const theConfirm = confirmPasswordInput ? confirmPasswordInput.value : '';
-      const matchElement = document.getElementById('passwordMatch');
-      if (!matchElement) return;
-
-      if (theConfirm.length > 0) {
-        matchElement.classList.remove('hidden');
-        if (newPassword === theConfirm) {
-          matchElement.textContent = '✅ Passwords match';
-          matchElement.className = 'text-xs mt-1 text-green-600';
+      function checkPasswordMatch() {
+        const newPassword = newPasswordInput ? newPasswordInput.value : '';
+        const theConfirm = confirmPasswordInput ? confirmPasswordInput.value : '';
+        const matchElement = document.getElementById('passwordMatch');
+        if (!matchElement) return;
+
+        if (theConfirm.length > 0) {
+          matchElement.classList.remove('hidden');
+          if (newPassword === theConfirm) {
+            matchElement.textContent = '✅ รหัสผ่านตรงกัน';
+            matchElement.className = 'text-xs mt-1 text-green-600';
+          } else {
+            matchElement.textContent = '❌ รหัสผ่านไม่ตรงกัน';
+            matchElement.className = 'text-xs mt-1 text-red-600';
+          }
         } else {
-          matchElement.textContent = '❌ Passwords do not match';
-          matchElement.className = 'text-xs mt-1 text-red-600';
+          matchElement.classList.add('hidden');
         }
-      } else {
-        matchElement.classList.add('hidden');
       }
-    }
 
-    // =========================
-    // Course Search (when canRegister)
-    // =========================
-    const CAN_REGISTER = <%= canRegister ? 'true' : 'false' %>;
-    if (CAN_REGISTER) {
-      const searchInput      = document.getElementById('courseSearch');
-      const coursesContainer = document.getElementById('coursesContainer');
-      const countBadge       = document.getElementById('courseCountBadge');
+      // =========================
+      // Course Search (when canRegister)
+      // =========================
+      const CAN_REGISTER = <%= canRegister ? 'true' : 'false' %>;
+      if (CAN_REGISTER) {
+        const searchInput = document.getElementById('courseSearch');
+        const coursesContainer = document.getElementById('coursesContainer');
+        const countBadge = document.getElementById('courseCountBadge');
 
-      const allCourses = <%- JSON.stringify(allCourses) %>;
-      const registeredCourseIds = <%- JSON.stringify((student?.courses || []).map(c => (c && (c._id || c)).toString())) %>;
+        const allCourses = <%- JSON.stringify(allCourses) %>;
+        const registeredCourseIds = <%- JSON.stringify((student?.courses || []).map(c => (c && (c._id || c)).toString())) %>;
 
-      function renderEmpty(text) {
-        coursesContainer.innerHTML = `
+        function renderEmpty(text) {
+          coursesContainer.innerHTML = `
           <div class="border border-dashed border-gray-300 rounded-lg p-6 text-center">
             <p class="text-sm text-gray-500">${text}</p>
           </div>`;
-      }
+        }
 
-      function updateCount(n) {
-        if (!countBadge) return;
-        countBadge.textContent = `${n} ${n === 1 ? 'result' : 'results'}`;
-        countBadge.classList.toggle('hidden', false);
-      }
+        function updateCount(n) {
+          if (!countBadge) return;
+          countBadge.textContent = `${n} รายการ`;
+          countBadge.classList.toggle('hidden', false);
+        }
 
-      function debounce(fn, ms) {
-        let t; return (...args) => { clearTimeout(t); t = setTimeout(() => fn.apply(this, args), ms); };
-      }
+        function debounce(fn, ms) { let t; return (...args) => { clearTimeout(t); t = setTimeout(() => fn.apply(this, args), ms); }; }
 
-      function onSearchInput(e) {
-        const query = e.target.value.toLowerCase().trim();
-        coursesContainer.innerHTML = '';
+        function onSearchInput(e) {
+          const query = e.target.value.toLowerCase().trim();
+          coursesContainer.innerHTML = '';
 
-        if (!query) {
-          renderEmpty('Start typing to search for courses...');
-          if (countBadge) countBadge.classList.add('hidden');
-          return;
-        }
+          if (!query) {
+            renderEmpty('เริ่มพิมพ์เพื่อค้นหารายวิชา…');
+            if (countBadge) countBadge.classList.add('hidden');
+            return;
+          }
 
-        const filteredCourses = allCourses
-          .filter(course => {
-            if (registeredCourseIds.includes(course._id.toString())) return false;
-            const name = (course.name || '').toLowerCase();
-            const id   = (course.courseId || '').toLowerCase();
-            return name.includes(query) || id.includes(query);
-          })
-          .sort((a,b) => (a.name||'').localeCompare(b.name||''));
-
-        if (filteredCourses.length === 0) {
-          renderEmpty('No courses found matching your search.');
-          updateCount(0);
-          return;
-        }
+          const filteredCourses = allCourses
+            .filter(course => {
+              if (registeredCourseIds.includes(course._id.toString())) return false;
+              const name = (course.name || '').toLowerCase();
+              const id = (course.courseId || '').toLowerCase();
+              return name.includes(query) || id.includes(query);
+            })
+            .sort((a, b) => (a.name || '').localeCompare(b.name || ''));
+
+          if (filteredCourses.length === 0) {
+            renderEmpty('ไม่พบรายวิชาที่ตรงกับคำค้นหา');
+            updateCount(0);
+            return;
+          }
 
-        updateCount(filteredCourses.length);
+          updateCount(filteredCourses.length);
 
-        filteredCourses.forEach(course => {
-          const wrapper = document.createElement('div');
-          wrapper.className = 'rounded-lg';
+          filteredCourses.forEach(course => {
+            const wrapper = document.createElement('div');
+            wrapper.className = 'rounded-lg';
 
-          let sectionOptions = '';
-          (course.sections || []).forEach(sec => {
-            sectionOptions += `<option value="${sec._id}">${sec.name}</option>`;
-          });
+            let sectionOptions = '';
+            (course.sections || []).forEach(sec => {
+              sectionOptions += `<option value="${sec._id}">${sec.name}</option>`;
+            });
 
-          wrapper.innerHTML = `
+            wrapper.innerHTML = `
             <label class="flex items-start cursor-pointer">
               <input type="checkbox" name="selectedCourses" value="${course._id}"
                 class="peer mt-1 h-4 w-4 text-kku-blue focus:ring-kku-blue border-gray-300 rounded">
-              <div class="ml-3 flex-1 border border-gray-200 rounded-lg p-4 bg-white shadow-sm hover:shadow transition
-                          peer-checked:border-kku-blue peer-checked:bg-blue-50">
+              <div class="ml-3 flex-1 border border-gray-200 rounded-lg p-4 bg-white shadow-sm hover:shadow transition peer-checked:border-kku-blue peer-checked:bg-blue-50">
                 <div class="flex items-center justify-between">
                   <div>
                     <div class="font-semibold text-gray-900">${course.name}</div>
-                    <div class="text-sm text-gray-600">Course ID: ${course.courseId}</div>
+                    <div class="text-sm text-gray-600">รหัสวิชา: ${course.courseId}</div>
                   </div>
-                  <span class="hidden peer-checked:inline-block text-xs bg-blue-100 text-kku-blue px-2 py-0.5 rounded">Selected</span>
+                  <span class="hidden peer-checked:inline-block text-xs bg-blue-100 text-kku-blue px-2 py-0.5 rounded">เลือกแล้ว</span>
                 </div>
                 <div class="mt-3">
-                  <label class="block text-sm font-medium text-gray-700 mb-1">Select Section:</label>
+                  <label class="block text-sm font-medium text-gray-700 mb-1">เลือกกลุ่มเรียน:</label>
                   <select name="selectedSections_${course._id}" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-kku-blue focus:border-transparent">
                     ${sectionOptions}
                   </select>
@@ -808,15 +780,16 @@ function setActiveStyles(btn, active) {
               </div>
             </label>
           `;
-          coursesContainer.appendChild(wrapper);
-        });
-      }
+            coursesContainer.appendChild(wrapper);
+          });
+        }
 
-      if (searchInput && coursesContainer) {
-        searchInput.addEventListener('input', debounce(onSearchInput, 200));
-        renderEmpty('Start typing to search for courses...');
+        if (searchInput && coursesContainer) {
+          searchInput.addEventListener('input', debounce(onSearchInput, 200));
+          renderEmpty('เริ่มพิมพ์เพื่อค้นหารายวิชา…');
+        }
       }
-    }
-  </script>
+    </script>
 </body>
-</html>
+
+</html>
\ No newline at end of file
