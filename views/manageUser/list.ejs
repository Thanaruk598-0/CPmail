<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Manage Users</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <style>
    body { background-color: #f8f9fa; font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; }
    .header-section { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 20px; border-radius: 12px; margin-bottom: 20px; }
    .header-title { font-size: 1.5rem; font-weight: 600; margin-bottom: 5px; }
    .header-subtitle { font-size: 0.9rem; opacity: 0.9; }
    .stats-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px; margin-bottom: 20px; }
    .stat-card { background: white; border-radius: 12px; padding: 20px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); border-left: 4px solid; text-align: center; transition: transform 0.2s; }
    .stat-card:hover { transform: translateY(-2px); }
    .stat-card.total { border-left-color: #dc3545; } /* Red like admin badge */
    .stat-card.active { border-left-color: #198754; } /* Green like secure */
    .stat-card.lecturers { border-left-color: #0dcaf0; } /* Cyan for lecturers */
    .stat-card.pending { border-left-color: #6c757d; } /* Gray for pending */
    .stat-number { font-size: 2rem; font-weight: bold; color: #212529; }
    .stat-label { font-size: 0.85rem; color: #6c757d; text-transform: uppercase; letter-spacing: 0.5px; }
    .filter-section { background: white; border-radius: 12px; padding: 20px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); margin-bottom: 20px; }
    .table-container { background: white; border-radius: 12px; overflow: hidden; box-shadow: 0 2px 10px rgba(0,0,0,0.1); }
    .table thead th { background: #f8f9fa; border: none; font-weight: 500; color: #495057; }
    .table tbody td { vertical-align: middle; }
    .admin-badge { background: #dc3545; color: white; padding: 4px 8px; border-radius: 20px; font-size: 0.75rem; font-weight: 500; }
    .role-badge { padding: 4px 8px; border-radius: 20px; font-size: 0.75rem; font-weight: 500; }
    .role-student { background: #0d6efd; color: white; }
    .role-lecturer { background: #198754; color: white; }
    .role-admin { background: #dc3545; color: white; }
    .status-active { background: #198754; color: white; }
    .status-inactive { background: #6c757d; color: white; }
    .btn-clear { background: #6c757d; border-color: #6c757d; color: white; }
    .btn-clear:hover { background: #5a6268; }
    .avatar-img { width: 40px; height: 40px; border-radius: 50%; object-fit: cover; }
  </style>
</head>
<body>

  <%- include('../partials/navbar', { currentUser: currentUser, activeMenu: activeMenu }) %>

  <div class="container mt-4">
    <!-- Header Section คล้ายรูป -->
    <div class="header-section">
      <div class="row align-items-center">
        <div class="col-md-8">
          <div class="header-title">User Management Dashboard</div>
          <div class="header-subtitle">จัดการผู้ใช้และสถิติระบบของคุณ</div>
        </div>
        <div class="col-md-4 text-end">
          <span class="badge bg-light text-dark fs-6">Admin Mode</span>
        </div>
      </div>
    </div>

    <!-- Stats Cards คล้าย System Overview -->
    <div class="stats-grid">
      <div class="stat-card total">
        <div class="stat-number"><%= stats.totalUsers %></div>
        <div class="stat-label">Total Users</div>
      </div>
      <div class="stat-card active">
        <div class="stat-number"><%= stats.activeUsers %></div>
        <div class="stat-label">Active Users</div>
      </div>
      <div class="stat-card lecturers">
        <div class="stat-number"><%= stats.lecturers %></div>
        <div class="stat-label">Lecturers</div>
      </div>
      <div class="stat-card pending">
        <div class="stat-number"><%= stats.pending %></div>
        <div class="stat-label">Pending</div>
      </div>
    </div>

    <div class="row">
      <div class="col-12">
        <!-- Add New User Button คล้ายรูป -->
        <div class="d-flex justify-content-between align-items-center mb-3">
          <h5 class="mb-0">ผู้ใช้ทั้งหมด</h5>
          <a href="/manageUser/add" class="btn btn-primary">Add New User</a>
        </div>

        <!-- Filter Section -->
        <div class="filter-section">
          <form method="GET" action="/manageUser/list" class="row g-3 align-items-end">
            <div class="col-md-4">
              <label class="form-label">ค้นหา</label>
              <input type="text" name="search" class="form-control" placeholder="Search by name or email" value="<%= search %>">
            </div>
            <div class="col-md-2">
              <label class="form-label">Role</label>
              <select name="role" class="form-select">
                <option value="all" <%= role === 'all' ? 'selected' : '' %>>All Roles</option>
                <option value="student" <%= role === 'student' ? 'selected' : '' %>>Student</option>
                <option value="lecturer" <%= role === 'lecturer' ? 'selected' : '' %>>Lecturer</option>
                <option value="admin" <%= role === 'admin' ? 'selected' : '' %>>Admin</option>
              </select>
            </div>
            <div class="col-md-2">
              <label class="form-label">Status</label>
              <select name="status" class="form-select">
                <option value="all" <%= status === 'all' ? 'selected' : '' %>>All Status</option>
                <option value="active" <%= status === 'active' ? 'selected' : '' %>>Active</option>
                <option value="inactive" <%= status === 'inactive' ? 'selected' : '' %>>Inactive</option>
              </select>
            </div>
            <div class="col-md-2">
              <button type="submit" class="btn btn-outline-primary w-100">Filter</button>
            </div>
            <div class="col-md-2">
              <% if (search || role !== 'all' || status !== 'all') { %>
                <a href="/manageUser/list" class="btn btn-clear w-100">Clear Filters</a>
              <% } else { %>
                <button type="button" class="btn btn-secondary w-100" disabled>Clear Filters</button>
              <% } %>
            </div>
          </form>
        </div>

        <!-- Users Table คล้าย Administrator Information -->
        <div class="table-container">
          <table class="table table-hover mb-0">
            <thead>
              <tr>
                <th>Name</th>
                <th>Email</th>
                <th>Role</th>
                <th>Status</th>
                <th>Last Login</th>
                <th>Actions</th>
              </tr>
            </thead>
            <tbody>
              <% users.forEach(user => { %>
                <tr>
                  <td>
                    <img src="<%= user.avatarUrl || 'https://via.placeholder.com/40' %>" alt="Avatar" class="avatar-img me-2">
                    <%= user.name %>
                  </td>
                  <td><%= user.email %></td>
                  <td>
                    <span class="role-badge role-<%= user.role %>"><%= user.role.charAt(0).toUpperCase() + user.role.slice(1) %></span>
                  </td>
                  <td>
                    <span class="badge status-<%= user.isActive ? 'active' : 'inactive' %>">
                      <%= user.isActive ? 'Active' : 'Inactive' %>
                    </span>
                  </td>
                  <td><%= user.lastLogin ? new Date(user.lastLogin).toLocaleString('th-TH') : 'Never' %></td>
                  <td>
                    <a href="/manageUser/edit/<%= user._id %>" class="btn btn-sm btn-outline-primary me-1">Edit</a>
                    <form method="POST" action="/manageUser/delete/<%= user._id %>" style="display:inline;" onsubmit="return confirm('ยืนยันการลบ?')">
                      <button type="submit" class="btn btn-sm btn-outline-danger">Delete</button>
                    </form>
                  </td>
                </tr>
              <% }); %>
              <% if (users.length === 0) { %>
                <tr><td colspan="6" class="text-center py-4">ไม่พบผู้ใช้</td></tr>
              <% } %>
            </tbody>
          </table>
        </div>
      </div>
    </div>
  </div>

</body>
</html>